<!doctype html>
<html lang="az" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="canonical" href="https://www.eduplan.az/timetable.html" />
  <meta name="description" content="Az…ôrbaycan orta m…ôkt…ôbl…ôri √º√ß√ºn onlayn D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî m√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± daxil edin, sistem avtomatik c…ôdv…ôl qursun.">
  <meta name="robots" content="index, follow" />
  <meta name="author" content="EduPlan.az" />
  <meta name="language" content="az" />
  <meta name="format-detection" content="telephone=no" />

  <title>D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî EduPlan</title>

  <meta name="theme-color" content="#ffffff" id="theme-color" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî EduPlan" />
  <meta property="og:description" content="M√º…ôllim v…ô sinif m…ôlumatlarƒ±nƒ± daxil edin, sistem avtomatik d…ôrs c…ôdv…ôli hazƒ±rlasƒ±n." />
  <meta property="og:image" content="https://www.eduplan.az/assets/og-image.jpg" />
  <meta property="og:url" content="https://www.eduplan.az/timetable.html" />
  <meta property="og:site_name" content="EduPlan" />

  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="logo.svg">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="favicon-48x48.png" sizes="48x48">
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="android-chrome-512x512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0ea5e9">
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Tema: FOUC olmasƒ±n (Tailwind-d…ôn …ôvv…ôl) -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = (saved === 'dark' || saved === 'light') ? saved : (systemDark ? 'dark' : 'light');

        const root = document.documentElement;
        root.classList.toggle('dark', theme === 'dark');
        root.dataset.theme = theme;

        const meta = document.getElementById('theme-color');
        if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b1220' : '#ffffff');
      } catch (e) {}
    })();
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- XLSX lazy loader (Y√ºkl…ô d√ºym…ôsi √º√ß√ºn) -->
  <script>
    (function () {
      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = src;
          s.async = true;
          s.onload = () => resolve();
          s.onerror = () => reject(new Error('Script y√ºkl…ônm…ôdi: ' + src));
          document.head.appendChild(s);
        });
      }

      window.__loadXLSX = function () {
        if (window.XLSX) return Promise.resolve();
        if (window.__xlsxPromise) return window.__xlsxPromise;

        window.__xlsxPromise = loadScript('https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js')
          .catch(() => loadScript('https://unpkg.com/xlsx@0.19.3/dist/xlsx.full.min.js'));

        return window.__xlsxPromise;
      };

      // arxa planda c…ôhd etsin (bloklamasƒ±n)
      window.__loadXLSX().catch(() => {});
    })();
  </script>

  <style>
    html, body { overflow-x: hidden; }
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }
    html { scroll-padding-top: 80px; }

    .ep-btn-primary{ background: linear-gradient(90deg,#1e3a8a 0%,#4f46e5 50%,#9333ea 100%); }
    html.dark .ep-btn-primary{ background: linear-gradient(90deg,#312e81 0%,#4338ca 50%,#7e22ce 100%); }

    /* ==== Form controls ==== */
    :root{
      --ep-field-h: 42px;
      --ep-field-h-sm: 36px;

      --ep-radius-lg: 1rem;
      --ep-radius-sm: .95rem;
    }

    input[type="text"], input[type="number"], select {
      width: 100%;
      border-radius: var(--ep-radius-lg);
      border: 1px solid rgba(226,232,240,.75);
      background-color: rgba(255,255,255,.6);
      padding: .58rem .9rem;
      font-size: 13px;
      line-height: 1.35;
      min-height: var(--ep-field-h);
      outline: none;
      transition: background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
    }

    html.dark input[type="text"], html.dark input[type="number"], html.dark select {
      border-color: rgba(30,41,59,.7);
      background-color: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }

    input[type="text"]::placeholder, input[type="number"]::placeholder { color: rgb(148,163,184); }

    input[type="text"]:focus, input[type="number"]:focus, select:focus{
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.22);
    }

    select{
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding-right: 2.25rem;
      background-repeat: no-repeat;
      background-position: right .75rem center;
      background-size: 1rem 1rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    }
    html.dark select{
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%23cbd5e1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    select option, select optgroup{
      color: #0f172a;
      background-color: #ffffff;
    }

    input[type="checkbox"]{ accent-color: rgb(99,102,241); }

    .section-title{
      font-size:.8rem;
      font-weight:700;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgb(100 116 139);
    }
    html.dark .section-title{ color: rgb(148 163 184); }

    /* Config table */
    table.config-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 8px;
      font-size:.78rem;
    }
    table.config-table th{
      text-align:left;
      font-weight:600;
      color: rgb(100 116 139);
      padding: 4px 6px;
      font-size: .72rem;
      white-space: normal;
      line-height: 1.15;
    }
    html.dark table.config-table th{ color: rgb(148 163 184); }
    table.config-table td{
      padding: 4px 6px;
      vertical-align: top;
      overflow: visible;
    }

    table.config-table input, table.config-table select{
      padding: .44rem .64rem;
      border-radius: var(--ep-radius-sm);
      min-height: var(--ep-field-h-sm);
      font-size: 12.5px;
      line-height: 1.35;
    }

    /* ===== Teacher table ===== */
    #teacherTable{ table-layout: fixed; width: 100%; min-width: 0; }
    #teacherTable th:nth-child(1), #teacherTable td:nth-child(1){ width: 22%; }
    #teacherTable th:nth-child(2), #teacherTable td:nth-child(2){ width: 9%; }
    #teacherTable th:nth-child(3), #teacherTable td:nth-child(3){ width: 10%; }
    #teacherTable th:nth-child(4), #teacherTable td:nth-child(4){ width: 9%; }
    #teacherTable th:nth-child(5), #teacherTable td:nth-child(5){ width: 6%; }
    #teacherTable th:nth-child(6), #teacherTable td:nth-child(6){ width: 7%; }
    #teacherTable th:nth-child(7), #teacherTable td:nth-child(7){ width: 32%; }
    #teacherTable th:nth-child(8), #teacherTable td:nth-child(8){ width: 5%; }

    .t-days{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      font-size: 11px;
      line-height: 1.2;
    }
    .t-days label{
      display:inline-flex;
      align-items:center;
      gap:4px;
      white-space: nowrap;
    }

    /* Class / Lesson tables */
    #classTable, #lessonTable{ table-layout: fixed; width:100%; min-width:0; }
    #classTable th:nth-child(1), #classTable td:nth-child(1){ width: 18%; }
    #classTable th:nth-child(2), #classTable td:nth-child(2){ width: 28%; }
    #classTable th:nth-child(3), #classTable td:nth-child(3){ width: 18%; }
    #classTable th:nth-child(4), #classTable td:nth-child(4){ width: 26%; }
    #classTable th:nth-child(5), #classTable td:nth-child(5){ width: 10%; }

    #lessonTable th:nth-child(1), #lessonTable td:nth-child(1){ width: 16%; }
    #lessonTable th:nth-child(2), #lessonTable td:nth-child(2){ width: 30%; }
    #lessonTable th:nth-child(3), #lessonTable td:nth-child(3){ width: 24%; }
    #lessonTable th:nth-child(4), #lessonTable td:nth-child(4){ width: 14%; }
    #lessonTable th:nth-child(5), #lessonTable td:nth-child(5){ width: 7%; }
    #lessonTable th:nth-child(6), #lessonTable td:nth-child(6){ width: 7%; }
    #lessonTable th:nth-child(7), #lessonTable td:nth-child(7){ width: 2%; }

    /* Tabs */
    .tab-btn{
      border-radius: 9999px;
      padding: .3rem .8rem;
      font-size: .78rem;
      border: 1px solid transparent;
      background: transparent;
      cursor: pointer;
      white-space: nowrap;
      transition: background-color .15s ease, border-color .15s ease, color .15s ease;
    }
    .tab-btn:hover{ background: rgba(15,23,42,.04); }
    html.dark .tab-btn:hover{ background: rgba(255,255,255,.06); }

    .tab-btn.active{
      border-color: rgba(99,102,241,.55);
      background: rgba(99,102,241,.10);
      color: rgb(67 56 202);
      font-weight: 600;
    }
    html.dark .tab-btn.active{
      border-color: rgba(129,140,248,.55);
      background: rgba(129,140,248,.12);
      color: rgb(226 232 240);
    }

    /* Timetable table */
    .tt-table{
      width:100%;
      border-collapse:collapse;
      font-size:.78rem;
      overflow: hidden;
      border-radius: 1rem;
    }
    .tt-table th, .tt-table td{
      border: 1px solid rgba(226,232,240,.75);
      padding: .35rem .45rem;
      text-align:center;
    }
    html.dark .tt-table th, html.dark .tt-table td{
      border-color: rgba(51,65,85,.9);
    }
    .tt-table th{
      background: rgba(148,163,184,.14);
      font-weight: 700;
      font-size: .75rem;
    }
    html.dark .tt-table th{ background: rgba(15,23,42,.7); }

    .tt-slot-muted{ color: rgb(148 163 184); font-style: italic; }
    html.dark .tt-slot-muted{ color: rgb(100 116 139); }

    #unplacedContainer{ white-space: pre-line; }

    /* Print ‚Äì yalnƒ±z c…ôdv…ôl qalsƒ±n */
    @media print{
      header, .no-print, footer { display:none !important; }
      main{ padding: 0 !important; max-width: none !important; }
      body{ background: white !important; }
    }

    /* ===== Premium custom select (dropdown) ===== */
    .ep-native-select{
      position:absolute !important;
      opacity:0 !important;
      pointer-events:none !important;
      width:1px !important;
      height:1px !important;
      left:-9999px !important;
    }

    .ep-select{ position:relative; width:100%; overflow: visible; }
    .ep-select-btn{
      width:100%;
      min-height: var(--ep-field-h);
      border-radius: var(--ep-radius-lg);
      border: 1px solid rgba(226,232,240,.75);
      background: rgba(255,255,255,.65);
      padding: .62rem 1rem;
      font-size: 13px;
      line-height: 1.35;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
      cursor:pointer;
      transition: background-color .15s ease, border-color .15s ease, box-shadow .15s ease, transform .08s ease;
    }
    .ep-select-btn:hover{ background: rgba(255,255,255,.78); }
    .ep-select-btn:active{ transform: translateY(1px); }
    .ep-select-btn:focus{
      outline:none;
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.22);
    }

    html.dark .ep-select-btn{
      border-color: rgba(30,41,59,.7);
      background: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }

    .ep-select-sm .ep-select-btn{
      min-height: var(--ep-field-h-sm);
      padding: .48rem .85rem;
      font-size: 12.5px;
      line-height: 1.35;
      border-radius: var(--ep-radius-sm);
    }

    .ep-select-menu{
      position:absolute;
      inset-inline:0;
      top: calc(100% + .35rem);
      z-index: 9999;
      border-radius: 1rem;
      border: 1px solid rgba(226,232,240,.9);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      padding: .35rem;
      box-shadow: 0 18px 55px rgba(2,6,23,.18);
      display:none;
      max-height: 260px;
      overflow:auto;
    }
    html.dark .ep-select-menu{
      border-color: rgba(51,65,85,.9);
      background: rgba(2,6,23,.92);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .ep-select.open .ep-select-menu{ display:block; }

    .ep-select-item{
      width:100%;
      border:0;
      background: transparent;
      color: inherit;
      border-radius: .85rem;
      padding: .55rem .75rem;
      font-size: 13px;
      text-align:left;
      cursor:pointer;
      transition: background-color .12s ease;
    }
    .ep-select-sm .ep-select-item{ font-size: 12.5px; padding: .5rem .7rem; }
    .ep-select-item:hover{ background: rgba(99,102,241,.10); }
    html.dark .ep-select-item:hover{ background: rgba(129,140,248,.14); }

    .ep-select-item[aria-selected="true"]{
      background: rgba(99,102,241,.16);
      font-weight: 600;
    }
    html.dark .ep-select-item[aria-selected="true"]{ background: rgba(129,140,248,.18); }

    /* ===== Saƒü/sol BO≈û reklam yerl…ôri (√ß…ôr√ßiv…ôsiz) ===== */
    .ep-shell{
      display:grid;
      grid-template-columns: 160px minmax(0, 1100px) 160px; /* bo≈üluq dolmasƒ±n */
      gap: 24px;
      align-items:start;
      width:100%;
      max-width: 1600px;
      margin: 0 auto;
    }
    .ep-center{ min-width:0; }

    /* Tam bo≈ü slot: n…ô border, n…ô bg, n…ô label ‚Äî sad…ôc…ô √∂l√ß√º */
    .ep-ad-slot{
      width: 160px;
      height: 600px;
      display:block;
    }

    @media (max-width: 1280px){
      .ep-shell{ grid-template-columns: 1fr; }
      .ep-ad-slot{ display:none; }
    }

    @media (max-width: 900px){
      table.config-table{ font-size: .76rem; }
      table.config-table th{ font-size: .68rem; }
      table.config-table input, table.config-table select{ font-size: 12px; }
      .t-days{ gap: 5px; }
    }
  </style>
</head>

<body class="min-h-screen pt-16 text-slate-900 dark:text-slate-100 bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">

  <a href="#main"
     class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[100] focus:rounded-xl focus:bg-white focus:px-4 focus:py-2 focus:text-slate-900 focus:shadow">
    Kontent…ô ke√ß
  </a>

  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/60 to-emerald-200/60 dark:from-indigo-500/15 dark:to-emerald-500/10"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/60 to-pink-200/60 dark:from-amber-500/10 dark:to-pink-500/10"></div>
  </div>

  <header class="fixed top-0 inset-x-0 z-50 border-b border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/60 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <img src="assets/ep-favicon-light.svg" alt="EduPlan" class="h-9 w-9 dark:hidden" width="36" height="36" />
          <img src="assets/ep-favicon-dark.svg" alt="" aria-hidden="true" class="h-9 w-9 hidden dark:block" width="36" height="36" />
          <span class="font-semibold tracking-tight">EduPlan AZ</span>
        </a>

        <button
          id="theme-toggle"
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-slate-900/40 p-2 hover:bg-white/80 dark:hover:bg-slate-900/60 transition focus:outline-none focus:ring-2 focus:ring-indigo-400"
          aria-label="Tema d…ôyi≈üdir"
          aria-pressed="false"
        >
          <svg class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.5-1.5M20.5 20.5 19 19M19 5l1.5-1.5M3.5 20.5 5 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg class="h-5 w-5 hidden dark:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 13.2A7.5 7.5 0 0 1 10.8 3 6.9 6.9 0 1 0 21 13.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="main" class="px-4 sm:px-6 lg:px-8 pt-10 pb-6">
    <div class="ep-shell">
      <!-- SOL: bo≈ü reklam yeri (160x600) -->
      <aside class="ep-ad-slot no-print" aria-label="Reklam (sol)"></aside>

      <div class="ep-center">
        <section class="py-6 sm:py-8">
          <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight">D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ±</h1>
          <p class="mt-2 text-slate-600 dark:text-slate-300 max-w-[75ch]">
            Orta m…ôkt…ôbl…ôr √º√ß√ºn d…ôrs c…ôdv…ôli: m√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± daxil edin, sistem tipik m…ôhdudiyy…ôtl…ôrl…ô avtomatik c…ôdv…ôl qursun.
          </p>
        </section>

        <section class="rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur shadow-sm">
          <div class="px-6 py-4 border-b border-slate-200/70 dark:border-slate-800/70 flex items-center justify-between gap-4">
            <div class="font-semibold">üß© M…ôkt…ôb konfiqurasiyasƒ± v…ô hazƒ±rlayƒ±cƒ±</div>
          </div>

          <div class="p-6 space-y-4">

            <!-- 1) M…ôkt…ôb parametrl…ôri -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
              <div class="section-title mb-2">M…ôkt…ôb parametrl…ôri</div>

              <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                  <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">H…ôft…ôlik i≈ü g√ºn√º</label>
                  <select id="daysCount">
                    <option value="5">5 g√ºn (B.e‚ÄìC.u)</option>
                    <option value="6">6 g√ºn (B.e‚Äì≈û)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">G√ºnd…ô d…ôrs saatƒ± (max)</label>
                  <input id="lessonsPerDay" type="number" min="1" max="8" value="7" />
                </div>
              </div>

              <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300">
                <label class="inline-flex items-start gap-2">
                  <input id="optHeavyAvoidEdges" type="checkbox" class="mt-0.5" checked />
                  <span>Aƒüƒ±r f…ônl…ôr m√ºmk√ºn q…ôd…ôr 1-ci v…ô sonuncu saatda olmasƒ±n</span>
                </label>
                <label class="inline-flex items-start gap-2">
                  <input id="optLimitSameSubject" type="checkbox" class="mt-0.5" checked />
                  <span>Eyni g√ºnd…ô eyni f…ônn 2 d…ôf…ôd…ôn √ßox bir sinifd…ô t…ôkrarlanmasƒ±n</span>
                </label>
              </div>

              <div class="mt-3 text-[11px] text-slate-500 dark:text-slate-400">
                ƒ∞btidai √º√ß√ºn g√ºnd…ô 6, …ôsas √º√ß√ºn 7, yuxarƒ± √º√ß√ºn 8 d…ôrs limiti standart kimi t…ôtbiq olunur
                (sinif c…ôdv…ôlind…ô ayrƒ±ca d…ôyi≈üm…ôk m√ºmk√ºnd√ºr).
              </div>
            </div>

            <!-- 2) M√º…ôlliml…ôr -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="section-title">M√º…ôlliml…ôr</div>
                <button type="button" id="btnAddTeacher"
                        class="no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  ‚ûï ∆èlav…ô et
                </button>
              </div>

              <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                H…ôr m√º…ôllim √º√ß√ºn h…ôft…ôlik v…ô g√ºnd…ôlik maksimum saat, g…ôlm…ô g√ºnl…ôri v…ô 1-ci / sonuncu saatdan qa√ßmaq ist…ôyi.
              </div>

              <table class="config-table" id="teacherTable">
                <thead>
                  <tr>
                    <th>Ad, soyad</th>
                    <th>Kod</th>
                    <th>H…ôft…ôlik<span class="block">max</span></th>
                    <th>G√ºnd…ô<span class="block">max</span></th>
                    <th>1-ci saatƒ±<span class="block">sevmir</span></th>
                    <th>Sonuncu saatƒ±<span class="block">sevmir</span></th>
                    <th>G…ôlm…ô g√ºnl…ôri</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="teacherTbody"></tbody>
              </table>
            </div>

            <!-- 3) Sinifl…ôr -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="section-title">Sinifl…ôr</div>
                <button type="button" id="btnAddClass"
                        class="no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  ‚ûï ∆èlav…ô et
                </button>
              </div>

              <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                S…ôviyy…ô: 1‚Äì4 ibtidai, 5‚Äì8 …ôsas, 9‚Äì11 yuxarƒ±. N√∂vb…ô sad…ôc…ô informasiya √º√ß√ºnd√ºr.
              </div>

              <table class="config-table" id="classTable">
                <thead>
                  <tr>
                    <th>Sinif</th>
                    <th>S…ôviyy…ô</th>
                    <th>N√∂vb…ô</th>
                    <th>G√ºnd…ô max d…ôrs</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="classTbody"></tbody>
              </table>
            </div>

            <!-- 4) F…ônn / d…ôrs saatlarƒ± -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="section-title">F…ônn / d…ôrs saatlarƒ±</div>
                <button type="button" id="btnAddLesson"
                        class="no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  ‚ûï ∆èlav…ô et
                </button>
              </div>

              <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                H…ôr s…ôtir: sinif + f…ônn + m√º…ôllim + h…ôft…ôlik saat. ‚ÄúQo≈üa‚Äù se√ßs…ôn, imkan daxilind…ô ardƒ±cƒ±l yerl…ô≈üdir…ôc…ôk.
              </div>

              <table class="config-table" id="lessonTable">
                <thead>
                  <tr>
                    <th>Sinif</th>
                    <th>F…ônn</th>
                    <th>M√º…ôllim kodu/adƒ±</th>
                    <th>H…ôft…ôlik saat</th>
                    <th>Aƒüƒ±r?</th>
                    <th>Qo≈üa?</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="lessonTbody"></tbody>
              </table>
            </div>

            <!-- 5) Hazƒ±rlayƒ±cƒ± -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4 no-print">
              <div class="section-title mb-2">Hazƒ±rlayƒ±cƒ±</div>

              <div class="space-y-1.5 text-xs text-slate-600 dark:text-slate-300 mb-4">
                <p>1) M√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± doldur.</p>
                <p>2) ‚ÄúC…ôdv…ôli qur‚Äù d√ºym…ôsini sƒ±x ‚Äî sistem bir ne√ß…ô d…ôf…ô c…ôhd ed…ôr…ôk konfliktl…ôri minimuma endirm…ôy…ô √ßalƒ±≈üacaq.</p>
              </div>

              <div class="flex flex-wrap gap-2">
                <button id="btnGenerate"
                        class="ep-btn-primary inline-flex items-center justify-center rounded-2xl px-4 py-3 text-sm font-semibold text-white shadow-sm hover:brightness-110 transition">
                  ‚öôÔ∏è C…ôdv…ôli qur
                </button>

                <button id="btnResetAll"
                        class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  üßπ Hamƒ±sƒ±nƒ± t…ômizl…ô
                </button>

                <button id="btnDownload"
                        class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  ‚¨áÔ∏è Y√ºkl…ô (.xlsx)
                </button>

                <button id="btnPrint"
                        class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-900/60 transition">
                  üñ®Ô∏è √áap / PDF
                </button>
              </div>

              <div id="globalError" class="mt-3 text-xs text-rose-500 hidden"></div>
              <div id="globalInfo" class="mt-2 text-[11px] text-slate-500 dark:text-slate-400"></div>
            </div>

            <!-- 6) N…ôtic…ô -->
            <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4 min-h-[260px]" id="resultCard">
              <div class="flex items-center justify-between mb-3">
                <div class="section-title">N…ôtic…ô</div>
                <div id="resultStats" class="text-[11px] text-slate-500 dark:text-slate-400"></div>
              </div>

              <div id="classTabs" class="flex flex-wrap gap-1 mb-3 text-xs no-print"></div>

              <div id="timetableContainer" class="overflow-x-auto text-xs">
                <div class="text-[12px] text-slate-500 dark:text-slate-400">
                  H…ôl…ô c…ôdv…ôl qurulmayƒ±b. M…ôlumatlarƒ± daxil etdikd…ôn sonra <strong>‚ÄúC…ôdv…ôli qur‚Äù</strong> d√ºym…ôsini sƒ±xƒ±n.
                </div>
              </div>

              <div id="unplacedContainer" class="mt-3 text-[11px] text-amber-600 dark:text-amber-400 hidden"></div>
              <div id="softWarnings" class="mt-2 text-[11px] text-slate-500 dark:text-slate-400"></div>
            </div>

          </div>
        </section>

        <section class="mt-10 rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur p-6 sm:p-10 shadow-sm">
          <h2 class="text-2xl sm:text-3xl font-semibold">Qƒ±sa izah</h2>

          <div class="mt-5 space-y-4 text-base leading-7 text-slate-700 dark:text-slate-200">
            <p>
              Hazƒ±rlayƒ±cƒ± Az…ôrbaycan orta m…ôkt…ôbl…ôri √º√ß√ºn tipik m…ôhdudiyy…ôtl…ôri n…ôz…ôr…ô alƒ±r:
              m√º…ôlliml…ôrin eyni saatda iki sinif…ô d√º≈üm…ôm…ôsi, sinifl…ôrin g√ºnd…ô saat limitl…ôri,
              aƒüƒ±r f…ônl…ôrin 1-ci v…ô sonuncu saatdan m√ºmk√ºn q…ôd…ôr uzaq saxlanmasƒ±, eyni g√ºnd…ô eyni f…ônnin
              h…ôddind…ôn artƒ±q yƒ±ƒüƒ±lmamasƒ±, el…ôc…ô d…ô m√º…ôllimin h…ôft…ônin yalnƒ±z se√ßilmi≈ü g√ºnl…ôrind…ô g…ôl…ô bilm…ôsi v…ô s.
            </p>
          </div>
        </section>

        <footer class="mt-6 border-t border-slate-200/70 dark:border-slate-800/70">
          <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 flex flex-col sm:flex-row gap-4 items-center justify-between text-sm text-slate-600 dark:text-slate-300">
            <div>
              ¬© <span id="year"></span> <span class="font-semibold text-slate-900 dark:text-slate-100">EduPlan AZ</span> ¬∑ B√ºt√ºn h√ºquqlar qorunur
            </div>

            <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
              <a class="hover:underline underline-offset-4" href="/about.html">Haqqƒ±mƒ±zda</a>
              <a class="hover:underline underline-offset-4" href="/copyright.html">M√º…ôllif h√ºquqlarƒ±</a>
              <a class="hover:underline underline-offset-4" href="/contact.html">∆èlaq…ô</a>
              <a class="hover:underline underline-offset-4" href="/terms.html">≈û…ôrtl…ôr</a>
              <a class="hover:underline underline-offset-4" href="/privacy.html">M…ôxfilik</a>
            </nav>
          </div>
        </footer>

      </div>

      <!-- SAƒû: bo≈ü reklam yeri (160x600) -->
      <aside class="ep-ad-slot no-print" aria-label="Reklam (saƒü)"></aside>
    </div>
  </main>

  <script>
    (function () {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const btn = document.getElementById('theme-toggle');
      const meta = document.getElementById('theme-color');
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      const hasUserPref = () => {
        try { return !!localStorage.getItem('theme'); } catch (e) { return false; }
      };

      const getTheme = () => (document.documentElement.classList.contains('dark') ? 'dark' : 'light');

      function applyTheme(theme, persist) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        document.documentElement.dataset.theme = theme;

        if (btn) btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (meta) meta.setAttribute('content', isDark ? '#0b1220' : '#ffffff');

        if (persist) {
          try { localStorage.setItem('theme', theme); } catch (e) {}
        }
      }

      applyTheme(getTheme(), false);

      btn && btn.addEventListener('click', function () {
        const next = (getTheme() === 'dark') ? 'light' : 'dark';
        applyTheme(next, true);
      });

      const onSystemChange = function (e) {
        if (!hasUserPref()) applyTheme(e.matches ? 'dark' : 'light', false);
      };

      if (mq) {
        if (mq.addEventListener) mq.addEventListener('change', onSystemChange);
        else if (mq.addListener) mq.addListener(onSystemChange);
      }
    })();
  </script>

  <!-- Timetable logic -->
  <script>
    (function () {
      const teacherTbody = document.getElementById('teacherTbody');
      const classTbody = document.getElementById('classTbody');
      const lessonTbody = document.getElementById('lessonTbody');

      const btnAddTeacher = document.getElementById('btnAddTeacher');
      const btnAddClass = document.getElementById('btnAddClass');
      const btnAddLesson = document.getElementById('btnAddLesson');

      const btnGenerate = document.getElementById('btnGenerate');
      const btnResetAll = document.getElementById('btnResetAll');
      const btnPrint = document.getElementById('btnPrint');
      const btnDownload = document.getElementById('btnDownload');

      const globalError = document.getElementById('globalError');
      const globalInfo  = document.getElementById('globalInfo');

      const resultStats = document.getElementById('resultStats');
      const timetableContainer = document.getElementById('timetableContainer');
      const unplacedContainer = document.getElementById('unplacedContainer');
      const softWarnings = document.getElementById('softWarnings');
      const classTabs = document.getElementById('classTabs');

      const daysCountSelect = document.getElementById('daysCount');

      const DAYS_LABELS_5 = ['B.e','√á.a','√á','C','C.u'];
      const DAYS_LABELS_6 = ['B.e','√á.a','√á','C','C.u','≈û'];
      const DAY_LABELS_FULL = ['B.e','√á.a','√á','C','C.u','≈û'];

      window.__epLast = null;

      const __epSelectInstances = new Set();

      function makePrettySelect(selectEl, opts = {}) {
        if (!selectEl || selectEl.dataset.epPrettySelect === '1') return;

        const size = opts.size === 'sm' ? 'sm' : 'md';

        const wrap = document.createElement('div');
        wrap.className = 'ep-select' + (size === 'sm' ? ' ep-select-sm' : '');

        selectEl.parentNode.insertBefore(wrap, selectEl);
        wrap.appendChild(selectEl);

        selectEl.classList.add('ep-native-select');
        selectEl.dataset.epPrettySelect = '1';

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'ep-select-btn';
        btn.setAttribute('aria-haspopup', 'listbox');
        btn.setAttribute('aria-expanded', 'false');

        const menu = document.createElement('div');
        menu.className = 'ep-select-menu';
        menu.setAttribute('role', 'listbox');

        wrap.appendChild(btn);
        wrap.appendChild(menu);

        function close() {
          wrap.classList.remove('open');
          btn.setAttribute('aria-expanded', 'false');
        }
        function open() {
          __epSelectInstances.forEach(inst => { if (inst !== api) inst.close(); });
          wrap.classList.add('open');
          btn.setAttribute('aria-expanded', 'true');
        }
        function toggle() { wrap.classList.contains('open') ? close() : open(); }

        function render() {
          const selected = selectEl.options[selectEl.selectedIndex];
          const label = selected ? selected.textContent : '';

          btn.innerHTML = `
            <span style="min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${label}</span>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none" aria-hidden="true" style="flex:0 0 auto;opacity:.9">
              <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          `;

          menu.innerHTML = '';
          Array.from(selectEl.options).forEach((opt, idx) => {
            const item = document.createElement('button');
            item.type = 'button';
            item.className = 'ep-select-item';
            item.textContent = opt.textContent;
            item.setAttribute('role', 'option');
            item.setAttribute('aria-selected', idx === selectEl.selectedIndex ? 'true' : 'false');

            item.addEventListener('click', () => {
              selectEl.selectedIndex = idx;
              selectEl.dispatchEvent(new Event('change', { bubbles: true }));
              render();
              close();
            });

            menu.appendChild(item);
          });
        }

        btn.addEventListener('click', (e) => { e.preventDefault(); toggle(); });
        btn.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });

        function onDocDown(e){ if (!wrap.contains(e.target)) close(); }
        document.addEventListener('mousedown', onDocDown);

        selectEl.addEventListener('change', render);

        const api = { close, wrap };
        __epSelectInstances.add(api);

        render();
      }

      makePrettySelect(daysCountSelect, { size: 'md' });

      function currentDaysCount(){
        return parseInt(daysCountSelect.value, 10) || 5;
      }

      function syncTeacherDayVisibility(daysCount){
        teacherTbody.querySelectorAll('.t-daylbl[data-d]').forEach(lbl => {
          const idx = parseInt(lbl.dataset.d, 10);
          const cb = lbl.querySelector('input[type="checkbox"]');
          if (idx >= daysCount) {
            lbl.style.display = 'none';
            if (cb) cb.checked = false;
          } else {
            lbl.style.display = 'inline-flex';
          }
        });
      }

      daysCountSelect.addEventListener('change', () => {
        syncTeacherDayVisibility(currentDaysCount());
      });

      function addTeacherRow(initial = {}) {
        const tr = document.createElement('tr');

        const dc = currentDaysCount();
        const defaultAvail = Array.from({ length: dc }, (_, i) => i);
        const available = Array.isArray(initial.availableDays) && initial.availableDays.length
          ? initial.availableDays
          : defaultAvail;

        const daysHtml = DAY_LABELS_FULL.map((lbl, idx) => {
          const checked = available.includes(idx) ? 'checked' : '';
          return `<label class="t-daylbl" data-d="${idx}">
                    <input type="checkbox" class="t-avday" data-d="${idx}" ${checked}>
                    <span>${lbl}</span>
                  </label>`;
        }).join(' ');

        tr.innerHTML = `
          <td><input type="text" class="t-name" placeholder="M√º…ôllim adƒ±" value="${initial.name || ''}"></td>
          <td><input type="text" class="t-code" placeholder="Kod" value="${initial.code || ''}"></td>
          <td><input type="number" class="t-week" min="0" max="60" value="${initial.weeklyMax ?? 30}"></td>
          <td><input type="number" class="t-daymax" min="0" max="10" value="${initial.dailyMax ?? 6}"></td>
          <td class="text-center"><input type="checkbox" class="t-avoid-first" ${initial.avoidFirst ? 'checked' : ''}></td>
          <td class="text-center"><input type="checkbox" class="t-avoid-last" ${initial.avoidLast ? 'checked' : ''}></td>
          <td>
            <div class="t-days">
              ${daysHtml}
            </div>
          </td>
          <td class="no-print text-right">
            <button type="button" class="text-xs text-rose-500 hover:underline t-del">Sil</button>
          </td>
        `;
        teacherTbody.appendChild(tr);
        syncTeacherDayVisibility(dc);
      }

      function addClassRow(initial = {}) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" class="c-name" placeholder="m…ôs: 5A" value="${initial.name || ''}"></td>
          <td>
            <select class="c-level">
              <option value="ibtidai" ${initial.level === 'ibtidai' ? 'selected' : ''}>ƒ∞btidai (1-4)</option>
              <option value="esas" ${initial.level === 'esas' ? 'selected' : ''}>∆èsas (5-8)</option>
              <option value="yuxari" ${initial.level === 'yuxari' ? 'selected' : ''}>Yuxarƒ± (9-11)</option>
            </select>
          </td>
          <td>
            <select class="c-shift">
              <option value="seher" ${initial.shift === 'seher' ? 'selected' : ''}>S…ôh…ôr</option>
              <option value="gunorta" ${initial.shift === 'gunorta' ? 'selected' : ''}>G√ºnorta</option>
            </select>
          </td>
          <td><input type="number" class="c-maxday" min="0" max="8" placeholder="Bo≈ü: standart" value="${initial.maxPerDay ?? ''}"></td>
          <td class="no-print text-right">
            <button type="button" class="text-xs text-rose-500 hover:underline c-del">Sil</button>
          </td>
        `;
        classTbody.appendChild(tr);

        makePrettySelect(tr.querySelector('.c-level'), { size: 'sm' });
        makePrettySelect(tr.querySelector('.c-shift'), { size: 'sm' });
      }

      function addLessonRow(initial = {}) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" class="l-class" placeholder="m…ôs: 5A" value="${initial.className || ''}"></td>
          <td><input type="text" class="l-subj" placeholder="m…ôs: Riyaziyyat" value="${initial.subject || ''}"></td>
          <td><input type="text" class="l-teacher" placeholder="Kod v…ô ya ad" value="${initial.teacher || ''}"></td>
          <td><input type="number" class="l-hours" min="1" max="40" value="${initial.hours ?? 2}"></td>
          <td class="text-center"><input type="checkbox" class="l-heavy" ${initial.heavy ? 'checked' : ''}></td>
          <td class="text-center"><input type="checkbox" class="l-double" ${initial.double ? 'checked' : ''}></td>
          <td class="no-print text-right">
            <button type="button" class="text-xs text-rose-500 hover:underline l-del">Sil</button>
          </td>
        `;
        lessonTbody.appendChild(tr);
      }

      btnAddTeacher.addEventListener('click', () => addTeacherRow({}));
      btnAddClass.addEventListener('click', () => addClassRow({}));
      btnAddLesson.addEventListener('click', () => addLessonRow({}));

      teacherTbody.addEventListener('click', (e) => {
        if (e.target.classList.contains('t-del')) e.target.closest('tr')?.remove();
      });
      classTbody.addEventListener('click', (e) => {
        if (e.target.classList.contains('c-del')) e.target.closest('tr')?.remove();
      });
      lessonTbody.addEventListener('click', (e) => {
        if (e.target.classList.contains('l-del')) e.target.closest('tr')?.remove();
      });

      btnResetAll.addEventListener('click', () => {
        teacherTbody.innerHTML = '';
        classTbody.innerHTML = '';
        lessonTbody.innerHTML = '';
        timetableContainer.innerHTML = '<div class="text-[12px] text-slate-500 dark:text-slate-400">H…ôl…ô c…ôdv…ôl qurulmayƒ±b.</div>';
        classTabs.innerHTML = '';
        unplacedContainer.classList.add('hidden');
        unplacedContainer.textContent = '';
        softWarnings.textContent = '';
        resultStats.textContent = '';
        globalError.classList.add('hidden');
        globalError.textContent = '';
        globalInfo.textContent = '';
        window.__epLast = null;
      });

      btnPrint.addEventListener('click', () => window.print());

      function showError(msg){
        globalError.textContent = msg;
        globalError.classList.remove('hidden');
      }

      function readConfig() {
        globalError.classList.add('hidden');
        globalError.textContent = '';

        const daysCount = currentDaysCount();
        const lessonsPerDay = parseInt(document.getElementById('lessonsPerDay').value, 10) || 7;

        const optHeavyAvoidEdges = document.getElementById('optHeavyAvoidEdges').checked;
        const optLimitSameSubject = document.getElementById('optLimitSameSubject').checked;

        const teachers = [];
        teacherTbody.querySelectorAll('tr').forEach(tr => {
          const name = tr.querySelector('.t-name')?.value.trim();
          const code = tr.querySelector('.t-code')?.value.trim();
          if (!name && !code) return;

          const dayCbs = tr.querySelectorAll('.t-avday[data-d]');
          let availableDays = [];
          dayCbs.forEach(cb => {
            if (cb.checked) {
              const idx = parseInt(cb.dataset.d, 10);
              if (!Number.isNaN(idx)) availableDays.push(idx);
            }
          });

          availableDays = availableDays.filter(d => d < daysCount);
          if (!availableDays.length) availableDays = Array.from({ length: daysCount }, (_, i) => i);

          teachers.push({
            id: teachers.length,
            name: name || code,
            code: code || name,
            weeklyMax: Number(tr.querySelector('.t-week')?.value) || 0,
            dailyMax: Number(tr.querySelector('.t-daymax')?.value) || 0,
            avoidFirst: tr.querySelector('.t-avoid-first')?.checked || false,
            avoidLast: tr.querySelector('.t-avoid-last')?.checked || false,
            availableDays
          });
        });

        const classes = [];
        classTbody.querySelectorAll('tr').forEach(tr => {
          const name = tr.querySelector('.c-name')?.value.trim();
          if (!name) return;
          const level = tr.querySelector('.c-level')?.value || 'esas';
          const shift = tr.querySelector('.c-shift')?.value || 'seher';
          const maxDay = Number(tr.querySelector('.c-maxday')?.value) || 0;
          classes.push({
            id: classes.length,
            name,
            level,
            shift,
            maxPerDay: maxDay
          });
        });

        const lessons = [];
        lessonTbody.querySelectorAll('tr').forEach(tr => {
          const className = tr.querySelector('.l-class')?.value.trim();
          const subject   = tr.querySelector('.l-subj')?.value.trim();
          const teacher   = tr.querySelector('.l-teacher')?.value.trim();
          const hours     = Number(tr.querySelector('.l-hours')?.value) || 0;
          if (!className || !subject || !teacher || hours <= 0) return;

          lessons.push({
            className,
            subject,
            teacherRef: teacher,
            hours,
            heavy: tr.querySelector('.l-heavy')?.checked || false,
            double: tr.querySelector('.l-double')?.checked || false
          });
        });

        if (!teachers.length || !classes.length || !lessons.length) {
          throw new Error('He√ß olmasa 1 m√º…ôllim, 1 sinif v…ô 1 d…ôrs …ôlav…ô etm…ôlis…ôn.');
        }
        if (lessonsPerDay > 8 || lessonsPerDay < 1) {
          throw new Error('G√ºnd…ô d…ôrs saatƒ± 1‚Äì8 aralƒ±ƒüƒ±nda olmalƒ±dƒ±r.');
        }

        return {
          daysCount,
          lessonsPerDay,
          optHeavyAvoidEdges,
          optLimitSameSubject,
          teachers,
          classes,
          lessons
        };
      }

      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      }

      function defaultMaxPerDayByLevel(level) {
        if (level === 'ibtidai') return 6;
        if (level === 'esas') return 7;
        return 8;
      }

      function generateBlocks(config) {
        const { lessons, classes, teachers } = config;
        const classIndexByName = new Map();
        classes.forEach(c => classIndexByName.set(c.name.trim(), c.id));

        const teacherIndexByKey = new Map();
        teachers.forEach(t => {
          if ((t.code || '').trim()) teacherIndexByKey.set((t.code || '').trim(), t.id);
          if ((t.name || '').trim()) teacherIndexByKey.set((t.name || '').trim(), t.id);
        });

        const blocks = [];
        const unknown = [];

        lessons.forEach(l => {
          const cId = classIndexByName.get(l.className.trim());
          const tId = teacherIndexByKey.get(l.teacherRef.trim());
          if (cId == null || tId == null) {
            unknown.push(l);
            return;
          }
          let remaining = l.hours;
          const base = {
            classId: cId,
            teacherId: tId,
            subject: l.subject,
            heavy: !!l.heavy
          };

          if (l.double && remaining >= 2) {
            while (remaining >= 2) {
              blocks.push({ ...base, length: 2 });
              remaining -= 2;
            }
          }
          while (remaining > 0) {
            blocks.push({ ...base, length: 1 });
            remaining -= 1;
          }
        });

        blocks.sort((a, b) => {
          if (b.length !== a.length) return b.length - a.length;
          if (b.heavy !== a.heavy) return (b.heavy ? 1 : 0) - (a.heavy ? 1 : 0);
          return 0;
        });

        return { blocks, unknownUnmapped: unknown };
      }

      function attemptBuild(config) {
        const { daysCount, lessonsPerDay, teachers, classes, optHeavyAvoidEdges, optLimitSameSubject } = config;
        const { blocks } = generateBlocks(config);

        shuffle(blocks);

        const timetable = {};
        classes.forEach(c => {
          const matrix = [];
          for (let d = 0; d < daysCount; d++) matrix.push(new Array(lessonsPerDay).fill(null));
          timetable[c.id] = matrix;
        });

        const teacherWeekly = new Array(teachers.length).fill(0);
        const teacherDaily  = new Array(teachers.length).fill(null).map(() => new Array(daysCount).fill(0));
        const classDaily    = new Array(classes.length).fill(null).map(() => new Array(daysCount).fill(0));
        const classSubjPerDay = new Array(classes.length).fill(null).map(() => Object.create(null));

        const unplaced = [];
        const lastSlotIndex = lessonsPerDay - 1;

        function canPlace(block, day, slot, strict) {
          const { classId, teacherId, subject, length, heavy } = block;
          if (slot + length - 1 >= lessonsPerDay) return false;

          const matrix = timetable[classId];
          for (let i = 0; i < length; i++) {
            if (matrix[day][slot + i] != null) return false;
          }

          const t = teachers[teacherId];
          if (!t) return false;

          if (Array.isArray(t.availableDays) && t.availableDays.length) {
            if (!t.availableDays.includes(day)) return false;
          }

          for (let i = 0; i < length; i++) {
            for (const c of classes) {
              const m = timetable[c.id];
              if (m[day][slot + i] && m[day][slot + i].block.teacherId === teacherId) return false;
            }
          }

          const weeklyMax = t.weeklyMax > 0 ? t.weeklyMax : Infinity;
          const dailyMax  = t.dailyMax > 0 ? t.dailyMax : Infinity;
          if (teacherWeekly[teacherId] + length > weeklyMax) return false;
          if (teacherDaily[teacherId][day] + length > dailyMax) return false;

          const cls = classes[classId];
          const maxDay = cls.maxPerDay > 0 ? cls.maxPerDay : defaultMaxPerDayByLevel(cls.level);
          if (classDaily[classId][day] + length > maxDay) return false;

          if (strict) {
            if (optHeavyAvoidEdges && heavy) {
              if (slot === 0) return false;
              if (slot + length - 1 === lastSlotIndex) return false;
            }
            if (t.avoidFirst && slot === 0) return false;
            if (t.avoidLast && (slot + length - 1 === lastSlotIndex)) return false;

            if (optLimitSameSubject) {
              const subjMap = classSubjPerDay[classId];
              subjMap[subject] = subjMap[subject] || new Array(daysCount).fill(0);
              if (subjMap[subject][day] + length > 2) return false;
            }
          }
          return true;
        }

        function place(block, day, slot) {
          const { classId, teacherId, subject, length } = block;
          const matrix = timetable[classId];
          for (let i = 0; i < length; i++) matrix[day][slot + i] = { block, part: i };

          teacherWeekly[teacherId] += length;
          teacherDaily[teacherId][day] += length;
          classDaily[classId][day] += length;

          const subjMap = classSubjPerDay[classId];
          subjMap[subject] = subjMap[subject] || new Array(daysCount).fill(0);
          subjMap[subject][day] += length;
        }

        function tryPlaceBlock(block) {
          const candidates = [];
          for (let d = 0; d < daysCount; d++) {
            for (let s = 0; s < lessonsPerDay; s++) candidates.push({ d, s });
          }
          shuffle(candidates);

          for (const { d, s } of candidates) {
            if (canPlace(block, d, s, true)) { place(block, d, s); return true; }
          }
          for (const { d, s } of candidates) {
            if (canPlace(block, d, s, false)) { place(block, d, s); return true; }
          }
          return false;
        }

        let placedCount = 0;
        blocks.forEach(b => {
          const ok = tryPlaceBlock(b);
          if (!ok) unplaced.push(b);
          else placedCount += b.length;
        });

        return { timetable, unplaced, placedCount };
      }

      function buildBestTimetable(config) {
        const ATTEMPTS = 25;
        let best = null;

        for (let i = 0; i < ATTEMPTS; i++) {
          const res = attemptBuild(config);
          if (!best || res.placedCount > best.placedCount ||
              (res.placedCount === best.placedCount && res.unplaced.length < best.unplaced.length)) {
            best = res;
          }
        }
        return best;
      }

      function teacherLabel(teachers, tId) {
        const t = teachers[tId];
        if (!t) return '';
        if (t.code && t.name) return `${t.code}`;
        return t.code || t.name || '';
      }

      function renderTimetable(config, result) {
        const { classes, teachers, daysCount, lessonsPerDay } = config;
        const { timetable, unplaced, placedCount } = result;

        const daysLabels = (daysCount === 5 ? DAYS_LABELS_5 : DAYS_LABELS_6).slice(0, daysCount);

        classTabs.innerHTML = '';
        classes.forEach((c, idx) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'tab-btn' + (idx === 0 ? ' active' : '');
          btn.textContent = c.name;
          btn.dataset.classId = c.id;
          classTabs.appendChild(btn);
        });

        function renderForClass(classId) {
          const matrix = timetable[classId];
          if (!matrix) {
            timetableContainer.innerHTML = '<div class="text-[12px] text-slate-500 dark:text-slate-400">Bu sinif √º√ß√ºn c…ôdv…ôl tapƒ±lmadƒ±.</div>';
            return;
          }

          let html = '<table class="tt-table"><thead><tr><th>Saat</th>';
          daysLabels.forEach(d => { html += `<th>${d}</th>`; });
          html += '</tr></thead><tbody>';

          for (let s = 0; s < lessonsPerDay; s++) {
            html += `<tr><th>${s + 1}</th>`;
            for (let d = 0; d < daysCount; d++) {
              const cell = matrix[d][s];
              if (!cell) {
                html += `<td><span class="tt-slot-muted">‚Äî</span></td>`;
              } else if (cell.part === 0) {
                const b = cell.block;
                const subj = b.subject;
                const tLab = teacherLabel(teachers, b.teacherId);
                const rowspan = b.length > 1 ? b.length : 1;
                html += `<td rowspan="${rowspan}">
                          <div class="font-semibold">${subj}</div>
                          <div class="text-[10px] mt-0.5 text-slate-500 dark:text-slate-400">${tLab}</div>
                        </td>`;
              } else {
                // rowspan-a g√∂r…ô bo≈ü qalƒ±r
              }
            }
            html += '</tr>';
          }

          html += '</tbody></table>';
          timetableContainer.innerHTML = html;
        }

        const totalRequiredHours = config.lessons.reduce((sum, l) => sum + (Number(l.hours) || 0), 0);
        const placedPercent = totalRequiredHours > 0 ? ((placedCount / totalRequiredHours) * 100).toFixed(1) : '0.0';
        resultStats.textContent = `Yerl…ô≈üdiril…ôn saat: ${placedCount}/${totalRequiredHours} (${placedPercent}%) ¬∑ C…ôhd: 25`;

        if (unplaced.length) {
          const lines = unplaced.map(b => {
            const cls = classes[b.classId]?.name || '?';
            const t = teachers[b.teacherId];
            const tLabel = t ? (t.code || t.name) : '?';
            return `‚Ä¢ ${cls} ‚Äì ${b.subject} (${tLabel}), ${b.length} saat`;
          });
          unplacedContainer.classList.remove('hidden');
          unplacedContainer.textContent = 'Yerl…ô≈üdirilm…ôy…ônl…ôr:\n' + lines.join('\n');
        } else {
          unplacedContainer.classList.add('hidden');
          unplacedContainer.textContent = '';
        }

        softWarnings.textContent =
          'Qeyd: M√º…ôllim ist…ôkl…ôri (1-ci / sonuncu saatdan qa√ßmaq), aƒüƒ±r f…ônnin paylanmasƒ± v…ô m√º…ôllimin g…ôlm…ô g√ºnl…ôri …ôvv…ôlc…ô s…ôrt ≈ü…ôkild…ô n…ôz…ôr…ô alƒ±nƒ±r, ' +
          'yer tapƒ±lmadƒ±qda is…ô b…ôzi ist…ôkl…ôr yum≈üaldƒ±lƒ±r (g…ôlm…ô g√ºnl…ôri saxlanƒ±lƒ±r).';

        const firstClassId = classes[0]?.id;
        if (firstClassId != null) renderForClass(firstClassId);

        classTabs.onclick = (e) => {
          const btn = e.target.closest('.tab-btn');
          if (!btn) return;
          classTabs.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderForClass(Number(btn.dataset.classId));
        };

        window.__epLast = { config, result, createdAt: Date.now() };
      }

      btnGenerate.addEventListener('click', () => {
        try {
          const config = readConfig();
          globalError.classList.add('hidden');
          globalError.textContent = '';

          globalInfo.textContent = 'C…ôdv…ôl qurulur‚Ä¶ (bir ne√ß…ô f…ôrqli kombinasiyanƒ± sƒ±nayƒ±r)';
          setTimeout(() => {
            const result = buildBestTimetable(config);
            renderTimetable(config, result);
            globalInfo.textContent = 'C…ôdv…ôl quruldu. ƒ∞ndi ‚ÄúY√ºkl…ô (.xlsx)‚Äù il…ô endir…ô bil…ôrsiniz.';
          }, 10);
        } catch (err) {
          showError(err.message || String(err));
        }
      });

      function downloadAsXlsx() {
        globalError.classList.add('hidden');
        globalError.textContent = '';

        const last = window.__epLast;
        if (!last || !last.config || !last.result || !last.result.timetable) {
          showError('∆èvv…ôlc…ô c…ôdv…ôli qurun, sonra y√ºkl…ôyin.');
          return;
        }

        globalInfo.textContent = 'Y√ºkl…ôm…ô hazƒ±rlanƒ±r‚Ä¶';

        (window.__loadXLSX ? window.__loadXLSX() : Promise.reject(new Error('XLSX loader tapƒ±lmadƒ±')))
          .then(() => {
            if (typeof XLSX === 'undefined') throw new Error('Y√ºkl…ôm…ô modulu (XLSX) y√ºkl…ônm…ôdi. ƒ∞nternet baƒülantƒ±sƒ±nƒ± yoxlayƒ±n.');

            const { config, result } = last;
            const { classes, teachers, daysCount, lessonsPerDay } = config;
            const { timetable, unplaced, placedCount } = result;

            const daysLabels = (daysCount === 5 ? DAYS_LABELS_5 : DAYS_LABELS_6).slice(0, daysCount);

            const wb = XLSX.utils.book_new();

            const totalRequiredHours = config.lessons.reduce((sum, l) => sum + (Number(l.hours) || 0), 0);
            const placedPercent = totalRequiredHours > 0 ? ((placedCount / totalRequiredHours) * 100).toFixed(1) : '0.0';

            const summaryAoA = [
              ['EduPlan ‚Äî D…ôrs c…ôdv…ôli'],
              [''],
              ['G√ºn sayƒ±', daysCount],
              ['G√ºnd…ô d…ôrs (max)', config.lessonsPerDay],
              ['Yerl…ô≈üdiril…ôn saat', `${placedCount}/${totalRequiredHours} (${placedPercent}%)`],
              ['C…ôhd sayƒ±', 25],
              [''],
              ['Yerl…ô≈üdirilm…ôy…ônl…ôr']
            ];

            if (unplaced && unplaced.length) {
              unplaced.forEach(b => {
                const cls = classes[b.classId]?.name || '?';
                const t = teachers[b.teacherId];
                const tLabel = t ? (t.code || t.name) : '?';
                summaryAoA.push([`${cls} ‚Äì ${b.subject} (${tLabel}), ${b.length} saat`]);
              });
            } else {
              summaryAoA.push(['Hamƒ±sƒ± yerl…ô≈üdirildi ‚úÖ']);
            }

            const wsSummary = XLSX.utils.aoa_to_sheet(summaryAoA);
            wsSummary['!cols'] = [{ wch: 48 }, { wch: 22 }];
            XLSX.utils.book_append_sheet(wb, wsSummary, 'X√ºlas…ô');

            classes.forEach(cls => {
              const matrix = timetable[cls.id];
              if (!matrix) return;

              const aoa = [];
              aoa.push(['Saat', ...daysLabels]);

              const merges = [];

              for (let s = 0; s < lessonsPerDay; s++) {
                const row = [s + 1];
                for (let d = 0; d < daysCount; d++) {
                  const cell = matrix[d][s];
                  if (!cell) {
                    row.push('‚Äî');
                  } else if (cell.part === 0) {
                    const b = cell.block;
                    const tLab = teacherLabel(teachers, b.teacherId);
                    row.push(`${b.subject}\n${tLab}`);

                    if (b.length && b.length > 1) {
                      merges.push({
                        s: { r: 1 + s, c: 1 + d },
                        e: { r: 1 + s + (b.length - 1), c: 1 + d }
                      });
                    }
                  } else {
                    row.push('');
                  }
                }
                aoa.push(row);
              }

              const ws = XLSX.utils.aoa_to_sheet(aoa);
              ws['!merges'] = merges;

              const cols = [{ wch: 6 }];
              for (let i = 0; i < daysCount; i++) cols.push({ wch: 20 });
              ws['!cols'] = cols;

              let sheetName = (cls.name || 'Sinif').toString().slice(0, 31);
              if (!sheetName) sheetName = 'Sinif';

              XLSX.utils.book_append_sheet(wb, ws, sheetName);
            });

            const pad2 = (n) => String(n).padStart(2, '0');
            const now = new Date();
            const stamp = `${now.getFullYear()}-${pad2(now.getMonth()+1)}-${pad2(now.getDate())}_${pad2(now.getHours())}${pad2(now.getMinutes())}`;
            const filename = `ders-cedveli_${stamp}.xlsx`;

            XLSX.writeFile(wb, filename);
            globalInfo.textContent = 'Fayl hazƒ±rlandƒ± v…ô endirm…ô ba≈üladƒ±ldƒ±.';
          })
          .catch((err) => {
            showError(err.message || String(err));
            globalInfo.textContent = '';
          });
      }

      btnDownload.addEventListener('click', downloadAsXlsx);

      addTeacherRow({ name: 'Riyaziyyat m√º…ôllimi', code: 'Rƒ∞Y', weeklyMax: 24, dailyMax: 6, avoidFirst: false, avoidLast: true, availableDays: [0,1,2,3,4] });
      addTeacherRow({ name: 'Az…ôrbaycan dili m√º…ôllimi', code: 'AZD', weeklyMax: 24, dailyMax: 6, avoidFirst: false, avoidLast: false, availableDays: [0,1,2,3,4] });

      addClassRow({ name: '5A', level: 'esas', shift: 'seher' });
      addClassRow({ name: '6A', level: 'esas', shift: 'seher' });

      addLessonRow({ className: '5A', subject: 'Riyaziyyat', teacher: 'Rƒ∞Y', hours: 4, heavy: true, double: true });
      addLessonRow({ className: '5A', subject: 'Az…ôrbaycan dili', teacher: 'AZD', hours: 3, heavy: false, double: false });

      syncTeacherDayVisibility(currentDaysCount());
    })();
  </script>
</body>
</html>
