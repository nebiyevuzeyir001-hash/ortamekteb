<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D…ôrs c…ôdv…ôli generatoru ‚Äî EduPlan</title>
  <meta name="description" content="M√º…ôllim v…ô sinif m…ôlumatlarƒ±na …ôsas…ôn avtomatik d…ôrs c…ôdv…ôli hazƒ±rlayan sad…ô generator.">
  <meta name="robots" content="noindex, follow" />

  <!-- Favicons / manifest ‚Äì ist…ôs…ôn PP s…ôhif…ônd…ôn eynil…ô k√∂√ß√ºr -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png"
        href="/favicon-light-32.png"
        sizes="32x32"
        media="(prefers-color-scheme: light)" />
  <link rel="icon" type="image/png"
        href="/favicon-dark-32.png"
        sizes="32x32"
        media="(prefers-color-scheme: dark)" />
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0ea5e9">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* === √úmumi tema d…ôyi≈ü…ônl…ôri (PP / KSQ il…ô uyƒüun) === */
    :root{
      --bg-from:#f8fafc; --bg-to:#ffffff; --text:#0f172a; --card:#ffffff; --muted:#475569; --border:#e2e8f0;
      --tab-track:#eef2f6; --pill:#e9edf3; --pill-text:#334155;
    }
    .dark{
      --bg-from:#0b1220; --bg-to:#0a0f1a; --text:#e2e8f0; --card:#0f172a; --muted:#cbd5e1; --border:#334155;
      --tab-track:#111827; --pill:#0f172a; --pill-text:#cbd5e1;
    }
    :where(html, body, main, header, footer, section){
      overflow-x:clip; min-width:0;
    }
    html::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:linear-gradient(to bottom,var(--bg-from),var(--bg-to));
    }
    html{ background:var(--bg-to); }
    html.dark{ background:#0a0f1a; }
    body{ min-height:100svh; color:var(--text); }
    .bg-white{ background-color:var(--card)!important; transition:box-shadow .2s; }
    .bg-white:hover{ box-shadow:0 6px 16px rgba(0,0,0,.08); }
    .dark .bg-white:hover{ box-shadow:0 6px 16px rgba(255,255,255,.12); }
    .text-slate-900,.text-slate-800,.text-slate-700{ color:var(--text)!important; }
    .text-slate-600,.text-slate-500{ color:var(--muted)!important; }
    .border-slate-200{ border-color:var(--border)!important; }
    .backdrop-blur.bg-white\/70{
      background-color:color-mix(in srgb,var(--card) 70%,transparent)!important;
    }

    /* Scrollbar */
    :root { --sb-size: 12px; }
    @media (min-width: 1024px){ :root { --sb-size: 12px; } }
    html, body{
      scrollbar-width:auto;
      scrollbar-color: rgba(110,110,120,.45) transparent;
    }
    ::-webkit-scrollbar{ width: var(--sb-size); height: var(--sb-size); }
    ::-webkit-scrollbar-thumb{
      background: rgba(110,110,120,.50);
      border-radius: 9999px;
      border: 3px solid transparent;
      background-clip: content-box;
    }
    ::-webkit-scrollbar-thumb:hover{ background: rgba(110,110,120,.70); }
    ::-webkit-scrollbar-track{ background: transparent; }
    .dark html, .dark body{ scrollbar-color: rgba(185,195,255,.35) transparent; }
    .dark ::-webkit-scrollbar-thumb{
      background: rgba(185,195,255,.35); border: 3px solid transparent;
    }
    .dark ::-webkit-scrollbar-thumb:hover{
      background: rgba(185,195,255,.55);
    }

    /* Panel card */
    .panel-card{
      display:grid;
      grid-template-rows:auto minmax(0,1fr);
      border-radius:1rem;
      border:1px solid var(--border);
    }

    /* Toggle */
    #dark-toggle:checked+span{ background:#334155; }
    #dark-toggle:checked+span .dot{ transform:translateX(16px); }

    /* Custom primary button (KSQ stilind…ô) */
    .ep-btn-primary{
      display:inline-flex; align-items:center; justify-content:center;
      gap:.4rem;
      padding:.6rem 1rem;
      border-radius:.9rem;
      border:none;
      font-weight:600; font-size:.9rem;
      color:#fff;
      background:linear-gradient(90deg,#1e3a8a 0%,#4f46e5 50%,#9333ea 100%);
      box-shadow:0 4px 12px rgba(79,70,229,.35);
      transition:transform .15s, box-shadow .25s, filter .25s;
    }
    .ep-btn-primary:hover{
      transform:translateY(-1px);
      filter:brightness(1.05);
      box-shadow:0 6px 18px rgba(79,70,229,.55);
    }
    .ep-btn-primary:active{
      transform:translateY(0);
      filter:brightness(.98);
      box-shadow:0 3px 10px rgba(15,23,42,.4);
    }
    .dark .ep-btn-primary{
      background:linear-gradient(90deg,#312e81 0%,#4338ca 50%,#7e22ce 100%);
      box-shadow:0 4px 10px rgba(15,23,42,.9);
    }

    /* Secondary button */
    .ep-btn-secondary{
      display:inline-flex; align-items:center; justify-content:center;
      padding:.6rem 1rem;
      border-radius:.9rem;
      font-size:.85rem;
      font-weight:500;
      border:1px solid var(--border);
      background:color-mix(in srgb,var(--card) 92%, transparent);
    }

    /* Teacher day pills */
    .tt-day-pill{
      border-radius:9999px;
      border:1px solid var(--border);
      padding:.2rem .55rem;
      font-size:.7rem;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      background:rgba(148,163,184,.10);
    }
    .tt-day-pill input[type="checkbox"]{
      width:12px; height:12px;
      accent-color:#0ea5e9;
    }

    .dark .tt-day-pill{
      background:rgba(15,23,42,.8);
      border-color:#334155;
    }

    /* Timetable table */
    .tt-table th,
    .tt-table td{
      border:1px solid var(--border);
      font-size:.75rem;
      text-align:center;
      padding:.3rem .35rem;
    }
    .tt-table th{
      background:rgba(148,163,184,.16);
      font-weight:600;
    }
    .dark .tt-table th{
      background:#020617;
    }
    .tt-slot-empty{
      color:#9ca3af;
      font-size:.7rem;
    }

    /* Tabs for classes */
    .tt-tab-btn{
      padding:.35rem .7rem;
      border-radius:9999px;
      border:1px solid transparent;
      font-size:.75rem;
      cursor:pointer;
      white-space:nowrap;
    }
    .tt-tab-btn.active{
      background:#0ea5e9;
      color:white;
      border-color:#0ea5e9;
    }
    .tt-tab-btn:not(.active){
      background:rgba(148,163,184,.08);
      color:#475569;
    }
    .dark .tt-tab-btn:not(.active){
      background:#020617;
      color:#cbd5e1;
      border-color:#1f2937;
    }

    /* Footer m…ôtni */
    .footer-text{
      font-size: clamp(13.5px, 2.6vw, 15px);
      line-height: 1.45;
      white-space: normal;
      text-wrap: balance;
    }
    .footer-text .chunk{ white-space: nowrap; }
  </style>
</head>
<body class="min-h-screen text-slate-900 relative">
  <!-- Dekor -->
  <div class="pointer-events-none absolute inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/50 to-emerald-200/50"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/40 to-pink-200/40"></div>
  </div>

  <!-- Header (PP/KSQ il…ô eyni struktur) -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/70 border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="/" class="flex items-center gap-3 group focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded-xl">
          <img id="site-logo"
              src="assets/ep-favicon-light.svg"
              class="h-9 w-9 rounded-full overflow-hidden shadow-sm"
              alt="EduPlan" />
          <span class="font-semibold tracking-tight group-hover:underline">EduPlan AZ</span>
        </a>
      </div>

      <div class="relative flex items-center gap-3" id="header-controls">
        <button id="btn-settings" class="rounded-2xl border p-2 text-base leading-none"
                aria-label="Settings" title="Settings">‚öôÔ∏è</button>
        <div id="settings-panel"
            class="hidden fixed right-4 top-[72px] z-[80] w-64 rounded-2xl border border-slate-200 bg-white p-4 shadow-lg">
          <div class="flex items-center justify-between">
            <div class="text-sm">üåô Qaranlƒ±q rejim</div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="dark-toggle" type="checkbox" class="sr-only">
              <span class="w-10 h-6 bg-slate-200 rounded-full relative transition">
                <span class="dot absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition"></span>
              </span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <!-- Ba≈ülƒ±q -->
    <section class="mb-6 sm:mb-8">
      <h1 class="text-2xl sm:text-3xl font-semibold text-slate-900 dark:text-white">
        D…ôrs c…ôdv…ôli generatoru
      </h1>
      <p class="mt-2 text-slate-600 dark:text-slate-300 text-sm sm:text-base">
        M√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± daxil edin, sistem h…ôft…ôlik d…ôrs c…ôdv…ôlini
        avtomatik yerl…ô≈üdirm…ôy…ô c…ôhd ed…ôc…ôk. Bu versiya sad…ô greedy alqoritm istifad…ô edir,
        tam ASC Timetable s…ôviyy…ôsind…ô optimalla≈üdƒ±rma etmir.
      </p>
    </section>

    <!-- Panel -->
    <section class="add-shadow">
      <div class="panel-card bg-white shadow-sm hover:shadow-md transition" id="tt-card">
        <div class="p-4 border-b flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <h3 class="font-semibold">M…ôlumat giri≈üi</h3>
          <div class="flex flex-wrap gap-2">
            <button id="btn-generate" class="ep-btn-primary text-xs sm:text-sm">
              C…ôdv…ôli hazƒ±rla
            </button>
            <button id="btn-reset-data" class="ep-btn-secondary text-xs sm:text-sm" type="button">
              M…ôlumatƒ± sƒ±fƒ±rla
            </button>
          </div>
        </div>

        <div class="px-4 pt-3 pb-4 space-y-6">
          <!-- M√º…ôlliml…ôr paneli -->
          <div class="grid lg:grid-cols-2 gap-4">
            <div>
              <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-100 mb-1">
                M√º…ôlliml…ôr v…ô m…ôhdudiyy…ôtl…ôr
              </h4>
              <p class="text-xs text-slate-500 mb-3">
                Sad…ô n√ºmun…ô m√º…ôllim siyahƒ±sƒ±. Lazƒ±m olduqca JS-d…ô ‚Äúteachers‚Äù massivin…ô √∂z
                m√º…ôlliml…ôrinizi …ôlav…ô ed…ô bil…ôrsiniz. A≈üaƒüƒ±da h…ôr bir m√º…ôllim √º√ß√ºn
                <span class="font-medium">g…ôlm…ô g√ºnl…ôrini</span> i≈üar…ôl…ôy…ô bil…ôrsiniz.
              </p>
              <div id="teacher-list" class="space-y-3"></div>
            </div>

            <!-- D…ôrs s…ôtirl…ôri paneli -->
            <div>
              <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-100 mb-1">
                D…ôrsl…ôr (sinif ¬∑ f…ônn ¬∑ m√º…ôllim ¬∑ h…ôft…ôlik saat)
              </h4>
              <p class="text-xs text-slate-500 mb-3">
                M…ôs…ôl…ôn: ‚Äú5A ¬∑ Riyaziyyat ¬∑ Rauf m√º…ôllim ¬∑ 4 saat‚Äù. H…ôr …ôlav…ô etdiyiniz s…ôtir
                √º√ß√ºn sistem h…ôft…ô …ôrzind…ô uyƒüun slotlar tapmaƒüa √ßalƒ±≈üacaq.
              </p>

              <!-- D…ôrs …ôlav…ô formu -->
              <div class="rounded-xl border border-slate-200 p-3 space-y-2">
                <div class="grid grid-cols-2 gap-2 mb-1">
                  <div>
                    <label class="block text-xs text-slate-500 mb-1">Sinif</label>
                    <input id="in-class" type="text" placeholder="m…ôs: 5A"
                           class="w-full rounded-lg border border-slate-200 px-2 py-1.5 text-sm bg-transparent">
                  </div>
                  <div>
                    <label class="block text-xs text-slate-500 mb-1">F…ônn</label>
                    <input id="in-subject" type="text" placeholder="m…ôs: Riyaziyyat"
                           class="w-full rounded-lg border border-slate-200 px-2 py-1.5 text-sm bg-transparent">
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="block text-xs text-slate-500 mb-1">M√º…ôllim</label>
                    <select id="in-teacher"
                            class="w-full rounded-lg border border-slate-200 px-2 py-1.5 text-sm bg-transparent">
                      <!-- JS il…ô doldurulacaq -->
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs text-slate-500 mb-1">H…ôft…ôlik saat</label>
                    <input id="in-hours" type="number" min="1" max="40" value="1"
                           class="w-full rounded-lg border border-slate-200 px-2 py-1.5 text-sm bg-transparent">
                  </div>
                </div>

                <div class="flex justify-end pt-2">
                  <button id="btn-add-lesson" class="ep-btn-secondary text-xs" type="button">
                    S…ôtir …ôlav…ô et
                  </button>
                </div>
              </div>

              <!-- D…ôrs siyahƒ±sƒ± -->
              <div class="mt-3">
                <div class="flex items-center justify-between mb-1">
                  <span class="text-xs text-slate-500">Daxil edilmi≈ü d…ôrsl…ôr</span>
                  <span id="lessons-count" class="text-xs text-slate-500">0 s…ôtir</span>
                </div>
                <div class="rounded-xl border border-slate-200 max-h-60 overflow-auto">
                  <table class="min-w-full text-xs">
                    <thead class="bg-slate-50 dark:bg-slate-900/40">
                      <tr>
                        <th class="px-2 py-1 text-left">Sinif</th>
                        <th class="px-2 py-1 text-left">F…ônn</th>
                        <th class="px-2 py-1 text-left">M√º…ôllim</th>
                        <th class="px-2 py-1 text-center">Saat / h…ôft…ô</th>
                      </tr>
                    </thead>
                    <tbody id="lessons-table-body" class="divide-y divide-slate-100 dark:divide-slate-800">
                      <tr id="lessons-empty-row">
                        <td colspan="4" class="px-2 py-3 text-center text-slate-400 text-[11px]">
                          H…ôl…ô he√ß bir s…ôtir …ôlav…ô olunmayƒ±b.
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div id="tt-errors" class="mt-2 text-[11px] text-rose-500 hidden"></div>
            </div>
          </div>

          <!-- N…ôtic…ô paneli -->
          <div class="border-t border-slate-200 pt-4">
            <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-100 mb-2">
              N…ôtic…ô: d…ôrs c…ôdv…ôll…ôri
            </h4>
            <p class="text-xs text-slate-500 mb-3">
              M√ºmk√ºn olan yerd…ô d…ôrsl…ôr yerl…ô≈üdirilir. ∆èg…ôr hansƒ±sa s…ôtir √º√ß√ºn uyƒüun slot tapƒ±lmasa,
              altda ‚Äúyerl…ô≈üdirilm…ôy…ônl…ôr‚Äù siyahƒ±sƒ±nda g√∂r√ºn…ôc…ôk.
            </p>

            <!-- Sinif tablarƒ± -->
            <div id="class-tabs" class="flex flex-wrap gap-1 mb-3"></div>

            <!-- C…ôdv…ôl preview -->
            <div id="timetable-container"
                 class="rounded-xl border border-slate-200 p-3 overflow-auto hidden">
            </div>

            <!-- Unplaced lessons -->
            <div id="unplaced-container" class="mt-4 hidden">
              <h5 class="text-xs font-semibold text-amber-700 dark:text-amber-400 mb-1">
                Yerl…ô≈üdiril…ô bilm…ôy…ôn d…ôrsl…ôr
              </h5>
              <ul id="unplaced-list" class="text-[11px] text-slate-600 dark:text-slate-300 list-disc pl-4 space-y-1"></ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Info -->
    <section class="mt-10 relative z-[1]">
      <h2 class="text-2xl sm:text-3xl font-semibold mb-4">Qeyd</h2>
      <div class="space-y-3 text-base leading-7 text-slate-700 dark:text-slate-300">
        <p class="text-sm">
          Bu generator Az…ôrbaycan orta m…ôkt…ôbl…ôrinin tipik strukturu n…ôz…ôr…ô alƒ±naraq hazƒ±rlanƒ±b:
          1‚Äì11 sinif, h…ôft…ô i√ßi 5 g√ºn, g√ºnd…ô maksimum 8 d…ôrs saatƒ±. Alqoritm hazƒ±rda sad…ô
          ‚Äúgreedy‚Äù yana≈ümadan istifad…ô edir v…ô d…ôrin optimalla≈üdƒ±rma (tam ASC Timetable s…ôviyy…ôsind…ô)
          etmir, amma m√º…ôllimin eyni anda iki sinifd…ô olmasƒ±, h…ôft…ôlik / g√ºnl√ºk limitl…ôr v…ô
          g…ôlm…ô g√ºnl…ôri m…ôhdudiyy…ôtl…ôrini n…ôz…ôr…ô alƒ±r.
        </p>
        <p class="text-sm">
          G…ôl…ôc…ôkd…ô …ôlav…ô m…ôhdudiyy…ôtl…ôr (m…ôs…ôl…ôn, ardƒ±cƒ±l d…ôrsl…ôrd…ôn qa√ßma, son saatdan qa√ßma,
          ibtidai sinifl…ôrin s…ôh…ôr, yuxarƒ± sinifl…ôrin daha gec saatlara yerl…ô≈üdirilm…ôsi v…ô s.)
          √ºz…ôrind…ô geni≈ül…ôndirm…ô etm…ôk m√ºmk√ºnd√ºr.
        </p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="mt-12 border-t border-slate-200/70 dark:border-slate-700/60">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4 text-sm text-slate-600 dark:text-slate-400">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <div class="footer-text text-center sm:text-left leading-6">
          <span class="chunk">¬© <span id="year"></span> <span class="font-medium text-slate-700 dark:text-slate-300">EduPlan AZ</span></span>
          <span class="chunk"> ¬∑ B√ºt√ºn h√ºquqlar qorunur</span>
        </div>
        <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
          <a href="/about.html"   class="hover:underline">Haqqƒ±mƒ±zda</a>
          <a href="/terms.html"   class="hover:underline">≈û…ôrtl…ôr</a>
          <a href="/privacy.html" class="hover:underline">M…ôxfilik</a>
        </nav>
      </div>
    </div>
  </footer>

  <!-- JS -->
  <script>
    /* ========== Tema (PP/KSQ il…ô ox≈üar) ========== */
    const settingsBtn = document.getElementById('btn-settings');
    const settingsPanel = document.getElementById('settings-panel');
    const darkToggle = document.getElementById('dark-toggle');
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    const savedTheme = localStorage.getItem('theme');
    const initialTheme = savedTheme ? savedTheme : (mq.matches ? 'dark' : 'light');

    document.documentElement.classList.toggle('dark', initialTheme === 'dark');
    if (darkToggle) darkToggle.checked = (initialTheme === 'dark');
    applyThemeAssets(initialTheme);

    document.addEventListener('click', (e) => {
      if (!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
        settingsPanel.classList.add('hidden');
      }
    });
    settingsBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      settingsPanel.classList.toggle('hidden');
    });
    darkToggle?.addEventListener('change', (e) => {
      const theme = e.target.checked ? 'dark' : 'light';
      document.documentElement.classList.toggle('dark', theme === 'dark');
      localStorage.setItem('theme', theme);
      applyThemeAssets(theme);
    });
    mq.addEventListener?.('change', (e) => {
      if (!localStorage.getItem('theme')) {
        const theme = e.matches ? 'dark' : 'light';
        document.documentElement.classList.toggle('dark', theme === 'dark');
        if (darkToggle) darkToggle.checked = (theme === 'dark');
        applyThemeAssets(theme);
      }
    });
    function applyThemeAssets(theme){
      const logo = document.getElementById('site-logo');
      if (logo) logo.src = theme === 'dark' ? 'assets/ep-favicon-dark.svg' : 'assets/ep-favicon-light.svg';
    }
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ========== D…ôrs c…ôdv…ôli loqikasƒ± ========== */

    // H…ôft…ô g√ºnl…ôri (daxili key + ekranda label)
    const WEEK_DAYS = [
      { key: 'Mon', label: 'B.e' },
      { key: 'Tue', label: '√á.a' },
      { key: 'Wed', label: '√á' },
      { key: 'Thu', label: 'C.a' },
      { key: 'Fri', label: 'C' },
      // ≈û…ônb…ô lazƒ±m olsa:
      // { key: 'Sat', label: '≈û' },
    ];
    const MAX_PERIODS_PER_DAY = 8;

    // N√ºmun…ô m√º…ôlliml…ôr ‚Äì s…ôn sonra JS-d…ô bu massiv…ô √∂zl…ôrini …ôlav…ô ed…ô bil…ôrs…ôn
    const teachers = [
      {
        id: 't1',
        name: 'Ayg√ºn m√º…ôllim…ô',
        subjects: ['Az…ôrbaycan dili', '∆èd…ôbiyyat'],
        maxPerDay: 6,
        maxPerWeek: 30,
        availableDays: WEEK_DAYS.map(d => d.key) // b√ºt√ºn g√ºnl…ôr
      },
      {
        id: 't2',
        name: 'Rauf m√º…ôllim',
        subjects: ['Riyaziyyat'],
        maxPerDay: 5,
        maxPerWeek: 25,
        // M…ôs: yalnƒ±z √á.a v…ô C.a g…ôl…ô bil…ôr:
        availableDays: ['Tue', 'Thu']
      },
      {
        id: 't3',
        name: 'Sevinc m√º…ôllim…ô',
        subjects: ['ƒ∞ngilis dili'],
        maxPerDay: 5,
        maxPerWeek: 24,
        availableDays: WEEK_DAYS.map(d => d.key)
      }
    ];

    // State
    const state = {
      lessons: [],         // { id, classId, subject, teacherId, hoursPerWeek }
      timetable: {},       // classId -> [day][slot] = {subject, teacherName}
      unplaced: []         // d…ôrsl…ôrd…ôn yerl…ô≈üdiril…ô bilm…ôy…ônl…ôr
    };

    const $ = (sel) => document.querySelector(sel);

    /* ---------- M√º…ôllim paneli ---------- */
    function renderTeachers(){
      const container = $('#teacher-list');
      if (!container) return;

      container.innerHTML = teachers.map(t => renderTeacherCard(t)).join('');

      // Teacher day checkbox eventl…ôri
      container.querySelectorAll('.tt-day-checkbox').forEach(ch => {
        ch.addEventListener('change', onTeacherDayChange);
      });

      // D…ôrs …ôlav…ô formundakƒ± m√º…ôllim select-i doldur
      const sel = $('#in-teacher');
      if (sel) {
        sel.innerHTML = teachers.map(t =>
          `<option value="${t.id}">${t.name}</option>`
        ).join('');
      }
    }

    function renderTeacherCard(teacher){
      const daysHtml = WEEK_DAYS.map(d => {
        const checked = (teacher.availableDays || []).includes(d.key) ? 'checked' : '';
        return `
          <label class="tt-day-pill">
            <input type="checkbox"
                   class="tt-day-checkbox"
                   data-teacher-id="${teacher.id}"
                   data-day="${d.key}"
                   ${checked}>
            <span>${d.label}</span>
          </label>
        `;
      }).join(' ');

      return `
        <div class="rounded-xl border border-slate-200 p-3 bg-white/80 dark:bg-slate-900/60">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 mb-2">
            <div class="font-medium text-sm">${teacher.name}</div>
            <div class="text-[11px] text-slate-500">
              G√ºnl√ºk max: ${teacher.maxPerDay} ¬∑ H…ôft…ôlik max: ${teacher.maxPerWeek}
            </div>
          </div>
          <div class="text-[11px] text-slate-500 mb-2">
            F…ônl…ôr: ${teacher.subjects.join(', ')}
          </div>
          <div>
            <div class="text-[11px] text-slate-500 mb-1">G…ôlm…ô g√ºnl…ôri:</div>
            <div class="flex flex-wrap gap-1">
              ${daysHtml}
            </div>
          </div>
        </div>
      `;
    }

    function onTeacherDayChange(e){
      const teacherId = e.target.dataset.teacherId;
      const dayKey = e.target.dataset.day;
      const teacher = teachers.find(t => String(t.id) === String(teacherId));
      if (!teacher) return;

      if (!teacher.availableDays) {
        teacher.availableDays = WEEK_DAYS.map(d => d.key);
      }

      if (e.target.checked) {
        if (!teacher.availableDays.includes(dayKey)) {
          teacher.availableDays.push(dayKey);
        }
      } else {
        teacher.availableDays = teacher.availableDays.filter(d => d !== dayKey);
      }
    }

    /* ---------- D…ôrs s…ôtirl…ôri ---------- */
    let lessonIdSeq = 1;

    function addLessonFromForm(){
      const classInput = $('#in-class');
      const subjectInput = $('#in-subject');
      const teacherSelect = $('#in-teacher');
      const hoursInput = $('#in-hours');
      const errors = $('#tt-errors');

      const classId = (classInput.value || '').trim();
      const subject = (subjectInput.value || '').trim();
      const teacherId = teacherSelect?.value;
      const hours = Number(hoursInput.value || 0);

      errors.classList.add('hidden');
      errors.textContent = '';

      if (!classId || !subject || !teacherId || !hours || hours <= 0) {
        errors.textContent = 'Z…ôhm…ôt olmasa sinif, f…ônn, m√º…ôllim v…ô h…ôft…ôlik saat d…ôy…ôrl…ôrini d√ºzg√ºn doldurun.';
        errors.classList.remove('hidden');
        return;
      }

      state.lessons.push({
        id: 'L' + (lessonIdSeq++),
        classId,
        subject,
        teacherId,
        hoursPerWeek: hours
      });

      classInput.value = '';
      subjectInput.value = '';
      hoursInput.value = 1;

      renderLessonsTable();
    }

    function renderLessonsTable(){
      const tbody = $('#lessons-table-body');
      const countSpan = $('#lessons-count');
      if (!tbody) return;

      if (!state.lessons.length) {
        tbody.innerHTML = `
          <tr id="lessons-empty-row">
            <td colspan="4" class="px-2 py-3 text-center text-slate-400 text-[11px]">
              H…ôl…ô he√ß bir s…ôtir …ôlav…ô olunmayƒ±b.
            </td>
          </tr>
        `;
        countSpan.textContent = '0 s…ôtir';
        return;
      }

      tbody.innerHTML = state.lessons.map(l => {
        const t = teachers.find(x => x.id === l.teacherId);
        const teacherName = t ? t.name : l.teacherId;
        return `
          <tr>
            <td class="px-2 py-1">${l.classId}</td>
            <td class="px-2 py-1">${l.subject}</td>
            <td class="px-2 py-1">${teacherName}</td>
            <td class="px-2 py-1 text-center">${l.hoursPerWeek}</td>
          </tr>
        `;
      }).join('');

      countSpan.textContent = state.lessons.length + ' s…ôtir';
    }

    function resetData(){
      state.lessons = [];
      state.timetable = {};
      state.unplaced = [];
      renderLessonsTable();
      renderTimetableOutput();
      $('#tt-errors').classList.add('hidden');
      $('#tt-errors').textContent = '';
    }

    /* ---------- Generator (sad…ô greedy) ---------- */

    function generateTimetable(){
      const errors = $('#tt-errors');
      errors.classList.add('hidden');
      errors.textContent = '';

      if (!state.lessons.length) {
        errors.textContent = '∆èvv…ôlc…ô …ôn azƒ± bir d…ôrs s…ôtiri …ôlav…ô edin.';
        errors.classList.remove('hidden');
        return;
      }

      // Teacher availability default
      teachers.forEach(t => {
        if (!t.availableDays || !t.availableDays.length) {
          t.availableDays = WEEK_DAYS.map(d => d.key);
        }
      });

      // Unique classlar
      const classIds = Array.from(new Set(state.lessons.map(l => l.classId)));

      // Timetable strukturlarƒ±nƒ± hazƒ±rla
      const tt = {};     // classId -> [day][slot]
      const tStats = {}; // teacherId -> stats

      classIds.forEach(cid => {
        tt[cid] = [];
        for (let d = 0; d < WEEK_DAYS.length; d++) {
          tt[cid][d] = new Array(MAX_PERIODS_PER_DAY).fill(null);
        }
      });

      teachers.forEach(t => {
        tStats[t.id] = {
          weeklyCount: 0,
          perDay: Array(WEEK_DAYS.length).fill(0),
          slots: Array(WEEK_DAYS.length).fill(null).map(
            () => new Array(MAX_PERIODS_PER_DAY).fill(false)
          )
        };
      });

      // D…ôrsl…ôri slotlara par√ßala: h…ôr 1 saat = 1 ‚Äúunit‚Äù
      const units = [];
      for (const l of state.lessons) {
        for (let i = 0; i < l.hoursPerWeek; i++) {
          units.push({
            lessonId: l.id,
            classId: l.classId,
            subject: l.subject,
            teacherId: l.teacherId
          });
        }
      }

      // Daha √ß…ôtin olanlarƒ± √∂n…ô √ß…ôk: (m…ôs…ôl…ôn, h…ôft…ôlik saatƒ± √ßox olan m√º…ôllim)
      units.sort((a, b) => {
        const tA = teachers.find(t => t.id === a.teacherId);
        const tB = teachers.find(t => t.id === b.teacherId);
        const wA = tA ? tA.maxPerWeek : 0;
        const wB = tB ? tB.maxPerWeek : 0;
        return wA - wB; // daha az kapasiteli m√º…ôlliml…ôri √∂n…ô √ß…ôk
      });

      const unplaced = [];

      // Yardƒ±m√ßƒ±: teacher v…ô class √º√ß√ºn slot m√ºmk√ºnm√º?
      function canPlace(u, dayIndex, slotIndex){
        const teacher = teachers.find(t => t.id === u.teacherId);
        if (!teacher) return false;

        const dayKey = WEEK_DAYS[dayIndex].key;
        if (!teacher.availableDays.includes(dayKey)) return false;

        const stats = tStats[teacher.id];
        if (stats.weeklyCount >= teacher.maxPerWeek) return false;
        if (stats.perDay[dayIndex] >= teacher.maxPerDay) return false;

        // M√º…ôllim h…ômin saat, h…ômin g√ºnd…ô ba≈üqa sinifd…ôdir?
        if (stats.slots[dayIndex][slotIndex]) return false;

        // Sinif h…ômin g√ºnd…ô/h…ômin yerd…ô artƒ±q d…ôrs…ô malikdir?
        if (tt[u.classId][dayIndex][slotIndex] !== null) return false;

        return true;
      }

      function placeUnit(u){
        // B.e ‚Üí C ardƒ±cƒ±llƒ±qla yoxla
        for (let d = 0; d < WEEK_DAYS.length; d++){
          for (let s = 0; s < MAX_PERIODS_PER_DAY; s++){
            if (canPlace(u, d, s)){
              const teacher = teachers.find(t => t.id === u.teacherId);
              const stats = tStats[teacher.id];

              tt[u.classId][d][s] = {
                subject: u.subject,
                teacherName: teacher.name
              };
              stats.weeklyCount++;
              stats.perDay[d]++;
              stats.slots[d][s] = true;
              return true;
            }
          }
        }
        return false;
      }

      for (const u of units){
        const ok = placeUnit(u);
        if (!ok) {
          unplaced.push(u);
        }
      }

      state.timetable = tt;
      state.unplaced = unplaced;
      renderTimetableOutput();
    }

    /* ---------- N…ôtic…ôni render et ---------- */

    function renderTimetableOutput(){
      const container = $('#timetable-container');
      const tabs = $('#class-tabs');
      const unplacedBox = $('#unplaced-container');
      const unplacedList = $('#unplaced-list');

      const classIds = Object.keys(state.timetable);

      if (!classIds.length){
        container.classList.add('hidden');
        tabs.innerHTML = '';
        unplacedBox.classList.add('hidden');
        return;
      }

      // Tabs
      tabs.innerHTML = classIds.map((cid, idx) => `
        <button class="tt-tab-btn ${idx === 0 ? 'active' : ''}"
                data-class-id="${cid}">
          ${cid}
        </button>
      `).join('');

      tabs.querySelectorAll('.tt-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          tabs.querySelectorAll('.tt-tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const cid = btn.dataset.classId;
          renderClassTimetable(cid);
        });
      });

      // ƒ∞lk sinif √º√ß√ºn render
      renderClassTimetable(classIds[0]);
      container.classList.remove('hidden');

      // Unplaced
      if (state.unplaced.length){
        unplacedBox.classList.remove('hidden');
        unplacedList.innerHTML = state.unplaced.map(u => {
          const t = teachers.find(x => x.id === u.teacherId);
          const name = t ? t.name : u.teacherId;
          return `<li>${u.classId} ¬∑ ${u.subject} ¬∑ ${name}</li>`;
        }).join('');
      }else{
        unplacedBox.classList.add('hidden');
        unplacedList.innerHTML = '';
      }
    }

    function renderClassTimetable(classId){
      const container = $('#timetable-container');
      const grid = state.timetable[classId];
      if (!grid) {
        container.innerHTML = '<div class="text-xs text-slate-500">Bu sinif √º√ß√ºn m…ôlumat tapƒ±lmadƒ±.</div>';
        return;
      }

      let html = '<div class="overflow-auto"><table class="tt-table w-full border-collapse text-xs">';
      // Header
      html += '<thead><tr><th>Saat</th>';
      WEEK_DAYS.forEach(d => {
        html += `<th>${d.label}</th>`;
      });
      html += '</tr></thead><tbody>';

      for (let s = 0; s < MAX_PERIODS_PER_DAY; s++){
        html += `<tr><th>${s+1}</th>`;
        for (let d = 0; d < WEEK_DAYS.length; d++){
          const cell = grid[d][s];
          if (cell){
            html += `<td><div class="font-medium">${cell.subject}</div><div class="text-[10px] text-slate-500">${cell.teacherName}</div></td>`;
          }else{
            html += `<td><span class="tt-slot-empty">‚Äî</span></td>`;
          }
        }
        html += '</tr>';
      }

      html += '</tbody></table></div>';
      container.innerHTML = html;
    }

    /* ---------- Init ---------- */
    document.addEventListener('DOMContentLoaded', () => {
      renderTeachers();
      renderLessonsTable();

      $('#btn-add-lesson')?.addEventListener('click', addLessonFromForm);
      $('#btn-reset-data')?.addEventListener('click', resetData);
      $('#btn-generate')?.addEventListener('click', generateTimetable);
    });
  </script>

</body>
</html>
