<!doctype html>
<html lang="az" class="scroll-smooth">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-M3CQTM2P');</script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="canonical" href="https://www.eduplan.az/timetable.html" />
  <meta name="keywords" content="DÉ™rs cÉ™dvÉ™linin hazÄ±rlanmasÄ±, DÉ™rs cÉ™dvÉ™li qurmaq Ã¼Ã§Ã¼n proqram, Orta mÉ™ktÉ™blÉ™rdÉ™ dÉ™rs cÉ™dvÉ™li, DÉ™rs cÉ™dvÉ™li proqramÄ±, dÉ™rs cÉ™dvÉ™li qurmaq Ã¼Ã§Ã¼n proqram yÃ¼klÉ™, 
      DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ±, Online DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ±, Onlayn DÉ™rs cÉ™dvÉ™li hazrÄ±layÄ±cÄ±" />
  <meta name="description" content="AzÉ™rbaycan orta mÉ™ktÉ™blÉ™ri Ã¼Ã§Ã¼n onlayn DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ± â€” mÃ¼É™llim, sinif vÉ™ fÉ™nn mÉ™lumatlarÄ±nÄ± daxil edin, sistem avtomatik cÉ™dvÉ™l qursun.">
  <meta name="robots" content="index, follow" />
  <meta name="author" content="EduPlan.az" />
  <meta name="language" content="az" />
  <meta name="format-detection" content="telephone=no" />
  <title>DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ± â€” EduPlan</title>

  <meta name="theme-color" content="#f8fafc" id="theme-color" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ± â€” EduPlan" />
  <meta property="og:description" content="MÃ¼É™llim vÉ™ sinif mÉ™lumatlarÄ±nÄ± daxil edin, sistem avtomatik dÉ™rs cÉ™dvÉ™li hazÄ±rlasÄ±n." />
  <meta property="og:image" content="https://www.eduplan.az/assets/og-image.jpg" />
  <meta property="og:url" content="https://www.eduplan.az/timetable.html" />
  <meta property="og:site_name" content="EduPlan" />

  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="logo.svg">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="favicon-48x48.png" sizes="48x48">
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="android-chrome-512x512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0ea5e9">
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Tema: FOUC olmasÄ±n (Tailwind-dÉ™n É™vvÉ™l) -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = (saved === 'dark' || saved === 'light') ? saved : (systemDark ? 'dark' : 'light');

        const root = document.documentElement;
        root.classList.toggle('dark', theme === 'dark');
        root.dataset.theme = theme;

        const meta = document.getElementById('theme-color');
        if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b1220' : '#f8fafc');
      } catch (e) {}
    })();
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <style>
    html, body { overflow-x: hidden; }
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }
    html { scroll-padding-top: 80px; }

    .ep-btn-primary{ background: linear-gradient(90deg,#1e3a8a 0%,#4f46e5 50%,#9333ea 100%); }
    html.dark .ep-btn-primary{ background: linear-gradient(90deg,#312e81 0%,#4338ca 50%,#7e22ce 100%); }

    :root{
      --ep-field-h: 42px;
      --ep-field-h-sm: 36px;

      --ep-radius-lg: 1rem;
      --ep-radius-sm: .95rem;

      --ep-rail-w: clamp(160px, 14vw, 300px);
      --ep-rail-min-h: 600px;
      --ep-rail-gap: 24px;

      --ep-center-max: 1100px;
      --ep-shell-max: 1600px;
      --ep-frame-max: 80rem;

      --ep-bg-from: #f8fafc;
      --ep-bg-mid:  #eef2ff;
      --ep-bg-to:   #ecfeff;

      --ep-surface: linear-gradient(180deg, rgba(255,255,255,.86), rgba(238,242,255,.60));
      --ep-surface-2: linear-gradient(180deg, rgba(255,255,255,.84), rgba(241,245,249,.64));

      --ep-border: rgba(79,70,229,.12);
      --ep-panel-border: rgba(79,70,229,.28);

      --ep-mode-idle-bg: linear-gradient(180deg, rgba(255,255,255,.88), rgba(238,242,255,.70));
      --ep-mode-idle-border: rgba(79,70,229,.16);
      --ep-mode-hover-bg: linear-gradient(180deg, rgba(255,255,255,.92), rgba(224,231,255,.78));

      --ep-mode-active-bg: linear-gradient(90deg, rgba(30,58,138,.10), rgba(79,70,229,.12), rgba(147,51,234,.10));
      --ep-mode-active-border: rgba(79,70,229,.55);
      --ep-mode-active-shadow: 0 10px 24px rgba(79,70,229,.16), 0 2px 8px rgba(15,23,42,.06);

      --ep-focus: rgba(79,70,229,.28);
    }

    html.dark{
      --ep-bg-from: #020617;
      --ep-bg-mid:  #0b1220;
      --ep-bg-to:   #0f172a;

      --ep-surface: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      --ep-surface-2: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));

      --ep-border: rgba(148,163,184,.18);
      --ep-panel-border: rgba(99,102,241,.18);

      --ep-mode-idle-bg: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      --ep-mode-idle-border: rgba(148,163,184,.16);
      --ep-mode-hover-bg: linear-gradient(180deg, rgba(15,23,42,.78), rgba(15,23,42,.62));

      --ep-mode-active-bg: linear-gradient(90deg, rgba(49,46,129,.45), rgba(67,56,202,.40), rgba(126,34,206,.35));
      --ep-mode-active-border: rgba(99,102,241,.55);
      --ep-mode-active-shadow: 0 12px 30px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06);

      --ep-focus: rgba(99,102,241,.34);
    }

    body{
      background-image: linear-gradient(to bottom, var(--ep-bg-from), var(--ep-bg-mid) 45%, var(--ep-bg-to)) !important;
    }

    #tt-panel{
      background: var(--ep-surface) !important;
      border-color: var(--ep-panel-border) !important;
      box-shadow: 0 18px 60px rgba(15,23,42,.08);
      overflow: hidden;
    }
    html.dark #tt-panel{ box-shadow: 0 18px 70px rgba(0,0,0,.55); }

    #tt-panel > div:first-child{
      background: linear-gradient(90deg, rgba(79,70,229,.10), rgba(16,185,129,.08), rgba(245,158,11,.08));
    }
    html.dark #tt-panel > div:first-child{
      background: linear-gradient(90deg, rgba(99,102,241,.12), rgba(16,185,129,.09), rgba(245,158,11,.09));
    }

    .ep-card{
      background: var(--ep-surface-2) !important;
      border-color: var(--ep-border) !important;
      box-shadow: 0 12px 34px rgba(15,23,42,.06);
    }
    html.dark .ep-card{ box-shadow: 0 14px 40px rgba(0,0,0,.40); }

    .ep-btn-secondary{
      background: var(--ep-mode-idle-bg) !important;
      border-color: var(--ep-mode-idle-border) !important;
      box-shadow: 0 8px 20px rgba(15,23,42,.06);
      transition: transform 160ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;
    }
    html.dark .ep-btn-secondary{ box-shadow: 0 10px 26px rgba(0,0,0,.35); }

    .ep-btn-secondary:hover{ background: var(--ep-mode-hover-bg) !important; transform: translateY(-1px); }
    .ep-btn-secondary:active{ transform: translateY(0px); }

    .ep-btn-secondary:focus-visible{
      outline: none !important;
      box-shadow: 0 0 0 4px var(--ep-focus), 0 12px 28px rgba(15,23,42,.06) !important;
    }
    html.dark .ep-btn-secondary:focus-visible{
      box-shadow: 0 0 0 4px var(--ep-focus), 0 14px 34px rgba(0,0,0,.45) !important;
    }

    input[type="text"], input[type="number"], select {
      width: 100%;
      border-radius: var(--ep-radius-lg);
      border: 1px solid rgba(226,232,240,.75);
      background-color: rgba(255,255,255,.82);
      padding: .58rem .9rem;
      font-size: 13px;
      line-height: 1.35;
      min-height: var(--ep-field-h);
      outline: none;
      transition: background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
    }

    html.dark input[type="text"], html.dark input[type="number"], html.dark select {
      border-color: rgba(30,41,59,.7);
      background-color: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }

    input[type="text"]::placeholder, input[type="number"]::placeholder { color: rgb(148,163,184); }

    input[type="text"]:focus, input[type="number"]:focus, select:focus{
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.22);
    }

    select{
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding-right: 2.25rem;
      background-repeat: no-repeat;
      background-position: right .75rem center;
      background-size: 1rem 1rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    }
    html.dark select{
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%23cbd5e1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    select option, select optgroup{
      color: #0f172a;
      background-color: #ffffff;
    }

    input[type="checkbox"]{ accent-color: rgb(99,102,241); }

    .section-title{
      font-size:.8rem;
      font-weight:700;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgb(100 116 139);
    }
    html.dark .section-title{ color: rgb(148 163 184); }

    table.config-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 8px;
      font-size:.78rem;
    }
    table.config-table th{
      text-align:left;
      font-weight:600;
      color: rgb(100 116 139);
      padding: 4px 6px;
      font-size: .72rem;
      white-space: normal;
      line-height: 1.15;
    }
    html.dark table.config-table th{ color: rgb(148 163 184); }
    table.config-table td{
      padding: 4px 6px;
      vertical-align: top;
      overflow: visible;
    }

    table.config-table input, table.config-table select{
      padding: .44rem .64rem;
      border-radius: var(--ep-radius-sm);
      min-height: var(--ep-field-h-sm);
      font-size: 12.5px;
      line-height: 1.35;
    }

    #teacherTable{ table-layout: fixed; width: 100%; min-width: 0; }
    #teacherTable th:nth-child(1), #teacherTable td:nth-child(1){ width: 20%; }
    #teacherTable th:nth-child(2), #teacherTable td:nth-child(2){ width: 8%; }
    #teacherTable th:nth-child(3), #teacherTable td:nth-child(3){ width: 10%; }
    #teacherTable th:nth-child(4), #teacherTable td:nth-child(4){ width: 9%; }
    #teacherTable th:nth-child(5), #teacherTable td:nth-child(5){ width: 22%; }
    #teacherTable th:nth-child(6), #teacherTable td:nth-child(6){ width: 26%; }
    #teacherTable th:nth-child(7), #teacherTable td:nth-child(7){ width: 5%; }

    .t-days{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      font-size: 11px;
      line-height: 1.2;
    }
    .t-days label{
      display:inline-flex;
      align-items:center;
      gap:4px;
      white-space: nowrap;
    }

    .t-hours{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      font-size: 11px;
      line-height: 1.2;
    }
    .t-hours label{
      display:inline-flex;
      align-items:center;
      gap:4px;
      white-space: nowrap;
    }

    .t-mini-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom: 6px;
    }
    .t-mini-btn{
      border: 1px solid rgba(226,232,240,.75);
      background: rgba(255,255,255,.55);
      border-radius: .75rem;
      padding: .18rem .48rem;
      font-size: 11px;
      line-height: 1.2;
      cursor: pointer;
      transition: background-color .12s ease, border-color .12s ease, transform .06s ease;
      user-select:none;
    }
    .t-mini-btn:hover{ background: rgba(255,255,255,.80); }
    .t-mini-btn:active{ transform: translateY(1px); }
    html.dark .t-mini-btn{
      border-color: rgba(30,41,59,.7);
      background: rgba(255,255,255,.04);
      color: rgb(226,232,240);
    }
    html.dark .t-mini-btn:hover{ background: rgba(255,255,255,.07); }

    #classTable, #lessonTable{ table-layout: fixed; width:100%; min-width:0; }
    #classTable th:nth-child(1), #classTable td:nth-child(1){ width: 18%; }
    #classTable th:nth-child(2), #classTable td:nth-child(2){ width: 28%; }
    #classTable th:nth-child(3), #classTable td:nth-child(3){ width: 18%; }
    #classTable th:nth-child(4), #classTable td:nth-child(4){ width: 26%; }
    #classTable th:nth-child(5), #classTable td:nth-child(5){ width: 10%; }

    #lessonTable th:nth-child(1), #lessonTable td:nth-child(1){ width: 15%; }
    #lessonTable th:nth-child(2), #lessonTable td:nth-child(2){ width: 28%; }
    #lessonTable th:nth-child(3), #lessonTable td:nth-child(3){ width: 23%; }
    #lessonTable th:nth-child(4), #lessonTable td:nth-child(4){ width: 12%; }
    #lessonTable th:nth-child(5), #lessonTable td:nth-child(5){ width: 6%; }
    #lessonTable th:nth-child(6), #lessonTable td:nth-child(6){ width: 14%; }
    #lessonTable th:nth-child(7), #lessonTable td:nth-child(7){ width: 2%; }

    .tab-btn{
      border-radius: 9999px;
      padding: .3rem .8rem;
      font-size: .78rem;
      border: 1px solid transparent;
      background: transparent;
      cursor: pointer;
      white-space: nowrap;
      transition: background-color .15s ease, border-color .15s ease, color .15s ease, box-shadow .15s ease;
    }
    .tab-btn:hover{ background: rgba(15,23,42,.04); }
    html.dark .tab-btn:hover{ background: rgba(255,255,255,.06); }

    .tab-btn.active{
      border-color: var(--ep-mode-active-border);
      background: rgba(99,102,241,.10);
      color: rgb(67 56 202);
      font-weight: 600;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    html.dark .tab-btn.active{
      background: rgba(129,140,248,.12);
      color: rgb(226 232 240);
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }

    .tt-table{
      width:100%;
      border-collapse:collapse;
      font-size:.78rem;
      overflow: hidden;
      border-radius: 1rem;
    }
    .tt-table th, .tt-table td{
      border: 1px solid rgba(226,232,240,.75);
      padding: .35rem .45rem;
      text-align:center;
    }
    html.dark .tt-table th, html.dark .tt-table td{
      border-color: rgba(51,65,85,.9);
    }
    .tt-table th{
      background: rgba(148,163,184,.14);
      font-weight: 700;
      font-size: .75rem;
    }
    html.dark .tt-table th{ background: rgba(15,23,42,.7); }

    .tt-slot-muted{ color: rgb(148 163 184); font-style: italic; }
    html.dark .tt-slot-muted{ color: rgb(100 116 139); }

    #unplacedContainer{ white-space: pre-line; }

    .ep-native-select{
      position:absolute !important;
      opacity:0 !important;
      pointer-events:none !important;
      width:1px !important;
      height:1px !important;
      left:-9999px !important;
    }

    .ep-select{ position:relative; width:100%; overflow: visible; }
    .ep-select-btn{
      width:100%;
      min-height: var(--ep-field-h);
      border-radius: var(--ep-radius-lg);
      border: 1px solid rgba(226,232,240,.75);
      background: rgba(255,255,255,.70);
      padding: .62rem 1rem;
      font-size: 13px;
      line-height: 1.35;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
      cursor:pointer;
      transition: background-color .15s ease, border-color .15s ease, box-shadow .15s ease, transform .08s ease;
    }
    .ep-select-btn:hover{ background: rgba(255,255,255,.82); }
    .ep-select-btn:active{ transform: translateY(1px); }
    .ep-select-btn:focus{
      outline:none;
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.22);
    }

    html.dark .ep-select-btn{
      border-color: rgba(30,41,59,.7);
      background: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }

    .ep-select-sm .ep-select-btn{
      min-height: var(--ep-field-h-sm);
      padding: .48rem .85rem;
      font-size: 12.5px;
      line-height: 1.35;
      border-radius: var(--ep-radius-sm);
    }

    .ep-select-menu{
      position:absolute;
      inset-inline:0;
      top: calc(100% + .35rem);
      z-index: 9999;
      border-radius: 1rem;
      border: 1px solid rgba(226,232,240,.9);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      padding: .35rem;
      box-shadow: 0 18px 55px rgba(2,6,23,.18);
      display:none;
      max-height: 260px;
      overflow:auto;
    }
    html.dark .ep-select-menu{
      border-color: rgba(51,65,85,.9);
      background: rgba(2,6,23,.92);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .ep-select.open .ep-select-menu{ display:block; }

    .ep-select-item{
      width:100%;
      border:0;
      background: transparent;
      color: inherit;
      border-radius: .85rem;
      padding: .55rem .75rem;
      font-size: 13px;
      text-align:left;
      cursor:pointer;
      transition: background-color .12s ease;
    }
    .ep-select-sm .ep-select-item{ font-size: 12.5px; padding: .5rem .7rem; }
    .ep-select-item:hover{ background: rgba(99,102,241,.10); }
    html.dark .ep-select-item:hover{ background: rgba(129,140,248,.14); }

    .ep-select-item[aria-selected="true"]{
      background: rgba(99,102,241,.16);
      font-weight: 600;
    }
    html.dark .ep-select-item[aria-selected="true"]{ background: rgba(129,140,248,.18); }

    .ep-frame{
      width: 100%;
      max-width: var(--ep-frame-max);
      margin: 0 auto;
      padding-left: 16px;
      padding-right: 16px;
      transition: max-width .22s ease, padding .22s ease;
    }
    @media (min-width: 640px){
      .ep-frame{ padding-left: 24px; padding-right: 24px; }
    }
    @media (min-width: 1024px){
      .ep-frame{ padding-left: 32px; padding-right: 32px; }
    }

    .ep-frame.has-ads{
      max-width: var(--ep-shell-max);
    }

    .ep-shell{
      display:grid;
      grid-template-columns: 1fr;
      gap: 0;
      align-items:start;
      width:100%;
    }
    .ep-center{ min-width:0; }

    .ep-ad-slot{
      display:none;
      width: 100%;
      min-height: var(--ep-rail-min-h);
      align-items:flex-start;
      justify-content:center;
      overflow:hidden;

      position: sticky;
      top: 88px;
      height: fit-content;
    }
    .ep-ad-slot > div{ width:100%; max-width: 100%; }

    .ep-shell.has-left-ad,
    .ep-shell.has-right-ad{
      gap: var(--ep-rail-gap);
    }

    .ep-shell.has-left-ad .ep-ad-left{ display:flex; }
    .ep-shell.has-right-ad .ep-ad-right{ display:flex; }

    .ep-shell.has-left-ad.has-right-ad{
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }
    .ep-shell.has-left-ad:not(.has-right-ad){
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) 1fr;
    }
    .ep-shell.has-right-ad:not(.has-left-ad){
      grid-template-columns: 1fr minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }

    @media (max-width: 1024px){
      .ep-frame.has-ads{ max-width: var(--ep-frame-max); }
      .ep-shell{
        grid-template-columns: 1fr !important;
        gap: 0 !important;
      }
      .ep-ad-slot{ display:none !important; }
    }

    @media (max-width: 900px){
      table.config-table{ font-size: .76rem; }
      table.config-table th{ font-size: .68rem; }
      table.config-table input, table.config-table select{ font-size: 12px; }
      .t-days{ gap: 5px; }
      .t-hours{ gap: 5px; }
    }
  </style>
</head>

<body class="min-h-screen pt-16 text-slate-900 dark:text-slate-100 bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M3CQTM2P"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <a href="#main"
     class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[100] focus:rounded-xl focus:bg-white focus:px-4 focus:py-2 focus:text-slate-900 focus:shadow">
    KontentÉ™ keÃ§
  </a>

  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/60 to-emerald-200/60 dark:from-indigo-500/15 dark:to-emerald-500/10"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/60 to-pink-200/60 dark:from-amber-500/10 dark:to-pink-500/10"></div>
  </div>

  <header class="fixed top-0 inset-x-0 z-50 border-b border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/60 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <img src="assets/ep-favicon-light.svg" alt="EduPlan" class="h-9 w-9 dark:hidden" width="36" height="36" />
          <img src="assets/ep-favicon-dark.svg" alt="" aria-hidden="true" class="h-9 w-9 hidden dark:block" width="36" height="36" />
          <span class="font-semibold tracking-tight">EduPlan AZ</span>
        </a>

        <button
          id="theme-toggle"
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-slate-900/40 p-2 hover:bg-slate-200/70 dark:hover:bg-slate-900/60 transition focus:outline-none focus:ring-2 focus:ring-indigo-400"
          aria-label="Tema dÉ™yiÅŸdir"
          aria-pressed="false"
        >
          <svg class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.5-1.5M20.5 20.5 19 19M19 5l1.5-1.5M3.5 20.5 5 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg class="h-5 w-5 hidden dark:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 13.2A7.5 7.5 0 0 1 10.8 3 6.9 6.9 0 1 0 21 13.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="main" class="pt-4 pb-0">
    <div class="ep-frame" id="ep-frame">
      <div class="ep-shell" id="ep-shell">

        <aside class="ep-ad-slot ep-ad-left no-print" data-ad-slot="left" aria-label="Reklam (sol)">
        </aside>

        <div class="ep-center">
          <section class="py-6 sm:py-8">
            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight">DÉ™rs cÉ™dvÉ™li hazÄ±rlayÄ±cÄ±</h1>
            <p class="mt-2 text-slate-600 dark:text-slate-300">
              Orta mÉ™ktÉ™blÉ™r Ã¼Ã§Ã¼n dÉ™rs cÉ™dvÉ™li: mÃ¼É™llim, sinif vÉ™ fÉ™nn mÉ™lumatlarÄ±nÄ± daxil edin, sistem tipik mÉ™hdudiyyÉ™tlÉ™rlÉ™ avtomatik cÉ™dvÉ™l qursun.
            </p>
          </section>

          <section id="tt-panel" class="rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur shadow-sm">
            <div class="px-6 py-4 border-b border-slate-200/70 dark:border-slate-800/70 flex items-center justify-between gap-4">
              <div class="font-semibold">ğŸ§© MÉ™ktÉ™b konfiqurasiyasÄ± vÉ™ hazÄ±rlayÄ±cÄ±</div>
            </div>

            <div class="p-6 space-y-4">

              <!-- 1) MÉ™ktÉ™b parametrlÉ™ri -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                <div class="section-title mb-2">MÉ™ktÉ™b parametrlÉ™ri</div>

                <div class="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">HÉ™ftÉ™lik iÅŸ gÃ¼nÃ¼</label>
                    <select id="daysCount">
                      <option value="5">5 gÃ¼n (B.eâ€“C.u)</option>
                      <option value="6">6 gÃ¼n (B.eâ€“Å)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">GÃ¼ndÉ™ dÉ™rs saatÄ± (max)</label>
                    <input id="lessonsPerDay" type="number" min="1" max="8" value="7" />
                  </div>
                </div>

                <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300">
                  <label class="inline-flex items-start gap-2">
                    <input id="optHeavyAvoidEdges" type="checkbox" class="mt-0.5" checked />
                    <span>AÄŸÄ±r fÉ™nlÉ™r mÃ¼mkÃ¼n qÉ™dÉ™r 1-ci vÉ™ sonuncu saatda olmasÄ±n</span>
                  </label>

                  <label class="inline-flex items-start gap-2 md:col-span-2">
                    <input id="optNoClassGaps" type="checkbox" class="mt-0.5" checked />
                    <span>SiniflÉ™r Ã¼zrÉ™ gÃ¼n É™rzindÉ™ boÅŸ saat olmasÄ±n (dÉ™rslÉ™r 1-ci saatdan ardÄ±cÄ±l olsun)</span>
                  </label>
                </div>

                <div class="mt-3 text-[11px] text-slate-500 dark:text-slate-400">
                  BÃ¼tÃ¼n siniflÉ™r Ã¼Ã§Ã¼n gÃ¼ndÉ™lik limit standart olaraq <strong>â€œGÃ¼ndÉ™ dÉ™rs saatÄ± (max)â€</strong> qÉ™dÉ™r tÉ™tbiq olunur
                  (sinif cÉ™dvÉ™lindÉ™ ayrÄ±ca dÉ™yiÅŸmÉ™k mÃ¼mkÃ¼ndÃ¼r).
                </div>
              </div>

              <!-- 2) MÃ¼É™llimlÉ™r -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                <div class="flex items-center justify-between mb-2">
                  <div class="section-title">MÃ¼É™llimlÉ™r</div>
                  <button type="button" id="btnAddTeacher"
                          class="ep-btn-secondary no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-slate-200/70 dark:hover:bg-slate-900/60 transition">
                    â• ÆlavÉ™ et
                  </button>
                </div>

                <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                  HÉ™r mÃ¼É™llim Ã¼Ã§Ã¼n hÉ™ftÉ™lik vÉ™ gÃ¼ndÉ™lik maksimum saat, uyÄŸun dÉ™rs saatlarÄ± vÉ™ gÉ™lmÉ™ gÃ¼nlÉ™ri.
                </div>

                <table class="config-table" id="teacherTable">
                  <thead>
                    <tr>
                      <th>Ad, soyad</th>
                      <th>Kod</th>
                      <th>HÉ™ftÉ™lik<span class="block">max</span></th>
                      <th>GÃ¼ndÉ™<span class="block">max</span></th>
                      <th>DÉ™rs<span class="block">saatlarÄ±</span></th>
                      <th>GÉ™lmÉ™ gÃ¼nlÉ™ri</th>
                      <th class="no-print"></th>
                    </tr>
                  </thead>
                  <tbody id="teacherTbody"></tbody>
                </table>
              </div>

              <!-- 3) SiniflÉ™r -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                <div class="flex items-center justify-between mb-2">
                  <div class="section-title">SiniflÉ™r</div>
                  <button type="button" id="btnAddClass"
                          class="ep-btn-secondary no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-slate-200/70 dark:hover:bg-slate-900/60 transition">
                    â• ÆlavÉ™ et
                  </button>
                </div>

                <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                  SÉ™viyyÉ™ vÉ™ nÃ¶vbÉ™ hazÄ±rda informasiya Ã¼Ã§Ã¼ndÃ¼r. â€œGÃ¼ndÉ™ max dÉ™rsâ€ boÅŸ qalarsa standart limit istifadÉ™ olunur.
                </div>

                <table class="config-table" id="classTable">
                  <thead>
                    <tr>
                      <th>Sinif</th>
                      <th>SÉ™viyyÉ™</th>
                      <th>NÃ¶vbÉ™</th>
                      <th>GÃ¼ndÉ™ max dÉ™rs</th>
                      <th class="no-print"></th>
                    </tr>
                  </thead>
                  <tbody id="classTbody"></tbody>
                </table>
              </div>

              <!-- 4) FÉ™nn / dÉ™rs saatlarÄ± -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                <div class="flex items-center justify-between mb-2">
                  <div class="section-title">FÉ™nn / dÉ™rs saatlarÄ±</div>
                  <button type="button" id="btnAddLesson"
                          class="ep-btn-secondary no-print inline-flex items-center gap-1 rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-slate-200/70 dark:hover:bg-slate-900/60 transition">
                    â• ÆlavÉ™ et
                  </button>
                </div>

                <div class="text-[11px] text-slate-500 dark:text-slate-400 mb-3">
                  HÉ™r sÉ™tir: sinif + fÉ™nn + mÃ¼É™llim + hÉ™ftÉ™lik saat.
                  â€œQoÅŸaâ€ qaydasÄ±: <strong>Yox</strong> â†’ eyni gÃ¼ndÉ™ max 1; <strong>Ä°mkan daxilindÉ™</strong> â†’ eyni gÃ¼ndÉ™ mÃ¼tlÉ™q 2 (ardÄ±cÄ±l Ã¼stÃ¼nlÃ¼k); <strong>MÃ¼tlÉ™q</strong> â†’ eyni gÃ¼ndÉ™ mÃ¼tlÉ™q 2 ardÄ±cÄ±l.
                </div>

                <table class="config-table" id="lessonTable">
                  <thead>
                    <tr>
                      <th>Sinif</th>
                      <th>FÉ™nn</th>
                      <th>MÃ¼É™llim kodu/adÄ±</th>
                      <th>HÉ™ftÉ™lik saat</th>
                      <th>AÄŸÄ±r?</th>
                      <th>QoÅŸa</th>
                      <th class="no-print"></th>
                    </tr>
                  </thead>
                  <tbody id="lessonTbody"></tbody>
                </table>
              </div>

              <!-- 5) HazÄ±rlayÄ±cÄ± -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4 no-print">
                <div class="section-title mb-2">HazÄ±rlayÄ±cÄ±</div>

                <div class="space-y-1.5 text-xs text-slate-600 dark:text-slate-300 mb-4">
                  <p>1) MÃ¼É™llim, sinif vÉ™ fÉ™nn mÉ™lumatlarÄ±nÄ± doldurun.</p>
                  <p>2) â€œCÉ™dvÉ™li qurâ€ dÃ¼ymÉ™sini sÄ±xÄ±n â€” sistem tam hÉ™ll tapana qÉ™dÉ™r fÉ™rqli kombinasiyalar sÄ±nayacaq.</p>
                  <p class="text-[11px] text-slate-500 dark:text-slate-400">
                    Proses zamanÄ± dÃ¼ymÉ™ â€œğŸ›‘ DayandÄ±râ€ olur â€” istÉ™sÉ™niz axtarÄ±ÅŸÄ± istÉ™nilÉ™n vaxt dayandÄ±ra bilÉ™rsiniz.
                  </p>
                </div>

                <div class="flex flex-wrap gap-2">
                  <button id="btnGenerate"
                          class="ep-btn-primary inline-flex items-center justify-center rounded-2xl px-4 py-3 text-sm font-semibold text-white shadow-sm hover:brightness-110 transition">
                    âš™ï¸ CÉ™dvÉ™li qur
                  </button>

                  <button id="btnResetAll"
                          class="ep-btn-secondary inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 text-xs font-semibold hover:bg-slate-200/70 dark:hover:bg-slate-900/60 transition">
                    ğŸ§¹ HamÄ±sÄ±nÄ± tÉ™mizlÉ™
                  </button>
                </div>

                <div id="globalError"
                     class="hidden mt-3 rounded-2xl border border-rose-200/70 dark:border-rose-900/40 bg-rose-50/70 dark:bg-rose-950/25 px-4 py-3 text-xs text-rose-700 dark:text-rose-300"
                     role="alert" aria-live="polite" tabindex="-1"></div>

                <div id="globalInfo" class="mt-2 text-[11px] text-slate-500 dark:text-slate-400"></div>
              </div>

              <!-- 6) NÉ™ticÉ™ -->
              <div class="ep-card rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4 min-h-[260px]" id="resultCard">
                <div class="flex items-center justify-between mb-3">
                  <div class="section-title">NÉ™ticÉ™</div>
                  <div id="resultStats" class="text-[11px] text-slate-500 dark:text-slate-400"></div>
                </div>

                <div id="classTabs" class="flex flex-wrap gap-1 mb-3 text-xs no-print"></div>

                <div id="timetableContainer" class="overflow-x-auto text-xs">
                  <div class="text-[12px] text-slate-500 dark:text-slate-400">
                    HÉ™lÉ™ cÉ™dvÉ™l qurulmayÄ±b. MÉ™lumatlarÄ± daxil etdikdÉ™n sonra <strong>â€œCÉ™dvÉ™li qurâ€</strong> dÃ¼ymÉ™sini sÄ±xÄ±n.
                  </div>
                </div>

                <div id="unplacedContainer" class="mt-3 text-[11px] text-amber-600 dark:text-amber-400 hidden"></div>
                <div id="softWarnings" class="mt-2 text-[11px] text-slate-500 dark:text-slate-400"></div>
              </div>

            </div>
          </section>

          <!-- âœ… MÆLUMAT (kullanÄ±cÄ± klavuzu) -->
          <section class="ep-card mt-10 rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur p-6 sm:p-10 shadow-sm">
            <h2 class="text-2xl sm:text-3xl font-semibold">MÉ™lumat</h2>

            <div class="mt-5 space-y-6 text-base leading-7 text-slate-700 dark:text-slate-200">
              <p>
                Bu sÉ™hifÉ™dÉ™ki <strong>â€œğŸ§© MÉ™ktÉ™b konfiqurasiyasÄ± vÉ™ hazÄ±rlayÄ±cÄ±â€</strong> bloku
                dÉ™rs cÉ™dvÉ™lini <strong>tamamilÉ™ brauzerdÉ™</strong> qurmaq Ã¼Ã§Ã¼n hazÄ±rlanÄ±b:
                siz mÃ¼É™llim/sinif/fÉ™nn mÉ™lumatlarÄ±nÄ± daxil edirsiniz, sistem isÉ™ konfliktlÉ™ri minimuma endirÉ™rÉ™k
                cÉ™dvÉ™li avtomatik yÄ±ÄŸmaÄŸa Ã§alÄ±ÅŸÄ±r.
              </p>

              <div class="ep-card rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/60 dark:bg-white/5 p-4">
                <div class="font-semibold text-slate-900 dark:text-slate-100">Ä°ÅŸ prinsipi (qÄ±sa axÄ±n)</div>
                <ol class="mt-2 list-decimal pl-6 space-y-1">
                  <li><strong>MÉ™ktÉ™b parametrlÉ™ri</strong> â€” hÉ™ftÉ™ gÃ¼nÃ¼ sayÄ± vÉ™ gÃ¼ndÉ™ maksimum saatÄ± seÃ§in.</li>
                  <li><strong>MÃ¼É™llimlÉ™r</strong> â€” hÉ™r mÃ¼É™llimin limitlÉ™rini, uyÄŸun saatlarÄ± vÉ™ gÉ™lmÉ™ gÃ¼nlÉ™rini yazÄ±n.</li>
                  <li><strong>SiniflÉ™r</strong> â€” sinif siyahÄ±sÄ±nÄ± (sÉ™viyyÉ™, nÃ¶vbÉ™, gÃ¼ndÉ™ limit) daxil edin.</li>
                  <li><strong>FÉ™nn / dÉ™rs saatlarÄ±</strong> â€” â€œsinif + fÉ™nn + mÃ¼É™llim + hÉ™ftÉ™lik saatâ€ sÉ™tirlÉ™rini É™lavÉ™ edin.</li>
                  <li><strong>âš™ï¸ CÉ™dvÉ™li qur</strong> â€” sistem <strong>tam hÉ™ll tapÄ±lanadÉ™k</strong> fÉ™rqli kombinasiyalar sÄ±nayÄ±r.</li>
                  <li><strong>NÉ™ticÉ™</strong> â€” sinif tablarÄ±nÄ± dÉ™yiÅŸÉ™rÉ™k cÉ™dvÉ™li yoxlayÄ±n, lazÄ±m olsa parametrlÉ™ri dÃ¼zÉ™ldin vÉ™ yenidÉ™n qurun.</li>
                </ol>

                <p class="mt-3 text-sm text-slate-600 dark:text-slate-300">
                  Proses zamanÄ± ekranda <strong>cÉ™hd sayÄ±</strong> vÉ™ <strong>É™n yaxÅŸÄ± tapÄ±lan nÉ™ticÉ™</strong> (faizlÉ™) gÃ¶stÉ™rilir.
                  Ä°stÉ™sÉ™niz <strong>ğŸ›‘ DayandÄ±r</strong> dÃ¼ymÉ™si ilÉ™ axtarÄ±ÅŸÄ± dayandÄ±rÄ±b hÉ™min â€œÉ™n yaxÅŸÄ±â€ nÉ™ticÉ™yÉ™ baxa bilÉ™rsiniz.
                </p>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">1) MÉ™ktÉ™b parametrlÉ™ri nÉ™ edir?</h3>
                <ul class="mt-2 list-disc pl-6 space-y-1">
                  <li>
                    <strong>HÉ™ftÉ™lik iÅŸ gÃ¼nÃ¼ (5/6)</strong> cÉ™dvÉ™lin sÃ¼tun sayÄ±nÄ± mÃ¼É™yyÉ™n edir:
                    5 gÃ¼n seÃ§É™ndÉ™ <em>ÅÉ™nbÉ™</em> (Å) gizlÉ™nir vÉ™ mÃ¼É™llimlÉ™rin â€œÅâ€ gÃ¼nÃ¼ avtomatik deaktiv edilir.
                  </li>
                  <li>
                    <strong>GÃ¼ndÉ™ dÉ™rs saatÄ± (max)</strong> hÉ™r sinif Ã¼Ã§Ã¼n matrisin (gÃ¼n Ã— saat) Ã¶lÃ§Ã¼sÃ¼nÃ¼ tÉ™yin edir.
                    MÉ™sÉ™lÉ™n 7 seÃ§sÉ™niz, hÉ™r gÃ¼n 1â€“7 saat aralÄ±ÄŸÄ± yaranÄ±r.
                  </li>
                  <li>
                    <strong>AÄŸÄ±r fÉ™nlÉ™r mÃ¼mkÃ¼n qÉ™dÉ™r 1-ci/sonuncu saatda olmasÄ±n</strong> â€” bu seÃ§im aktivdirsÉ™,
                    â€œAÄŸÄ±r?â€ iÅŸarÉ™lÉ™diyiniz dÉ™rslÉ™r mÃ¼mkÃ¼n olduqca 1-ci vÉ™ sonuncu saata salÄ±nmÄ±r (optimallaÅŸdÄ±rma).
                  </li>
                  <li>
                    <strong>SiniflÉ™r Ã¼zrÉ™ gÃ¼n É™rzindÉ™ boÅŸ saat olmasÄ±n</strong> â€” aktivdirsÉ™,
                    sinifdÉ™ dÉ™rslÉ™r gÃ¼n É™rzindÉ™ <strong>1-ci saatdan baÅŸlayÄ±b ardÄ±cÄ±l</strong> gedir, arada boÅŸluq yaranmÄ±r (qayda kimi tÉ™tbiq olunur).
                  </li>
                </ul>

                <p class="mt-3 text-sm text-slate-600 dark:text-slate-300">
                  Qeyd: â€œAÄŸÄ±r fÉ™nn kÉ™nar saat olmasÄ±nâ€ optimallaÅŸdÄ±rmadÄ±r.
                  MÃ¼É™llim gÃ¼n/saat uyÄŸunluÄŸu, mÃ¼É™llim/sinif limitlÉ™ri, sinifdÉ™ boÅŸ saat olmamasÄ± vÉ™ â€œQoÅŸaâ€ qaydalarÄ± isÉ™ qayda kimidir vÉ™ pozulmur.
                </p>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">2) MÃ¼É™llimlÉ™r bÃ¶lmÉ™si necÉ™ istifadÉ™ olunur?</h3>

                <ul class="mt-2 list-disc pl-6 space-y-1">
                  <li>
                    <strong>Ad, soyad</strong> vÉ™ <strong>Kod</strong>:
                    â€œFÉ™nn / dÉ™rs saatlarÄ±â€ bÃ¶lmÉ™sindÉ™ mÃ¼É™llimi tapmaq Ã¼Ã§Ã¼n sistem mÃ¼É™llimi <strong>kodla vÉ™ ya adla</strong> uyÄŸunlaÅŸdÄ±rÄ±r.
                    Praktik Ã¼sul: hÉ™r mÃ¼É™llimÉ™ qÄ±sa kod verin (mÉ™s: <code class="px-1 rounded bg-slate-100/80 dark:bg-white/10">Ä°SF</code>).
                  </li>
                  <li>
                    <strong>HÉ™ftÉ™lik max</strong> vÉ™ <strong>GÃ¼ndÉ™ max</strong>: mÃ¼É™llimin hÉ™ftÉ™lik/gÃ¼ndÉ™lik dÉ™rs limitidir.
                    <strong>0</strong> yazÄ±lsa (vÉ™ ya boÅŸ qalsa) sistem bunu â€œlimitsizâ€ kimi qÉ™bul edir.
                  </li>
                  <li>
                    <strong>DÉ™rs saatlarÄ±</strong>:
                    mÃ¼É™llimin dÉ™rsinin <strong>hansÄ± saatlarda</strong> ola bilÉ™cÉ™yini gÃ¶stÉ™rir.
                    HeÃ§ nÉ™ seÃ§mÉ™sÉ™niz sistem standart olaraq <strong>bÃ¼tÃ¼n saatlarÄ±</strong> uyÄŸun sayÄ±r.
                    Bu seÃ§im <strong>qayda kimidir</strong> vÉ™ pozulmur.
                  </li>
                  <li>
                    <strong>GÉ™lmÉ™ gÃ¼nlÉ™ri</strong>:
                    mÃ¼É™llimin dÉ™rsinin hansÄ± gÃ¼nlÉ™rdÉ™ ola bilÉ™cÉ™yini gÃ¶stÉ™rir. HeÃ§ nÉ™ seÃ§mÉ™sÉ™niz,
                    sistem <strong>hamÄ± gÃ¼nlÉ™r</strong> kimi qÉ™bul edir.
                    Vacib: â€œgÉ™lmÉ™ gÃ¼nlÉ™riâ€ <strong>qayda kimidir</strong> â€” pozulmur.
                  </li>
                </ul>

                <div class="mt-3 rounded-xl border border-amber-200/70 dark:border-amber-500/30 bg-amber-50/70 dark:bg-amber-500/10 p-3 text-sm">
                  <div class="font-semibold text-amber-900 dark:text-amber-200">DiqqÉ™t (uyÄŸunlaÅŸdÄ±rma)</div>
                  <p class="mt-1">
                    â€œFÉ™nn / dÉ™rs saatlarÄ±â€ bÃ¶lmÉ™sindÉ™ mÃ¼É™llimi <strong>kod vÉ™ ya ad</strong> ilÉ™ yazanda,
                    bu dÉ™yÉ™r mÃ¼É™llim cÉ™dvÉ™lindÉ™ki kod/ad ilÉ™ <strong>eyni yazÄ±lÄ±ÅŸda</strong> olmalÄ±dÄ±r
                    (sistem yalnÄ±z boÅŸluqlarÄ± kÉ™sir).
                    MÉ™sÉ™lÉ™n <code class="px-1 rounded bg-white/60 dark:bg-white/10">FÄ°R</code> ilÉ™
                    <code class="px-1 rounded bg-white/60 dark:bg-white/10">fir</code> fÉ™rqli sayÄ±lÄ±r.
                  </p>
                </div>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">3) SiniflÉ™r bÃ¶lmÉ™si necÉ™ iÅŸlÉ™yir?</h3>

                <ul class="mt-2 list-disc pl-6 space-y-1">
                  <li>
                    <strong>Sinif</strong> (mÉ™s: 5A) â€” â€œFÉ™nn / dÉ™rs saatlarÄ±â€ sÉ™tirlÉ™rindÉ™ dÉ™ eyni adla yazÄ±lmalÄ±dÄ±r.
                  </li>
                  <li>
                    <strong>GÃ¼ndÉ™ max dÉ™rs</strong> boÅŸ qalarsa standart limit kimi <strong>â€œGÃ¼ndÉ™ dÉ™rs saatÄ± (max)â€</strong> tÉ™tbiq olunur.
                    ÆgÉ™r rÉ™qÉ™m yazsanÄ±z, hÉ™min sinif Ã¼Ã§Ã¼n gÃ¼ndÉ™lik limit ayrÄ±ca tÉ™yin olunur.
                  </li>
                  <li>
                    <strong>NÃ¶vbÉ™</strong> (SÉ™hÉ™r/GÃ¼norta) hazÄ±rda <strong>informasiya Ã¼Ã§Ã¼ndÃ¼r</strong> â€” alqoritm nÃ¶vbÉ™yÉ™ gÃ¶rÉ™ ayrÄ±ca mÉ™hdudiyyÉ™t tÉ™tbiq etmir.
                  </li>
                </ul>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">4) FÉ™nn / dÉ™rs saatlarÄ±: É™n vacib hissÉ™</h3>

                <p class="mt-2">
                  Bu cÉ™dvÉ™ldÉ™ki hÉ™r sÉ™tir bir â€œtÉ™dris tapÅŸÄ±rÄ±ÄŸÄ±dÄ±râ€:
                  <strong>hansÄ± sinifÉ™</strong>, <strong>hansÄ± fÉ™nn</strong>, <strong>hansÄ± mÃ¼É™llim</strong> vÉ™
                  <strong>hÉ™ftÉ™dÉ™ neÃ§É™ saat</strong>.
                </p>

                <ul class="mt-3 list-disc pl-6 space-y-1">
                  <li>
                    <strong>HÉ™ftÉ™lik saat</strong> daxil etdikdÉ™ sistem bunu â€œbloklaraâ€ parÃ§alayÄ±r vÉ™ yerlÉ™ÅŸdirir.
                  </li>
                  <li>
                    <strong>QoÅŸa</strong> rejimi (yeni qayda):
                    <ul class="list-disc pl-6 mt-1 space-y-1">
                      <li><strong>Yox</strong> â†’ hÉ™min fÉ™nn eyni gÃ¼ndÉ™ <strong>max 1 dÉ™fÉ™</strong> ola bilÉ™r.</li>
                      <li><strong>Ä°mkan daxilindÉ™</strong> â†’ hÉ™min fÉ™nn eyni gÃ¼ndÉ™ <strong>mÃ¼tlÉ™q 2 dÉ™fÉ™</strong> olmalÄ±dÄ±r. Sistem É™vvÉ™lcÉ™ <strong>ardÄ±cÄ±l</strong> (yanaÅŸÄ±) etmÉ™yÉ™ Ã§alÄ±ÅŸÄ±r, mÃ¼mkÃ¼n deyilsÉ™ yenÉ™ dÉ™ <strong>eyni gÃ¼n 2 dÉ™fÉ™</strong> (ardÄ±cÄ±l olmadan) yerlÉ™ÅŸdirir.</li>
                      <li><strong>MÃ¼tlÉ™q</strong> â†’ hÉ™min fÉ™nn eyni gÃ¼ndÉ™ <strong>mÃ¼tlÉ™q 2 dÉ™fÉ™ ardÄ±cÄ±l</strong> olmalÄ±dÄ±r.</li>
                    </ul>
                  </li>
                  <li>
                    <strong>AÄŸÄ±r?</strong> seÃ§ilibsÉ™:
                    â€œAÄŸÄ±r fÉ™nlÉ™r 1-ci/sonuncu saatda olmasÄ±nâ€ parametri aktiv olanda
                    sistem É™vvÉ™lcÉ™ aÄŸÄ±r fÉ™nni 1-ci/sonuncu saata salmamaÄŸa Ã§alÄ±ÅŸÄ±r.
                  </li>
                </ul>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">5) â€œCÉ™dvÉ™li qurâ€ dÃ¼ymÉ™si arxada nÉ™ edir?</h3>

                <ul class="mt-2 list-disc pl-6 space-y-1">
                  <li>
                    Sistem â€œdÉ™rs bloklarÄ±nÄ±â€ mÃ¼xtÉ™lif ardÄ±cÄ±llÄ±qlarda vÉ™ slot kombinasiyalarÄ±nda yerlÉ™ÅŸdirmÉ™yÉ™ Ã§alÄ±ÅŸÄ±r.
                  </li>
                  <li>
                    <strong>Qayda kimi tÉ™tbiq olunan mÉ™hdudiyyÉ™tlÉ™r</strong> (mÃ¼É™llim konfliktlÉ™ri, gÉ™lmÉ™ gÃ¼nlÉ™ri, mÃ¼É™llim saat seÃ§imi, limitlÉ™r, sinif tutumu, â€œQoÅŸaâ€ qaydalarÄ±, sinifdÉ™ boÅŸ saat olmamasÄ±) pozulmur.
                  </li>
                  <li>
                    <strong>OptimallaÅŸdÄ±rmalar</strong> (aÄŸÄ±r fÉ™nnin kÉ™nar saatlara dÃ¼ÅŸmÉ™mÉ™si, QoÅŸa=Ä°mkan daxilindÉ™ ardÄ±cÄ±llÄ±q) mÃ¼mkÃ¼n olduqca qorunur.
                  </li>
                  <li>
                    Tam hÉ™ll tapÄ±lanadÉ™k axtarÄ±ÅŸ davam edir. Konfiqurasiya hÉ™qiqÉ™tÉ™n mÃ¼mkÃ¼nsÃ¼zdÃ¼rsÉ™ axtarÄ±ÅŸ da uzana bilÉ™r â€”
                    bu halda <strong>ğŸ›‘ DayandÄ±r</strong> dÃ¼ymÉ™si ilÉ™ prosesi dayandÄ±rÄ±b É™n yaxÅŸÄ± tapÄ±lmÄ±ÅŸ nÉ™ticÉ™ni gÃ¶rÉ™ bilÉ™rsiniz.
                  </li>
                </ul>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Tez-tez rast gÉ™linÉ™n problemlÉ™r vÉ™ hÉ™ll yollarÄ±</h3>
                <ul class="mt-2 list-disc pl-6 space-y-1">
                  <li>
                    <strong>â€œSinif/mÃ¼É™llim tapÄ±lmadÄ±â€ xÉ™tasÄ±</strong> â†’
                    sinif adlarÄ±nÄ± vÉ™ mÃ¼É™llim kod/adÄ±nÄ± bÃ¼tÃ¼n yerlÉ™rdÉ™ eyni yazÄ±n.
                  </li>
                  <li>
                    <strong>Ã‡ox â€œYerlÉ™ÅŸdirilmÉ™yÉ™nlÉ™râ€ Ã§Ä±xÄ±r</strong> â†’
                    sinif/mÃ¼É™llim limitlÉ™rini yoxlayÄ±n, sinif tutumunu artÄ±rÄ±n (gÃ¼ndÉ™ max), mÃ¼É™llim gÉ™lmÉ™ gÃ¼nlÉ™rini vÉ™ uyÄŸun saatlarÄ± geniÅŸlÉ™ndirin.
                  </li>
                  <li>
                    <strong>AxtarÄ±ÅŸ Ã§ox uzanÄ±r</strong> â†’
                    Ã§ox vaxt bu ya konfiqurasiyanÄ±n mÃ¼mkÃ¼nsÃ¼z olmasÄ±na, ya da limitlÉ™rin hÉ™ddÉ™n artÄ±q sÉ™rt olmasÄ±na iÅŸarÉ™ edir.
                  </li>
                </ul>
              </div>

              <p class="text-sm text-slate-600 dark:text-slate-300">
                Qeyd: Bu alqoritm brauzerdÉ™ iÅŸlÉ™yir vÉ™ â€œtam hÉ™ll tapÄ±lanadÉ™kâ€ axtarÄ±ÅŸ aparÄ±r. Stabil nÉ™ticÉ™ Ã¼Ã§Ã¼n
                kod/ad uyÄŸunluÄŸunu qorumaq vÉ™ limitlÉ™ri realist qurmaq É™n vacibdir.
              </p>
            </div>
          </section>

        </div>

        <aside class="ep-ad-slot ep-ad-right no-print" data-ad-slot="right" aria-label="Reklam (saÄŸ)">
        </aside>

      </div>
    </div>
  </main>

  <footer class="mt-10 border-t border-slate-200/70 dark:border-slate-800/70">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row gap-4 items-center justify-between text-sm text-slate-600 dark:text-slate-300">
      <div>
        Â© <span id="year"></span> <span class="font-semibold text-slate-900 dark:text-slate-100">EduPlan AZ</span> Â· BÃ¼tÃ¼n hÃ¼quqlar qorunur
      </div>

      <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
        <a class="hover:underline underline-offset-4" href="/about.html">HaqqÄ±mÄ±zda</a>
        <a class="hover:underline underline-offset-4" href="/contact.html">ÆlaqÉ™</a>
        <a class="hover:underline underline-offset-4" href="/terms.html">ÅÉ™rtlÉ™r</a>
        <a class="hover:underline underline-offset-4" href="/privacy.html">MÉ™xfilik</a>
      </nav>
    </div>
  </footer>

  <script>
    (function () {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const btn = document.getElementById('theme-toggle');
      const meta = document.getElementById('theme-color');
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      const hasUserPref = () => {
        try { return !!localStorage.getItem('theme'); } catch (e) { return false; }
      };

      const getTheme = () => (document.documentElement.classList.contains('dark') ? 'dark' : 'light');

      function applyTheme(theme, persist) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        document.documentElement.dataset.theme = theme;

        if (btn) btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (meta) meta.setAttribute('content', isDark ? '#0b1220' : '#f8fafc');

        if (persist) {
          try { localStorage.setItem('theme', theme); } catch (e) {}
        }
      }

      applyTheme(getTheme(), false);

      btn && btn.addEventListener('click', function () {
        const next = (getTheme() === 'dark') ? 'light' : 'dark';
        applyTheme(next, true);
      });

      const onSystemChange = function (e) {
        if (!hasUserPref()) applyTheme(e.matches ? 'dark' : 'light', false);
      };

      if (mq) {
        if (mq.addEventListener) mq.addEventListener('change', onSystemChange);
        else if (mq.addListener) mq.addListener(onSystemChange);
      }
    })();
  </script>

  <script>
    (function () {
      const frame = document.getElementById('ep-frame');
      const shell = document.getElementById('ep-shell');
      if (!frame || !shell) return;

      const left  = shell.querySelector('[data-ad-slot="left"]');
      const right = shell.querySelector('[data-ad-slot="right"]');

      const hasContent = (el) => {
        if (!el) return false;
        return Array.from(el.childNodes).some(n => {
          if (n.nodeType === Node.ELEMENT_NODE) return true;
          if (n.nodeType === Node.TEXT_NODE) return n.textContent.trim().length > 0;
          return false;
        });
      };

      const update = () => {
        const hasLeft = hasContent(left);
        const hasRight = hasContent(right);

        shell.classList.toggle('has-left-ad', hasLeft);
        shell.classList.toggle('has-right-ad', hasRight);

        const hasAds = hasLeft || hasRight;
        frame.classList.toggle('has-ads', hasAds);
      };

      update();

      const obs = new MutationObserver(update);
      if (left)  obs.observe(left,  { childList: true, subtree: true });
      if (right) obs.observe(right, { childList: true, subtree: true });
    })();
  </script>

  <!-- Timetable logic (PRO + QoÅŸa qaydalarÄ± + "boÅŸ saat olmasÄ±n") -->
  <script>
    (function () {
      const teacherTbody = document.getElementById('teacherTbody');
      const classTbody = document.getElementById('classTbody');
      const lessonTbody = document.getElementById('lessonTbody');

      const btnAddTeacher = document.getElementById('btnAddTeacher');
      const btnAddClass = document.getElementById('btnAddClass');
      const btnAddLesson = document.getElementById('btnAddLesson');
      const btnGenerate = document.getElementById('btnGenerate');
      const btnResetAll = document.getElementById('btnResetAll');

      const daysCountEl = document.getElementById('daysCount');
      const lessonsPerDayEl = document.getElementById('lessonsPerDay');
      const optHeavyAvoidEdgesEl = document.getElementById('optHeavyAvoidEdges');
      const optNoClassGapsEl = document.getElementById('optNoClassGaps');

      const timetableContainer = document.getElementById('timetableContainer');
      const classTabs = document.getElementById('classTabs');
      const resultStats = document.getElementById('resultStats');
      const unplacedContainer = document.getElementById('unplacedContainer');
      const softWarnings = document.getElementById('softWarnings');

      const globalError = document.getElementById('globalError');
      const globalInfo = document.getElementById('globalInfo');

      const DAY_LABELS = ["B.e", "Ã‡.a", "Ã‡", "C.a", "C", "Å"];
      const MAX_HOURS_UI = 8;

      const STORAGE_KEY = "eduplan_tt_v3";

      let isGenerating = false;
      let stopRequested = false;

      // ---------------------------
      // Helpers
      // ---------------------------
      const clampInt = (v, min, max, fallback) => {
        const n = parseInt(v, 10);
        if (Number.isNaN(n)) return fallback;
        return Math.max(min, Math.min(max, n));
      };

      const qs = (sel, root = document) => root.querySelector(sel);

      function showError(msg) {
        if (!globalError) return;
        globalError.textContent = msg;
        globalError.classList.remove('hidden');
        try { globalError.focus(); } catch (e) {}
      }
      function clearError() {
        if (!globalError) return;
        globalError.textContent = "";
        globalError.classList.add('hidden');
      }
      function setInfo(msg) {
        if (!globalInfo) return;
        globalInfo.textContent = msg || "";
      }

      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function uid(prefix = "id") {
        return prefix + "_" + Math.random().toString(36).slice(2, 10);
      }

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function nextTick() {
        return new Promise((r) => setTimeout(r, 0));
      }

      // ---------------------------
      // Row builders (Teachers / Classes / Lessons)
      // ---------------------------
      function buildMiniActions() {
        return `
          <div class="t-mini-actions">
            <button type="button" class="t-mini-btn" data-mini="all">HamÄ±sÄ±</button>
            <button type="button" class="t-mini-btn" data-mini="none">HeÃ§ biri</button>
          </div>
        `;
      }

      function buildHourCheckboxes(hourMax) {
        let out = buildMiniActions();
        out += `<div class="t-hours" data-scope="hours">`;
        for (let h = 1; h <= MAX_HOURS_UI; h++) {
          const disabled = h > hourMax ? "disabled" : "";
          out += `
            <label>
              <input type="checkbox" class="t-hour" data-hour="${h}" ${disabled} />
              <span>${h}</span>
            </label>
          `;
        }
        out += `</div>`;
        return out;
      }

      function buildDayCheckboxes(dayCount) {
        let out = buildMiniActions();
        out += `<div class="t-days" data-scope="days">`;
        for (let d = 0; d < 6; d++) {
          const disabled = (dayCount === 5 && d === 5) ? "disabled" : "";
          out += `
            <label>
              <input type="checkbox" class="t-day" data-day="${d}" ${disabled} />
              <span>${DAY_LABELS[d]}</span>
            </label>
          `;
        }
        out += `</div>`;
        return out;
      }

      function addTeacherRow(data = null) {
        const dayCount = clampInt(daysCountEl?.value, 5, 6, 5);
        const hourMax = clampInt(lessonsPerDayEl?.value, 1, 8, 7);

        const rowId = uid("t");
        const tr = document.createElement("tr");
        tr.dataset.id = rowId;

        tr.innerHTML = `
          <td><input type="text" class="t-name" placeholder="MÉ™s: AygÃ¼n Æliyeva" value="${data?.name ? escapeHtml(data.name) : ""}"></td>
          <td><input type="text" class="t-code" placeholder="MÉ™s: AGA" value="${data?.code ? escapeHtml(data.code) : ""}"></td>
          <td><input type="number" class="t-weekMax" min="0" max="60" placeholder="0 = limitsiz" value="${(data?.weekMax ?? "")}"></td>
          <td><input type="number" class="t-dayMax" min="0" max="10" placeholder="0 = limitsiz" value="${(data?.dayMax ?? "")}"></td>
          <td>${buildHourCheckboxes(hourMax)}</td>
          <td>${buildDayCheckboxes(dayCount)}</td>
          <td class="no-print">
            <button type="button" class="ep-btn-secondary rounded-xl border border-slate-200/70 dark:border-slate-800/70 px-2 py-2 text-xs">ğŸ—‘ï¸</button>
          </td>
        `;

        teacherTbody.appendChild(tr);

        // restore checks
        const hours = (data?.hours && Array.isArray(data.hours)) ? data.hours : null;
        if (hours) {
          tr.querySelectorAll(".t-hour").forEach((cb) => {
            const h = parseInt(cb.dataset.hour, 10);
            cb.checked = !!hours[h - 1];
          });
        }

        const days = (data?.days && Array.isArray(data.days)) ? data.days : null;
        if (days) {
          tr.querySelectorAll(".t-day").forEach((cb) => {
            const d = parseInt(cb.dataset.day, 10);
            cb.checked = !!days[d];
          });
        }

        // delete
        tr.querySelector("button")?.addEventListener("click", () => {
          tr.remove();
          refreshLessonDropdowns();
          saveState();
        });

        // mini actions
        tr.addEventListener("click", (e) => {
          const btn = e.target?.closest?.("[data-mini]");
          if (!btn) return;
          const mode = btn.dataset.mini;
          const cell = btn.closest("td");
          if (!cell) return;
          const scope = cell.querySelector("[data-scope]");
          if (!scope) return;
          const boxes = scope.querySelectorAll("input[type=checkbox]");
          boxes.forEach((cb) => {
            if (cb.disabled) return;
            cb.checked = (mode === "all");
          });
          saveState();
        });

        // save on change
        tr.addEventListener("change", () => {
          refreshLessonDropdowns();
          saveState();
        });
      }

      function addClassRow(data = null) {
        const tr = document.createElement("tr");
        tr.dataset.id = uid("c");

        tr.innerHTML = `
          <td><input type="text" class="c-name" placeholder="MÉ™s: 5A" value="${data?.name ? escapeHtml(data.name) : ""}"></td>
          <td>
            <select class="c-level">
              <option value="Ä°btidai">Ä°btidai</option>
              <option value="Orta">Orta</option>
              <option value="YuxarÄ±">YuxarÄ±</option>
            </select>
          </td>
          <td>
            <select class="c-shift">
              <option value="SÉ™hÉ™r">SÉ™hÉ™r</option>
              <option value="GÃ¼norta">GÃ¼norta</option>
            </select>
          </td>
          <td><input type="number" class="c-dayMax" min="1" max="8" placeholder="BoÅŸ = standart" value="${(data?.dayMax ?? "")}"></td>
          <td class="no-print">
            <button type="button" class="ep-btn-secondary rounded-xl border border-slate-200/70 dark:border-slate-800/70 px-2 py-2 text-xs">ğŸ—‘ï¸</button>
          </td>
        `;

        classTbody.appendChild(tr);

        if (data?.level) tr.querySelector(".c-level").value = data.level;
        if (data?.shift) tr.querySelector(".c-shift").value = data.shift;

        tr.querySelector("button")?.addEventListener("click", () => {
          tr.remove();
          refreshLessonDropdowns();
          saveState();
        });

        tr.addEventListener("change", () => {
          refreshLessonDropdowns();
          saveState();
        });
        tr.addEventListener("input", () => {
          refreshLessonDropdowns();
          saveState();
        });
      }

      function teacherOptionsHtml(teachers) {
        let out = `<option value="">â€” seÃ§in â€”</option>`;
        teachers.forEach(t => {
          const label = (t.code ? `${t.code} â€” ` : "") + (t.name || "");
          out += `<option value="${escapeHtml(t.code || t.name)}">${escapeHtml(label || (t.code || "MÃ¼É™llim"))}</option>`;
        });
        return out;
      }

      function classOptionsHtml(classes) {
        let out = `<option value="">â€” seÃ§in â€”</option>`;
        classes.forEach(c => {
          out += `<option value="${escapeHtml(c.name)}">${escapeHtml(c.name)}</option>`;
        });
        return out;
      }

      function addLessonRow(data = null) {
        const tr = document.createElement("tr");
        tr.dataset.id = uid("l");

        tr.innerHTML = `
          <td>
            <select class="l-class"></select>
          </td>
          <td><input type="text" class="l-subject" placeholder="MÉ™s: Riyaziyyat" value="${data?.subject ? escapeHtml(data.subject) : ""}"></td>
          <td>
            <select class="l-teacher"></select>
          </td>
          <td><input type="number" class="l-weekly" min="1" max="30" value="${(data?.weekly ?? "")}"></td>
          <td class="text-center"><input type="checkbox" class="l-heavy" ${data?.heavy ? "checked" : ""}></td>
          <td>
            <select class="l-double">
              <option value="no">Yox</option>
              <option value="prefer">Ä°mkan daxilindÉ™</option>
              <option value="must">MÃ¼tlÉ™q</option>
            </select>
          </td>
          <td class="no-print">
            <button type="button" class="ep-btn-secondary rounded-xl border border-slate-200/70 dark:border-slate-800/70 px-2 py-2 text-xs">ğŸ—‘ï¸</button>
          </td>
        `;

        lessonTbody.appendChild(tr);

        refreshLessonDropdowns();

        if (data?.className) tr.querySelector(".l-class").value = data.className;
        if (data?.teacherKey) tr.querySelector(".l-teacher").value = data.teacherKey;
        if (data?.doubleMode) tr.querySelector(".l-double").value = data.doubleMode;

        tr.querySelector("button")?.addEventListener("click", () => {
          tr.remove();
          saveState();
        });

        tr.addEventListener("change", saveState);
        tr.addEventListener("input", saveState);
      }

      function refreshLessonDropdowns() {
        const teachers = readTeachersRaw();
        const classes = readClassesRaw();

        // update lesson rows selects without losing current values
        lessonTbody.querySelectorAll("tr").forEach(tr => {
          const classSel = tr.querySelector(".l-class");
          const tSel = tr.querySelector(".l-teacher");
          const prevC = classSel?.value || "";
          const prevT = tSel?.value || "";

          if (classSel) classSel.innerHTML = classOptionsHtml(classes);
          if (tSel) tSel.innerHTML = teacherOptionsHtml(teachers);

          if (classSel && prevC) classSel.value = prevC;
          if (tSel && prevT) tSel.value = prevT;
        });
      }

      // ---------------------------
      // Read current config (DOM -> Objects)
      // ---------------------------
      function readTeachersRaw() {
        const dayCount = clampInt(daysCountEl?.value, 5, 6, 5);
        const hourMax = clampInt(lessonsPerDayEl?.value, 1, 8, 7);

        const rows = Array.from(teacherTbody.querySelectorAll("tr"));
        return rows.map(tr => {
          const name = tr.querySelector(".t-name")?.value?.trim() || "";
          const code = tr.querySelector(".t-code")?.value?.trim() || "";
          const weekMax = clampInt(tr.querySelector(".t-weekMax")?.value, 0, 200, 0);
          const dayMax = clampInt(tr.querySelector(".t-dayMax")?.value, 0, 20, 0);

          // if user selects none -> means "all", so we interpret later
          const hoursArr = Array.from({length: MAX_HOURS_UI}, () => false);
          const hourBoxes = tr.querySelectorAll(".t-hour");
          let anyHourChecked = false;
          hourBoxes.forEach(cb => {
            const h = parseInt(cb.dataset.hour, 10);
            if (cb.checked) { hoursArr[h - 1] = true; anyHourChecked = true; }
          });
          if (!anyHourChecked) {
            for (let h = 1; h <= hourMax; h++) hoursArr[h - 1] = true;
          }

          const daysArr = Array.from({length: 6}, () => false);
          const dayBoxes = tr.querySelectorAll(".t-day");
          let anyDayChecked = false;
          dayBoxes.forEach(cb => {
            const d = parseInt(cb.dataset.day, 10);
            if (cb.checked) { daysArr[d] = true; anyDayChecked = true; }
          });
          if (!anyDayChecked) {
            for (let d = 0; d < dayCount; d++) daysArr[d] = true;
          }

          // enforce 5-day mode: disable Saturday
          if (dayCount === 5) daysArr[5] = false;

          return { name, code, weekMax, dayMax, hours: hoursArr, days: daysArr };
        });
      }

      function readClassesRaw() {
        const rows = Array.from(classTbody.querySelectorAll("tr"));
        return rows.map(tr => {
          const name = tr.querySelector(".c-name")?.value?.trim() || "";
          const level = tr.querySelector(".c-level")?.value || "Orta";
          const shift = tr.querySelector(".c-shift")?.value || "SÉ™hÉ™r";
          const dm = tr.querySelector(".c-dayMax")?.value?.trim();
          const dayMax = dm === "" ? null : clampInt(dm, 1, 8, null);
          return { name, level, shift, dayMax };
        }).filter(c => c.name);
      }

      function readLessonsRaw() {
        const rows = Array.from(lessonTbody.querySelectorAll("tr"));
        return rows.map(tr => {
          const className = tr.querySelector(".l-class")?.value?.trim() || "";
          const subject = tr.querySelector(".l-subject")?.value?.trim() || "";
          const teacherKey = tr.querySelector(".l-teacher")?.value?.trim() || "";
          const weekly = clampInt(tr.querySelector(".l-weekly")?.value, 0, 60, 0);
          const heavy = !!tr.querySelector(".l-heavy")?.checked;
          const doubleMode = tr.querySelector(".l-double")?.value || "no";
          return { className, subject, teacherKey, weekly, heavy, doubleMode };
        }).filter(l => l.className && l.subject && l.teacherKey && l.weekly > 0);
      }

      // ---------------------------
      // Persistence
      // ---------------------------
      function saveState() {
        try {
          const data = {
            daysCount: clampInt(daysCountEl?.value, 5, 6, 5),
            lessonsPerDay: clampInt(lessonsPerDayEl?.value, 1, 8, 7),
            optHeavyAvoidEdges: !!optHeavyAvoidEdgesEl?.checked,
            optNoClassGaps: !!optNoClassGapsEl?.checked,
            teachers: readTeachersRaw(),
            classes: readClassesRaw(),
            lessons: readLessonsRaw()
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        } catch (e) {}
      }

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return false;
          const data = JSON.parse(raw);

          if (daysCountEl && (data.daysCount === 5 || data.daysCount === 6)) daysCountEl.value = String(data.daysCount);
          if (lessonsPerDayEl) lessonsPerDayEl.value = String(clampInt(data.lessonsPerDay, 1, 8, 7));
          if (optHeavyAvoidEdgesEl) optHeavyAvoidEdgesEl.checked = !!data.optHeavyAvoidEdges;
          if (optNoClassGapsEl) optNoClassGapsEl.checked = !!data.optNoClassGaps;

          teacherTbody.innerHTML = "";
          classTbody.innerHTML = "";
          lessonTbody.innerHTML = "";

          (data.teachers || []).forEach(t => addTeacherRow(t));
          (data.classes || []).forEach(c => addClassRow(c));
          (data.lessons || []).forEach(l => addLessonRow(l));

          refreshLessonDropdowns();
          return true;
        } catch (e) {
          return false;
        }
      }

      function hardReset() {
        teacherTbody.innerHTML = "";
        classTbody.innerHTML = "";
        lessonTbody.innerHTML = "";
        classTabs.innerHTML = "";
        timetableContainer.innerHTML = `<div class="text-[12px] text-slate-500 dark:text-slate-400">HÉ™lÉ™ cÉ™dvÉ™l qurulmayÄ±b.</div>`;
        unplacedContainer.classList.add("hidden");
        unplacedContainer.textContent = "";
        softWarnings.textContent = "";
        resultStats.textContent = "";
        clearError();
        setInfo("");
        try { localStorage.removeItem(STORAGE_KEY); } catch (e) {}
      }

      // ---------------------------
      // Constraints + Scheduler (QoÅŸa rules updated)
      // ---------------------------
      function validateConfig(cfg) {
        const errors = [];
        const warns = [];

        const dayCount = cfg.dayCount;
        const hourMax = cfg.hourMax;

        if (cfg.classes.length === 0) errors.push("Æn az 1 sinif É™lavÉ™ edin.");
        if (cfg.teachers.length === 0) errors.push("Æn az 1 mÃ¼É™llim É™lavÉ™ edin.");
        if (cfg.lessons.length === 0) errors.push("Æn az 1 fÉ™nn/dÉ™rs sÉ™tiri É™lavÉ™ edin.");

        // teacher map by exact code OR exact name (trimmed)
        const teacherByKey = new Map();
        cfg.teachers.forEach((t, idx) => {
          if (t.code) teacherByKey.set(t.code, idx);
          if (t.name) teacherByKey.set(t.name, idx);
        });

        const classByName = new Map();
        cfg.classes.forEach((c, idx) => classByName.set(c.name, idx));

        // Lesson references and feasibility rules
        cfg.lessons.forEach((l, i) => {
          if (!classByName.has(l.className)) errors.push(`FÉ™nn sÉ™tiri #${i+1}: sinif tapÄ±lmadÄ± (â€œ${l.className}â€).`);
          if (!teacherByKey.has(l.teacherKey)) errors.push(`FÉ™nn sÉ™tiri #${i+1}: mÃ¼É™llim tapÄ±lmadÄ± (â€œ${l.teacherKey}â€).`);

          if (l.doubleMode !== "no") {
            if (l.weekly % 2 !== 0) {
              errors.push(`â€œ${l.className} â€” ${l.subject}â€: QoÅŸa seÃ§ilibsÉ™ hÉ™ftÉ™lik saat mÃ¼tlÉ™q cÃ¼t olmalÄ±dÄ±r.`);
            }
          } else {
            // QoÅŸa=Yox => eyni gÃ¼ndÉ™ max 1
            if (l.weekly > dayCount) {
              errors.push(`â€œ${l.className} â€” ${l.subject}â€: QoÅŸa=Yox Ã¼Ã§Ã¼n hÉ™ftÉ™lik saat ${dayCount}-dÉ™n Ã§ox ola bilmÉ™z (Ã§Ã¼nki eyni gÃ¼ndÉ™ max 1).`);
            }
          }

          if (l.weekly > dayCount * hourMax) {
            errors.push(`â€œ${l.className} â€” ${l.subject}â€: hÉ™ftÉ™lik saat Ã¼mumi tutumu aÅŸÄ±r (gÃ¼nÃ—saat).`);
          }
        });

        // Capacity per class
        cfg.classes.forEach((c) => {
          const dayMax = c.dayMax ?? hourMax;
          const sum = cfg.lessons.filter(l => l.className === c.name).reduce((a,b)=>a+b.weekly,0);
          if (sum > dayCount * dayMax) {
            errors.push(`â€œ${c.name}â€: hÉ™ftÉ™lik toplam saat (${sum}) tutumu aÅŸÄ±r ( ${dayCount}Ã—${dayMax} ).`);
          }
          if (cfg.optNoClassGaps && dayMax > hourMax) {
            warns.push(`â€œ${c.name}â€: sinif gÃ¼ndÉ™lik max (${dayMax}) Ã¼mumi max-dan (${hourMax}) bÃ¶yÃ¼kdÃ¼r â€” sistem yenÉ™ ${hourMax} Ã§É™rÃ§ivÉ™sindÉ™ quracaq.`);
          }
        });

        // Teacher weekly max
        cfg.teachers.forEach((t) => {
          if (t.weekMax > 0) {
            const load = cfg.lessons.reduce((acc,l)=> {
              if (l.teacherKey === t.code || l.teacherKey === t.name) return acc + l.weekly;
              return acc;
            },0);
            if (load > t.weekMax) {
              warns.push(`MÃ¼É™llim â€œ${t.code || t.name}â€: hÉ™ftÉ™lik yÃ¼k (${load}) hÉ™ftÉ™lik max-dan (${t.weekMax}) Ã§oxdur â€” hÉ™ll mÃ¼mkÃ¼nsÃ¼z ola bilÉ™r.`);
            }
          }
        });

        return { errors, warns, teacherByKey, classByName };
      }

      function buildTasks(cfg, teacherByKey, classByName) {
        const tasks = [];
        cfg.lessons.forEach((l) => {
          const classIdx = classByName.get(l.className);
          const teacherIdx = teacherByKey.get(l.teacherKey);

          if (l.doubleMode === "no") {
            for (let k = 0; k < l.weekly; k++) {
              tasks.push({
                type: "single",
                classIdx, teacherIdx,
                subject: l.subject,
                heavy: l.heavy,
                preferConsecutive: false,
                fixedDay: null
              });
            }
          } else if (l.doubleMode === "must") {
            const pairs = l.weekly / 2;
            for (let p = 0; p < pairs; p++) {
              tasks.push({
                type: "double_must",
                classIdx, teacherIdx,
                subject: l.subject,
                heavy: l.heavy,
                preferConsecutive: true, // must consecutive
                fixedDay: null
              });
            }
          } else {
            // prefer => same day MUST be 2, consecutive preferred
            const pairs = l.weekly / 2;
            for (let p = 0; p < pairs; p++) {
              tasks.push({
                type: "double_prefer",
                classIdx, teacherIdx,
                subject: l.subject,
                heavy: l.heavy,
                preferConsecutive: true,  // try consecutive first
                fixedDay: null
              });
            }
          }
        });
        return tasks;
      }

      function initState(cfg) {
        const dayCount = cfg.dayCount;
        const hourMax = cfg.hourMax;

        const classSched = cfg.classes.map(() =>
          Array.from({ length: dayCount }, () => Array.from({ length: hourMax }, () => null))
        );

        const classDayCount = cfg.classes.map(() =>
          Array.from({ length: dayCount }, () => 0)
        );

        const classSubDay = cfg.classes.map(() =>
          Array.from({ length: dayCount }, () => ({}))
        );

        const teacherBusy = cfg.teachers.map(() =>
          Array.from({ length: dayCount }, () => Array.from({ length: hourMax }, () => false))
        );

        const teacherDayCount = cfg.teachers.map(() =>
          Array.from({ length: dayCount }, () => 0)
        );

        const teacherWeekCount = cfg.teachers.map(() => 0);

        return {
          classSched,
          classDayCount,
          classSubDay,
          teacherBusy,
          teacherDayCount,
          teacherWeekCount,
          placed: 0,
          penalties: 0,
          pending: [] // for double_prefer second lesson when consecutive not possible now
        };
      }

      function canTeacherTeach(cfg, state, teacherIdx, day, slot) {
        const t = cfg.teachers[teacherIdx];
        if (!t) return false;
        if (!t.days[day]) return false;
        if (!t.hours[slot]) return false;

        if (state.teacherBusy[teacherIdx][day][slot]) return false;

        // daily max
        if (t.dayMax > 0 && state.teacherDayCount[teacherIdx][day] + 1 > t.dayMax) return false;

        // weekly max
        if (t.weekMax > 0 && state.teacherWeekCount[teacherIdx] + 1 > t.weekMax) return false;

        return true;
      }

      function classDayMax(cfg, classIdx) {
        const c = cfg.classes[classIdx];
        return (c.dayMax ?? cfg.hourMax);
      }

      function canPlaceSingle(cfg, state, task, day, slot) {
        // slot is 0-based, within cfg.hourMax
        if (state.classSched[task.classIdx][day][slot] !== null) return false;

        // class daily max
        if (state.classDayCount[task.classIdx][day] + 1 > classDayMax(cfg, task.classIdx)) return false;

        // QoÅŸa=Yox rule => same subject max 1 per day
        const subCnt = state.classSubDay[task.classIdx][day][task.subject] || 0;
        if (subCnt >= 1) return false;

        // teacher constraints
        if (!canTeacherTeach(cfg, state, task.teacherIdx, day, slot)) return false;

        return true;
      }

      function canPlaceDoubleConsecutive(cfg, state, task, day, startSlot) {
        const s1 = startSlot;
        const s2 = startSlot + 1;
        if (s2 >= cfg.hourMax) return false;

        if (state.classSched[task.classIdx][day][s1] !== null) return false;
        if (state.classSched[task.classIdx][day][s2] !== null) return false;

        // class daily max
        if (state.classDayCount[task.classIdx][day] + 2 > classDayMax(cfg, task.classIdx)) return false;

        // subject same day max 2 (and also must become exactly 2 for this pair)
        const subCnt = state.classSubDay[task.classIdx][day][task.subject] || 0;
        if (subCnt > 0) return false; // we want this pair to occupy the 2 occurrences; no more for same subject/day
        // (If you have multiple pairs of same subject, they must be on different days.)

        // teacher constraints for both slots
        if (!canTeacherTeach(cfg, state, task.teacherIdx, day, s1)) return false;
        if (!canTeacherTeach(cfg, state, task.teacherIdx, day, s2)) return false;

        return true;
      }

      function place(cfg, state, task, day, slot) {
        // place a single lesson at (day,slot)
        state.classSched[task.classIdx][day][slot] = {
          subject: task.subject,
          teacherIdx: task.teacherIdx,
          heavy: task.heavy
        };
        state.classDayCount[task.classIdx][day] += 1;

        const prev = state.classSubDay[task.classIdx][day][task.subject] || 0;
        state.classSubDay[task.classIdx][day][task.subject] = prev + 1;

        state.teacherBusy[task.teacherIdx][day][slot] = true;
        state.teacherDayCount[task.teacherIdx][day] += 1;
        state.teacherWeekCount[task.teacherIdx] += 1;

        state.placed += 1;

        // soft: heavy edge avoid
        if (cfg.optHeavyAvoidEdges && task.heavy) {
          if (slot === 0 || slot === cfg.hourMax - 1) state.penalties += 1;
        }
      }

      function placeDoubleConsecutive(cfg, state, task, day, startSlot) {
        place(cfg, state, task, day, startSlot);
        place(cfg, state, task, day, startSlot + 1);
      }

      function scoreState(state, total) {
        const ratio = total > 0 ? state.placed / total : 0;
        // higher is better: placed ratio dominates, then fewer penalties
        return ratio * 1000 - state.penalties;
      }

      function pickDayOrder(cfg, state, classIdx) {
        const days = Array.from({length: cfg.dayCount}, (_, i) => i);
        // prefer days with fewer lessons to balance
        days.sort((a,b) => state.classDayCount[classIdx][a] - state.classDayCount[classIdx][b]);
        // small random jitter
        if (Math.random() < 0.35) shuffle(days);
        return days;
      }

      function nextSlotForDay(cfg, state, classIdx, day) {
        if (!cfg.optNoClassGaps) {
          // allow any empty, but prefer earlier
          for (let s = 0; s < cfg.hourMax; s++) {
            if (state.classSched[classIdx][day][s] === null) return s;
          }
          return null;
        }
        // no gaps => always next contiguous slot
        const s = state.classDayCount[classIdx][day];
        if (s >= cfg.hourMax) return null;
        return s;
      }

      function tryPlaceTaskGreedy(cfg, state, task) {
        const classIdx = task.classIdx;

        const days = task.fixedDay !== null ? [task.fixedDay] : pickDayOrder(cfg, state, classIdx);

        for (const day of days) {
          const dayMax = classDayMax(cfg, classIdx);
          const leftCap = dayMax - state.classDayCount[classIdx][day];

          if (task.type === "single") {
            const slot = nextSlotForDay(cfg, state, classIdx, day);
            if (slot === null) continue;
            if (canPlaceSingle(cfg, state, task, day, slot)) {
              place(cfg, state, task, day, slot);
              return true;
            }
          }

          if (task.type === "double_must") {
            if (leftCap < 2) continue;
            const slot = nextSlotForDay(cfg, state, classIdx, day);
            if (slot === null) continue;

            // Must be consecutive; if no-gaps false, still must consecutive but can start anywhere empty consecutive
            if (!cfg.optNoClassGaps) {
              for (let s = 0; s < cfg.hourMax - 1; s++) {
                if (canPlaceDoubleConsecutive(cfg, state, task, day, s)) {
                  placeDoubleConsecutive(cfg, state, task, day, s);
                  return true;
                }
              }
            } else {
              if (canPlaceDoubleConsecutive(cfg, state, task, day, slot)) {
                placeDoubleConsecutive(cfg, state, task, day, slot);
                return true;
              }
            }
          }

          if (task.type === "double_prefer") {
            if (leftCap < 2) continue;

            // consecutive preferred: try consecutive now if possible
            if (cfg.optNoClassGaps) {
              const slot = nextSlotForDay(cfg, state, classIdx, day);
              if (slot === null) continue;

              if (canPlaceDoubleConsecutive(cfg, state, task, day, slot)) {
                placeDoubleConsecutive(cfg, state, task, day, slot);
                return true;
              }

              // cannot do consecutive now: place first now, force second later same day
              // for "prefer" we still MUST have 2 same day, not necessarily consecutive.
              // We'll place first now if possible with subjectCount==0.
              if (canPlaceSingle(cfg, state, task, day, slot)) {
                // but for double_prefer, subject can be at most 2/day; we must reserve second.
                place(cfg, state, task, day, slot);

                // push pending second constrained to same day, but allow subjectCount currently 1
                state.pending.push({
                  type: "pending_second",
                  classIdx: task.classIdx,
                  teacherIdx: task.teacherIdx,
                  subject: task.subject,
                  heavy: task.heavy,
                  fixedDay: day
                });
                return true;
              }
            } else {
              // gaps allowed: try any consecutive anywhere first
              for (let s = 0; s < cfg.hourMax - 1; s++) {
                if (canPlaceDoubleConsecutive(cfg, state, task, day, s)) {
                  placeDoubleConsecutive(cfg, state, task, day, s);
                  return true;
                }
              }
              // else: place two singles on same day (not necessarily consecutive)
              // ensure subjectCount==0 initially
              const subCnt = state.classSubDay[classIdx][day][task.subject] || 0;
              if (subCnt !== 0) continue;

              // find two slots that teacher can take
              const slots = [];
              for (let s = 0; s < cfg.hourMax; s++) {
                if (state.classSched[classIdx][day][s] !== null) continue;
                if (!canTeacherTeach(cfg, state, task.teacherIdx, day, s)) continue;
                slots.push(s);
              }
              if (slots.length >= 2) {
                // place first, then second
                place(cfg, state, task, day, slots[0]);
                place(cfg, state, task, day, slots[1]);
                return true;
              }
            }
          }

          if (task.type === "pending_second") {
            // must complete pair on same day; subject must be exactly 2 that day at end.
            const slot = nextSlotForDay(cfg, state, classIdx, day);
            if (slot === null) continue;

            // For pending second: allow subjectCount==1 only
            const subCnt = state.classSubDay[classIdx][day][task.subject] || 0;
            if (subCnt !== 1) continue; // if already 2 or 0, something inconsistent
            // also ensure teacher available
            if (!canTeacherTeach(cfg, state, task.teacherIdx, day, slot)) continue;

            // class daily max
            if (state.classDayCount[classIdx][day] + 1 > classDayMax(cfg, classIdx)) continue;

            // Place second
            place(cfg, state, task, day, slot);
            return true;
          }
        }

        return false;
      }

      async function generateSchedule(cfg, tasks) {
        const total = tasks.reduce((acc, t) => {
          if (t.type === "double_must") return acc + 2;
          if (t.type === "double_prefer") return acc + 2;
          return acc + 1;
        }, 0);

        const MAX_TRIES = 600; // browser-friendly; best-effort
        let best = null;
        let bestScoreVal = -Infinity;
        let attempts = 0;

        for (attempts = 1; attempts <= MAX_TRIES; attempts++) {
          if (stopRequested) break;

          const state = initState(cfg);

          // order: must double first, then prefer, then singles
          const base = tasks.slice();
          base.sort((a,b) => {
            const w = (x) => (x.type === "double_must" ? 0 : x.type === "double_prefer" ? 1 : 2);
            return w(a) - w(b);
          });
          // shuffle within bands
          const bands = [[],[],[]];
          base.forEach(t => bands[(t.type==="double_must")?0:(t.type==="double_prefer")?1:2].push(t));
          bands.forEach(shuffle);
          const queue = [...bands[0], ...bands[1], ...bands[2]];

          let ok = true;

          for (let i = 0; i < queue.length; i++) {
            if (stopRequested) { ok = false; break; }

            const t = queue[i];
            const placed = tryPlaceTaskGreedy(cfg, state, t);
            if (!placed) { ok = false; break; }

            // occasionally attempt to place pending items earlier to reduce dead-ends
            if (state.pending.length && Math.random() < 0.25) {
              const pend = state.pending.shift();
              if (pend) {
                const pPlaced = tryPlaceTaskGreedy(cfg, state, pend);
                if (!pPlaced) {
                  // put it back and continue; may fail later
                  state.pending.unshift(pend);
                }
              }
            }
          }

          // after main tasks, must finish all pending seconds
          if (ok) {
            // try to finish all pending in some order
            shuffle(state.pending);
            while (state.pending.length) {
              if (stopRequested) { ok = false; break; }
              const pend = state.pending.shift();
              if (!tryPlaceTaskGreedy(cfg, state, pend)) { ok = false; break; }
            }
          }

          const sc = scoreState(state, total);
          if (sc > bestScoreVal) {
            bestScoreVal = sc;
            best = state;
          }

          // UI update
          if (attempts % 20 === 0) {
            setInfo(`CÉ™hd: ${attempts}/${MAX_TRIES} Â· Æn yaxÅŸÄ± nÉ™ticÉ™: ${Math.round((best?.placed || 0) / total * 100)}%`);
            await nextTick();
          }

          if (ok && best && best.placed === total) {
            setInfo(`Tam hÉ™ll tapÄ±ldÄ± Â· CÉ™hd: ${attempts}`);
            return { state: best, total, attempts, perfect: true };
          }
        }

        return { state: best, total, attempts, perfect: false };
      }

      // ---------------------------
      // Render
      // ---------------------------
      function renderTimetable(cfg, state, activeClassIdx = 0) {
        if (!state) return;

        const dayLabels = DAY_LABELS.slice(0, cfg.dayCount);
        const hourLabels = Array.from({length: cfg.hourMax}, (_, i) => String(i+1));

        const c = cfg.classes[activeClassIdx];
        const sched = state.classSched[activeClassIdx];

        let html = `
          <div class="mb-2 text-sm font-semibold">${escapeHtml(c.name)}</div>
          <table class="tt-table">
            <thead>
              <tr>
                <th>Saat</th>
                ${dayLabels.map(d => `<th>${escapeHtml(d)}</th>`).join("")}
              </tr>
            </thead>
            <tbody>
              ${hourLabels.map((h, row) => {
                const tds = dayLabels.map((_, day) => {
                  const cell = sched[day][row];
                  if (!cell) return `<td class="tt-slot-muted">â€”</td>`;
                  const teacher = cfg.teachers[cell.teacherIdx];
                  const tLabel = (teacher?.code || teacher?.name || "");
                  return `<td>
                    <div class="font-semibold">${escapeHtml(cell.subject)}</div>
                    <div class="text-[11px] text-slate-500 dark:text-slate-300">${escapeHtml(tLabel)}</div>
                  </td>`;
                }).join("");
                return `<tr><th>${h}</th>${tds}</tr>`;
              }).join("")}
            </tbody>
          </table>
        `;

        timetableContainer.innerHTML = html;

        // stats
        const placed = state.placed;
        resultStats.textContent = `Doluluq: ${Math.round((placed / (cfg.totalSlots || 1)) * 100)}% Â· CÉ™mlÉ™nÉ™n dÉ™rs: ${placed}`;
      }

      function renderTabs(cfg, state) {
        classTabs.innerHTML = "";
        cfg.classes.forEach((c, idx) => {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "tab-btn" + (idx === 0 ? " active" : "");
          b.textContent = c.name;
          b.addEventListener("click", () => {
            classTabs.querySelectorAll(".tab-btn").forEach(x => x.classList.remove("active"));
            b.classList.add("active");
            renderTimetable(cfg, state, idx);
          });
          classTabs.appendChild(b);
        });
      }

      function renderUnplaced(result, cfg) {
        const { state, total, perfect } = result;
        const placed = state?.placed || 0;

        // show unplaced summary (best-effort, since greedy doesn't track exact list)
        // We'll estimate missing counts per class/day by capacity and placed ratio.
        if (perfect) {
          unplacedContainer.classList.add("hidden");
          unplacedContainer.textContent = "";
          return;
        }

        const missing = Math.max(0, total - placed);
        unplacedContainer.classList.remove("hidden");
        unplacedContainer.textContent =
          `Tam hÉ™ll tapÄ±lmadÄ±. YerlÉ™ÅŸdirilmÉ™yÉ™n dÉ™rs sayÄ± (tÉ™xmini): ${missing}\n` +
          `TÃ¶vsiyÉ™: mÃ¼É™llim uyÄŸun gÃ¼n/saatlarÄ±nÄ± geniÅŸlÉ™ndirin, gÃ¼ndÉ™lik limitlÉ™ri artÄ±rÄ±n, vÉ™ ya QoÅŸa qaydalarÄ±nÄ± yumÅŸaldÄ±n.`;
      }

      // ---------------------------
      // Main action: Generate
      // ---------------------------
      async function onGenerateClick() {
        if (isGenerating) {
          stopRequested = true;
          setInfo("DayandÄ±rÄ±lÄ±râ€¦");
          return;
        }

        clearError();
        softWarnings.textContent = "";
        unplacedContainer.classList.add("hidden");
        unplacedContainer.textContent = "";

        const dayCount = clampInt(daysCountEl?.value, 5, 6, 5);
        const hourMax = clampInt(lessonsPerDayEl?.value, 1, 8, 7);

        const cfg = {
          dayCount,
          hourMax,
          optHeavyAvoidEdges: !!optHeavyAvoidEdgesEl?.checked,
          optNoClassGaps: !!optNoClassGapsEl?.checked,
          teachers: readTeachersRaw().filter(t => t.name || t.code),
          classes: readClassesRaw(),
          lessons: readLessonsRaw()
        };

        cfg.totalSlots = cfg.classes.length * cfg.dayCount * cfg.hourMax;

        const { errors, warns, teacherByKey, classByName } = validateConfig(cfg);
        if (warns.length) softWarnings.textContent = warns.join(" Â· ");
        if (errors.length) {
          showError(errors.join(" "));
          return;
        }

        const tasks = buildTasks(cfg, teacherByKey, classByName);

        isGenerating = true;
        stopRequested = false;
        btnGenerate.textContent = "ğŸ›‘ DayandÄ±r";
        btnGenerate.classList.add("brightness-110");

        setInfo("AxtarÄ±ÅŸ baÅŸladÄ±â€¦");

        const res = await generateSchedule(cfg, tasks);

        isGenerating = false;
        stopRequested = false;
        btnGenerate.textContent = "âš™ï¸ CÉ™dvÉ™li qur";
        btnGenerate.classList.remove("brightness-110");

        if (!res.state) {
          showError("HeÃ§ bir nÉ™ticÉ™ alÄ±na bilmÉ™di. MÉ™lumatlarÄ± yoxlayÄ±n vÉ™ yenidÉ™n cÉ™hd edin.");
          return;
        }

        renderTabs(cfg, res.state);
        renderTimetable(cfg, res.state, 0);
        renderUnplaced(res, cfg);

        if (res.perfect) {
          setInfo(`Tam hÉ™ll tapÄ±ldÄ± Â· CÉ™hd: ${res.attempts}`);
        } else {
          setInfo(`Tam hÉ™ll tapÄ±lmadÄ± Â· CÉ™hd: ${res.attempts} Â· Æn yaxÅŸÄ±: ${Math.round(res.state.placed / res.total * 100)}%`);
        }
      }

      // ---------------------------
      // React to school param changes
      // ---------------------------
      function syncTeacherHoursDaysUI() {
        const dayCount = clampInt(daysCountEl?.value, 5, 6, 5);
        const hourMax = clampInt(lessonsPerDayEl?.value, 1, 8, 7);

        // update teacher hour disables and day disables
        teacherTbody.querySelectorAll("tr").forEach(tr => {
          tr.querySelectorAll(".t-hour").forEach(cb => {
            const h = parseInt(cb.dataset.hour, 10);
            cb.disabled = h > hourMax;
            if (cb.disabled) cb.checked = false;
          });
          tr.querySelectorAll(".t-day").forEach(cb => {
            const d = parseInt(cb.dataset.day, 10);
            cb.disabled = (dayCount === 5 && d === 5);
            if (cb.disabled) cb.checked = false;
          });
        });
      }

      // ---------------------------
      // Bindings
      // ---------------------------
      btnAddTeacher?.addEventListener("click", () => { addTeacherRow(); refreshLessonDropdowns(); saveState(); });
      btnAddClass?.addEventListener("click", () => { addClassRow(); refreshLessonDropdowns(); saveState(); });
      btnAddLesson?.addEventListener("click", () => { addLessonRow(); saveState(); });

      btnGenerate?.addEventListener("click", onGenerateClick);

      btnResetAll?.addEventListener("click", () => {
        if (isGenerating) return;
        hardReset();
      });

      daysCountEl?.addEventListener("change", () => {
        syncTeacherHoursDaysUI();
        refreshLessonDropdowns();
        saveState();
      });
      lessonsPerDayEl?.addEventListener("change", () => {
        syncTeacherHoursDaysUI();
        saveState();
      });

      optHeavyAvoidEdgesEl?.addEventListener("change", saveState);
      optNoClassGapsEl?.addEventListener("change", saveState);

      // ---------------------------
      // Init
      // ---------------------------
      const loaded = loadState();
      if (!loaded) {
        // starter rows
        addTeacherRow();
        addClassRow();
        addLessonRow();
      }
      syncTeacherHoursDaysUI();
      refreshLessonDropdowns();
      saveState();

    })();
  </script>

</body>
</html>
