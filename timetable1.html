<!doctype html>
<html lang="az" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî EduPlan</title>
  <meta name="description" content="Az…ôrbaycan orta m…ôkt…ôbl…ôri √º√ß√ºn onlayn D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî m√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± daxil edin, sistem avtomatik c…ôdv…ôl qursun." />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="az" />
  <meta name="format-detection" content="telephone=no" />

  <link rel="canonical" href="https://www.eduplan.az/timetable.html" />

  <!-- Favicons / PWA -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0ea5e9">
  <link rel="manifest" href="/manifest.webmanifest">

  <meta name="application-name" content="EduPlan" />
  <meta name="apple-mobile-web-app-title" content="EduPlan" />

  <!-- Theme color (JS il…ô d…ôyi≈ü…ôc…ôk) -->
  <meta name="theme-color" content="#ffffff" id="theme-color" />

  <!-- Open Graph -->
  <meta property="og:site_name" content="EduPlan" />
  <meta property="og:locale" content="az_AZ" />
  <meta property="og:title" content="D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ± ‚Äî EduPlan" />
  <meta property="og:description" content="M√º…ôllim v…ô sinif m…ôlumatlarƒ±nƒ± daxil edin, sistem avtomatik d…ôrs c…ôdv…ôli hazƒ±rlasƒ±n." />
  <meta property="og:url" content="https://www.eduplan.az/timetable.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.eduplan.az/android-chrome-512x512.png" />

  <!-- Tema: FOUC olmamasƒ± √º√ß√ºn (Tailwind y√ºkl…ônm…ômi≈üd…ôn …ôvv…ôl) -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = (saved === 'dark' || saved === 'light') ? saved : (systemDark ? 'dark' : 'light');

        const root = document.documentElement;
        root.classList.toggle('dark', theme === 'dark');
        root.dataset.theme = theme;

        const meta = document.getElementById('theme-color');
        if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b1220' : '#ffffff');
      } catch (e) {}
    })();
  </script>

  <!-- ‚úÖ Tailwind CDN (∆èVV∆èL script, SONRA config) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <style>
    html, body { overflow-x: hidden; }
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }

    /* Fixed header olan saytda anchor scroll zamanƒ± √ºst√º √∂rtm…ôsin */
    html { scroll-padding-top: 80px; }

    /* Ana s…ôhif…ô il…ô eyni hover hissi */
    .card-surface {
      transition: box-shadow 200ms ease, transform 200ms ease;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.06);
    }
    .card-surface:hover {
      box-shadow:
        0 12px 30px rgba(15, 23, 42, 0.12),
        0 4px 12px rgba(15, 23, 42, 0.08);
    }
    html.dark .card-surface {
      box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    }
    html.dark .card-surface:hover {
      box-shadow:
        0 12px 30px rgba(0, 0, 0, 0.55),
        0 4px 12px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(255, 255, 255, 0.06);
    }

    /* Form / c…ôdv…ôl UI (lokal) */
    .section-title{
      font-size:.85rem;
      font-weight:600;
      letter-spacing:.02em;
      text-transform:uppercase;
      color:#64748b;
    }
    html.dark .section-title{ color:#94a3b8; }

    table.config-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 6px;
      font-size:.82rem;
    }
    table.config-table th{
      text-align:left;
      font-weight:500;
      color:#64748b;
      padding:4px 6px;
      font-size:.75rem;
      white-space:nowrap;
    }
    html.dark table.config-table th{ color:#94a3b8; }

    table.config-table td{ padding:4px 6px; vertical-align:top; }

    table.config-table input,
    table.config-table select{
      width:100%;
      border-radius:.8rem;
      border:1px solid rgba(226,232,240,.7);
      padding:.45rem .7rem;
      font-size:.82rem;
      outline:none;
      background: rgba(255,255,255,.7);
      color: rgb(15,23,42);
    }
    html.dark table.config-table input,
    html.dark table.config-table select{
      border-color: rgba(51,65,85,.7);
      background: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }
    table.config-table input:focus,
    table.config-table select:focus{
      border-color:#6366f1;
      box-shadow:0 0 0 2px rgba(129,140,248,.25);
    }

    .tab-btn{
      border-radius:9999px;
      padding:.3rem .8rem;
      font-size:.8rem;
      border:1px solid transparent;
      background:transparent;
      cursor:pointer;
      white-space:nowrap;
    }
    .tab-btn.active{
      border-color:#0ea5e9;
      background:rgba(14,165,233,.07);
      color:#0369a1;
    }
    html.dark .tab-btn.active{
      background:rgba(56,189,248,.10);
      color:#e0f2fe;
      border-color:#38bdf8;
    }

    .tt-table{
      width:100%;
      border-collapse:collapse;
      font-size:.82rem;
    }
    .tt-table th,
    .tt-table td{
      border:1px solid rgba(226,232,240,.8);
      padding:.4rem .45rem;
      text-align:center;
    }
    html.dark .tt-table th,
    html.dark .tt-table td{
      border-color: rgba(51,65,85,.8);
    }
    .tt-table th{
      background:rgba(148,163,184,.12);
      font-weight:600;
      font-size:.78rem;
    }
    html.dark .tt-table th{
      background:rgba(255,255,255,.06);
    }
    .tt-slot-muted{
      color:#9ca3af;
      font-style:italic;
    }

    /* √áap √º√ß√ºn ‚Äì yalnƒ±z c…ôdv…ôl qalsƒ±n */
    @media print{
      header, .no-print, footer{ display:none !important; }
      main{ padding:0 !important; max-width:none !important; }
      body{ background:white !important; }
    }
  </style>
</head>

<body class="min-h-screen pt-16 text-slate-900 dark:text-slate-100 bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">

  <!-- Skip link -->
  <a href="#main"
     class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[100] focus:rounded-xl focus:bg-white focus:px-4 focus:py-2 focus:text-slate-900 focus:shadow">
    Kontent…ô ke√ß
  </a>

  <!-- Background blobs (ana s…ôhif…ô il…ô eyni) -->
  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/60 to-emerald-200/60 dark:from-indigo-500/15 dark:to-emerald-500/10"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/60 to-pink-200/60 dark:from-amber-500/10 dark:to-pink-500/10"></div>
  </div>

  <!-- Header (ana s…ôhif…ô il…ô eyni) -->
  <header class="fixed top-0 inset-x-0 z-50 border-b border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/60 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-3">

        <!-- Brand -->
        <a href="/" class="flex items-center gap-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <img
            src="assets/ep-favicon-light.svg"
            alt="EduPlan"
            class="h-9 w-9 dark:hidden"
            width="36"
            height="36"
          />
          <img
            src="assets/ep-favicon-dark.svg"
            alt=""
            aria-hidden="true"
            class="h-9 w-9 hidden dark:block"
            width="36"
            height="36"
          />
          <span class="font-semibold tracking-tight">EduPlan AZ</span>
        </a>

        <!-- Theme toggle -->
        <button
          id="theme-toggle"
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-slate-900/40 p-2 hover:bg-white/80 dark:hover:bg-slate-900/60 transition focus:outline-none focus:ring-2 focus:ring-indigo-400"
          aria-label="Tema d…ôyi≈üdir"
          aria-pressed="false"
        >
          <!-- Sun -->
          <svg class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.5-1.5M20.5 20.5 19 19M19 5l1.5-1.5M3.5 20.5 5 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <!-- Moon -->
          <svg class="h-5 w-5 hidden dark:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 13.2A7.5 7.5 0 0 1 10.8 3 6.9 6.9 0 1 0 21 13.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>

      </div>
    </div>
  </header>

  <!-- Main -->
  <main id="main" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">

    <!-- Page intro -->
    <section class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold tracking-tight leading-snug">
        D…ôrs c…ôdv…ôli hazƒ±rlayƒ±cƒ±
      </h1>
      <p class="mt-3 text-lg text-slate-600 dark:text-slate-300 max-w-3xl">
        M√º…ôllim, sinif v…ô f…ônn m…ôlumatlarƒ±nƒ± daxil et ‚Äî sistem Az…ôrbaycan m…ôkt…ôbl…ôrin…ô uyƒüun m…ôhdudiyy…ôtl…ôrl…ô
        avtomatik d…ôrs c…ôdv…ôli qurmaƒüa √ßalƒ±≈üsƒ±n.
      </p>

      <ul class="mt-5 flex flex-wrap items-center gap-2 text-sm">
        <li class="inline-flex items-center gap-2 rounded-full border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-1.5">
          <span class="h-2.5 w-2.5 rounded-full bg-indigo-400"></span>
          <span>Konflikt minimalla≈üdƒ±rma</span>
        </li>
        <li class="inline-flex items-center gap-2 rounded-full border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-1.5">
          <span class="h-2.5 w-2.5 rounded-full bg-emerald-400"></span>
          <span>G…ôlm…ô g√ºnl…ôri & limitl…ôr</span>
        </li>
        <li class="inline-flex items-center gap-2 rounded-full border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-1.5">
          <span class="h-2.5 w-2.5 rounded-full bg-amber-400"></span>
          <span>√áap / PDF √º√ß√ºn hazƒ±r</span>
        </li>
      </ul>
    </section>

    <!-- Main card -->
    <section class="rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur p-5 sm:p-8 shadow-sm">
      <div class="flex items-center justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">üß© M…ôkt…ôb konfiqurasiyasƒ± v…ô hazƒ±rlayƒ±cƒ±</h2>
        <div class="no-print flex flex-wrap gap-2">
          <button id="btnGenerate"
                  class="inline-flex items-center justify-center rounded-2xl px-4 py-2 text-sm font-semibold text-white
                         bg-gradient-to-r from-sky-500 via-indigo-500 to-fuchsia-500 shadow-sm hover:shadow-md hover:brightness-110">
            ‚öôÔ∏è C…ôdv…ôli qur
          </button>
          <button id="btnResetAll"
                  class="inline-flex items-center justify-center rounded-2xl px-3 py-2 text-xs font-medium
                         border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5
                         hover:bg-white/80 dark:hover:bg-white/10 transition">
            üßπ Hamƒ±sƒ±nƒ± t…ômizl…ô
          </button>
          <button id="btnPrint"
                  class="inline-flex items-center justify-center rounded-2xl px-3 py-2 text-xs font-medium
                         border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5
                         hover:bg-white/80 dark:hover:bg-white/10 transition">
            üñ®Ô∏è √áap / PDF
          </button>
        </div>
      </div>

      <div id="globalError" class="mt-3 hidden rounded-2xl border border-rose-200/70 bg-rose-50/60 px-4 py-3 text-sm text-rose-700 dark:border-rose-900/50 dark:bg-rose-950/30 dark:text-rose-200"></div>
      <div id="globalInfo" class="mt-3 text-sm text-slate-600 dark:text-slate-300"></div>

      <div class="mt-6 grid lg:grid-cols-2 gap-5">
        <!-- LEFT: configuration -->
        <div class="space-y-4">

          <!-- M…ôkt…ôb parametrl…ôri -->
          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="section-title mb-2">M…ôkt…ôb parametrl…ôri</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div>
                <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">H…ôft…ôlik i≈ü g√ºn√º</label>
                <select id="daysCount"
                        class="w-full rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400/40">
                  <option value="5">5 g√ºn (B.e‚ÄìC.u)</option>
                  <option value="6">6 g√ºn (B.e‚Äì≈û)</option>
                </select>
              </div>
              <div>
                <label class="block text-xs mb-1 text-slate-600 dark:text-slate-300">G√ºnd…ô d…ôrs saatƒ± (max)</label>
                <input id="lessonsPerDay" type="number" min="1" max="8" value="7"
                       class="w-full rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400/40" />
              </div>
            </div>

            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-slate-700 dark:text-slate-200">
              <label class="inline-flex items-start gap-2">
                <input id="optHeavyAvoidEdges" type="checkbox" class="mt-1" checked />
                <span>Aƒüƒ±r f…ônl…ôr m√ºmk√ºn q…ôd…ôr 1-ci v…ô sonuncu saatda olmasƒ±n</span>
              </label>
              <label class="inline-flex items-start gap-2">
                <input id="optLimitSameSubject" type="checkbox" class="mt-1" checked />
                <span>Eyni g√ºnd…ô eyni f…ônn 2 d…ôf…ôd…ôn √ßox bir sinifd…ô t…ôkrarlanmasƒ±n</span>
              </label>
            </div>

            <div class="mt-3 text-xs text-slate-500 dark:text-slate-400">
              ƒ∞btidai √º√ß√ºn g√ºnd…ô 6, …ôsas √º√ß√ºn 7, yuxarƒ± √º√ß√ºn 8 d…ôrs limiti standart kimi t…ôtbiq olunur
              (sinif c…ôdv…ôlind…ô ayrƒ±ca d…ôyi≈üm…ôk m√ºmk√ºnd√ºr).
            </div>
          </div>

          <!-- M√º…ôlliml…ôr -->
          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="flex items-center justify-between gap-3 mb-2">
              <div class="section-title">M√º…ôlliml…ôr</div>
              <button type="button" id="btnAddTeacher"
                      class="no-print inline-flex items-center gap-1 rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs hover:bg-white/80 dark:hover:bg-white/10 transition">
                ‚ûï ∆èlav…ô et
              </button>
            </div>

            <div class="text-xs text-slate-500 dark:text-slate-400 mb-3">
              H…ôr m√º…ôllim √º√ß√ºn h…ôft…ôlik v…ô g√ºnd…ôlik maksimum saat, g…ôlm…ô g√ºnl…ôri v…ô 1-ci / sonuncu saatdan qa√ßmaq ist…ôyi.
            </div>

            <div class="overflow-x-auto">
              <table class="config-table" id="teacherTable">
                <thead>
                  <tr>
                    <th>Ad, soyad</th>
                    <th>Kod</th>
                    <th>H…ôft…ôlik max</th>
                    <th>G√ºnd…ô max</th>
                    <th>1-ci saatƒ± sevmir</th>
                    <th>Sonuncu saatƒ± sevmir</th>
                    <th>G…ôlm…ô g√ºnl…ôri</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="teacherTbody"></tbody>
              </table>
            </div>
          </div>

          <!-- Sinifl…ôr -->
          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="flex items-center justify-between gap-3 mb-2">
              <div class="section-title">Sinifl…ôr</div>
              <button type="button" id="btnAddClass"
                      class="no-print inline-flex items-center gap-1 rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs hover:bg-white/80 dark:hover:bg-white/10 transition">
                ‚ûï ∆èlav…ô et
              </button>
            </div>

            <div class="text-xs text-slate-500 dark:text-slate-400 mb-3">
              S…ôviyy…ô: 1‚Äì4 ibtidai, 5‚Äì8 …ôsas, 9‚Äì11 yuxarƒ±. N√∂vb…ô sad…ôc…ô informasiya √º√ß√ºnd√ºr.
            </div>

            <div class="overflow-x-auto">
              <table class="config-table" id="classTable">
                <thead>
                  <tr>
                    <th>Sinif</th>
                    <th>S…ôviyy…ô</th>
                    <th>N√∂vb…ô</th>
                    <th>G√ºnd…ô max d…ôrs</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="classTbody"></tbody>
              </table>
            </div>
          </div>

          <!-- D…ôrsl…ôr -->
          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="flex items-center justify-between gap-3 mb-2">
              <div class="section-title">F…ônn / d…ôrs saatlarƒ±</div>
              <button type="button" id="btnAddLesson"
                      class="no-print inline-flex items-center gap-1 rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-xs hover:bg-white/80 dark:hover:bg-white/10 transition">
                ‚ûï ∆èlav…ô et
              </button>
            </div>

            <div class="text-xs text-slate-500 dark:text-slate-400 mb-3">
              H…ôr s…ôtir: sinif + f…ônn + m√º…ôllim + h…ôft…ôlik saat. Qo≈üa d…ôrs se√ßs…ôn, imkan daxilind…ô ardƒ±cƒ±l yerl…ô≈üdir…ôc…ôk.
            </div>

            <div class="overflow-x-auto max-h-80">
              <table class="config-table" id="lessonTable">
                <thead>
                  <tr>
                    <th>Sinif</th>
                    <th>F…ônn</th>
                    <th>M√º…ôllim kodu/adƒ±</th>
                    <th>H…ôft…ôlik saat</th>
                    <th>Aƒüƒ±r?</th>
                    <th>Qo≈üa?</th>
                    <th class="no-print"></th>
                  </tr>
                </thead>
                <tbody id="lessonTbody"></tbody>
              </table>
            </div>
          </div>

        </div>

        <!-- RIGHT: result -->
        <div class="flex flex-col gap-4">
          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="flex items-center justify-between gap-3 mb-2">
              <div class="section-title">N…ôtic…ô</div>
              <div id="resultStats" class="text-xs text-slate-500 dark:text-slate-400"></div>
            </div>

            <div id="classTabs" class="flex flex-wrap gap-1 mb-3 text-xs no-print"></div>

            <div id="timetableContainer" class="overflow-x-auto text-sm">
              <div class="text-sm text-slate-500 dark:text-slate-400">
                H…ôl…ô c…ôdv…ôl qurulmayƒ±b. M…ôlumatlarƒ± daxil etdikd…ôn sonra <strong>‚ÄúC…ôdv…ôli qur‚Äù</strong> d√ºym…ôsini sƒ±xƒ±n.
              </div>
            </div>

            <div id="unplacedContainer" class="mt-3 hidden whitespace-pre-line text-sm text-amber-700 dark:text-amber-200"></div>
            <div id="softWarnings" class="mt-2 text-xs text-slate-500 dark:text-slate-400"></div>
          </div>

          <div class="card-surface rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
            <div class="section-title mb-2">Qƒ±sa izah</div>
            <div class="text-sm leading-7 text-slate-700 dark:text-slate-200">
              Bu hazƒ±rlayƒ±cƒ± tipik m…ôhdudiyy…ôtl…ôri n…ôz…ôr…ô alƒ±r: m√º…ôlliml…ôrin eyni saatda iki sinif…ô d√º≈üm…ôm…ôsi,
              sinifl…ôrin g√ºnd…ô saat limitl…ôri, aƒüƒ±r f…ônl…ôrin 1-ci v…ô sonuncu saatdan m√ºmk√ºn q…ôd…ôr uzaq saxlanmasƒ±,
              eyni g√ºnd…ô eyni f…ônnin h…ôddind…ôn artƒ±q yƒ±ƒüƒ±lmamasƒ±, m√º…ôllimin yalnƒ±z se√ßilmi≈ü g√ºnl…ôrd…ô g…ôl…ô bilm…ôsi v…ô s.
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- Footer (ana s…ôhif…ô il…ô eyni) -->
  <footer class="mt-10 border-t border-slate-200/70 dark:border-slate-800/70">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row gap-4 items-center justify-between text-sm text-slate-600 dark:text-slate-300">
      <div>
        ¬© <span id="year"></span> <span class="font-semibold text-slate-900 dark:text-slate-100">EduPlan AZ</span> ¬∑ B√ºt√ºn h√ºquqlar qorunur
      </div>

      <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
        <a class="hover:underline underline-offset-4" href="/about.html">Haqqƒ±mƒ±zda</a>
        <a class="hover:underline underline-offset-4" href="/contact.html">∆èlaq…ô</a>
        <a class="hover:underline underline-offset-4" href="/terms.html">≈û…ôrtl…ôr</a>
        <a class="hover:underline underline-offset-4" href="/privacy.html">M…ôxfilik</a>
      </nav>
    </div>
  </footer>

  <!-- JS: year + theme toggle (ana s…ôhif…ô il…ô eyni) -->
  <script>
    (function () {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const btn = document.getElementById('theme-toggle');
      const meta = document.getElementById('theme-color');
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      const hasUserPref = () => {
        try { return !!localStorage.getItem('theme'); } catch (e) { return false; }
      };

      const getTheme = () => (document.documentElement.classList.contains('dark') ? 'dark' : 'light');

      function applyTheme(theme, persist) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        document.documentElement.dataset.theme = theme;

        if (btn) btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (meta) meta.setAttribute('content', isDark ? '#0b1220' : '#ffffff');

        if (persist) {
          try { localStorage.setItem('theme', theme); } catch (e) {}
        }
      }

      applyTheme(getTheme(), false);

      btn && btn.addEventListener('click', function () {
        const next = (getTheme() === 'dark') ? 'light' : 'dark';
        applyTheme(next, true);
      });

      const onSystemChange = function (e) {
        if (!hasUserPref()) applyTheme(e.matches ? 'dark' : 'light', false);
      };

      if (mq) {
        if (mq.addEventListener) mq.addEventListener('change', onSystemChange);
        else if (mq.addListener) mq.addListener(onSystemChange);
      }
    })();
  </script>

  <!-- Timetable logic -->
  <script>
    const teacherTbody = document.getElementById('teacherTbody');
    const classTbody = document.getElementById('classTbody');
    const lessonTbody = document.getElementById('lessonTbody');

    const btnAddTeacher = document.getElementById('btnAddTeacher');
    const btnAddClass = document.getElementById('btnAddClass');
    const btnAddLesson = document.getElementById('btnAddLesson');

    const btnGenerate = document.getElementById('btnGenerate');
    const btnResetAll = document.getElementById('btnResetAll');
    const btnPrint = document.getElementById('btnPrint');

    const globalError = document.getElementById('globalError');
    const globalInfo  = document.getElementById('globalInfo');

    const resultStats = document.getElementById('resultStats');
    const timetableContainer = document.getElementById('timetableContainer');
    const unplacedContainer = document.getElementById('unplacedContainer');
    const softWarnings = document.getElementById('softWarnings');
    const classTabs = document.getElementById('classTabs');

    const DAYS_LABELS_5 = ['B.e','√á.a','√á','C','C.u'];
    const DAYS_LABELS_6 = ['B.e','√á.a','√á','C','C.u','≈û'];
    const DAY_LABELS_FULL = ['B.e','√á.a','√á','C','C.u','≈û']; // m√º…ôlliml…ôr √º√ß√ºn UI

    function addTeacherRow(initial={}) {
      const tr = document.createElement('tr');
      const available = Array.isArray(initial.availableDays) && initial.availableDays.length
        ? initial.availableDays
        : [0,1,2,3,4,5]; // default: B.e‚Äì≈û hamƒ±sƒ±

      const daysHtml = DAY_LABELS_FULL.map((lbl, idx) => {
        const checked = available.includes(idx) ? 'checked' : '';
        return `<label style="display:inline-flex;align-items:center;gap:6px;white-space:nowrap;">
                  <input type="checkbox" class="t-day" data-d="${idx}" ${checked}>
                  <span>${lbl}</span>
                </label>`;
      }).join(' ');

      tr.innerHTML = `
        <td><input type="text" class="t-name" placeholder="M√º…ôllim adƒ±" value="${initial.name||''}"></td>
        <td><input type="text" class="t-code" placeholder="Kod (m…ôs: AZR)" value="${initial.code||''}"></td>
        <td><input type="number" class="t-week" min="0" max="60" value="${initial.weeklyMax ?? 30}"></td>
        <td><input type="number" class="t-day"  min="0" max="10" value="${initial.dailyMax ?? 6}"></td>
        <td class="text-center"><input type="checkbox" class="t-avoid-first" ${initial.avoidFirst?'checked':''}></td>
        <td class="text-center"><input type="checkbox" class="t-avoid-last" ${initial.avoidLast?'checked':''}></td>
        <td>
          <div class="t-days" style="display:flex;flex-wrap:wrap;gap:10px;font-size:11px;">
            ${daysHtml}
          </div>
        </td>
        <td class="no-print text-right">
          <button type="button" class="text-xs text-rose-600 hover:underline t-del">Sil</button>
        </td>
      `;
      teacherTbody.appendChild(tr);
    }

    function addClassRow(initial={}) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="c-name" placeholder="m…ôs: 5A" value="${initial.name||''}"></td>
        <td>
          <select class="c-level">
            <option value="ibtidai" ${initial.level==='ibtidai'?'selected':''}>ƒ∞btidai (1-4)</option>
            <option value="esas" ${initial.level==='esas'?'selected':''}>∆èsas (5-8)</option>
            <option value="yuxari" ${initial.level==='yuxari'?'selected':''}>Yuxarƒ± (9-11)</option>
          </select>
        </td>
        <td>
          <select class="c-shift">
            <option value="seher"  ${initial.shift==='seher'?'selected':''}>S…ôh…ôr</option>
            <option value="gunorta" ${initial.shift==='gunorta'?'selected':''}>G√ºnorta</option>
          </select>
        </td>
        <td><input type="number" class="c-maxday" min="0" max="8" placeholder="Bo≈ü: standart" value="${initial.maxPerDay ?? ''}"></td>
        <td class="no-print text-right">
          <button type="button" class="text-xs text-rose-600 hover:underline c-del">Sil</button>
        </td>
      `;
      classTbody.appendChild(tr);
    }

    function addLessonRow(initial={}) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="l-class" placeholder="m…ôs: 5A" value="${initial.className||''}"></td>
        <td><input type="text" class="l-subj"  placeholder="m…ôs: Riyaziyyat" value="${initial.subject||''}"></td>
        <td><input type="text" class="l-teacher" placeholder="Kod v…ô ya ad" value="${initial.teacher||''}"></td>
        <td><input type="number" class="l-hours" min="1" max="40" value="${initial.hours ?? 2}"></td>
        <td class="text-center"><input type="checkbox" class="l-heavy" ${initial.heavy?'checked':''}></td>
        <td class="text-center"><input type="checkbox" class="l-double" ${initial.double?'checked':''}></td>
        <td class="no-print text-right">
          <button type="button" class="text-xs text-rose-600 hover:underline l-del">Sil</button>
        </td>
      `;
      lessonTbody.appendChild(tr);
    }

    btnAddTeacher.addEventListener('click', () => addTeacherRow({}));
    btnAddClass.addEventListener('click', () => addClassRow({}));
    btnAddLesson.addEventListener('click', () => addLessonRow({}));

    teacherTbody.addEventListener('click', e => {
      if (e.target.classList.contains('t-del')) e.target.closest('tr')?.remove();
    });
    classTbody.addEventListener('click', e => {
      if (e.target.classList.contains('c-del')) e.target.closest('tr')?.remove();
    });
    lessonTbody.addEventListener('click', e => {
      if (e.target.classList.contains('l-del')) e.target.closest('tr')?.remove();
    });

    btnResetAll.addEventListener('click', () => {
      teacherTbody.innerHTML = '';
      classTbody.innerHTML = '';
      lessonTbody.innerHTML = '';

      timetableContainer.innerHTML =
        '<div class="text-sm text-slate-500 dark:text-slate-400">H…ôl…ô c…ôdv…ôl qurulmayƒ±b.</div>';

      classTabs.innerHTML = '';
      unplacedContainer.classList.add('hidden');
      unplacedContainer.textContent = '';
      softWarnings.textContent = '';
      resultStats.textContent = '';

      globalError.classList.add('hidden');
      globalError.textContent = '';
      globalInfo.textContent = '';
    });

    btnPrint.addEventListener('click', () => window.print());

    function readConfig() {
      globalError.classList.add('hidden');
      globalError.textContent = '';

      const daysCount = parseInt(document.getElementById('daysCount').value,10) || 5;
      const lessonsPerDay = parseInt(document.getElementById('lessonsPerDay').value,10) || 7;
      const optHeavyAvoidEdges = document.getElementById('optHeavyAvoidEdges').checked;
      const optLimitSameSubject = document.getElementById('optLimitSameSubject').checked;

      const teachers = [];
      teacherTbody.querySelectorAll('tr').forEach(tr => {
        const name = tr.querySelector('.t-name')?.value.trim();
        const code = tr.querySelector('.t-code')?.value.trim();
        if (!name && !code) return;

        const dayCbs = tr.querySelectorAll('.t-day[data-d]');
        let availableDays = [];
        dayCbs.forEach(cb => {
          if (cb.checked) {
            const idx = parseInt(cb.dataset.d, 10);
            if (!Number.isNaN(idx)) availableDays.push(idx);
          }
        });
        if (!availableDays.length) {
          availableDays = Array.from({length: daysCount}, (_,i)=>i);
        }

        teachers.push({
          id: teachers.length,
          name: name || code,
          code: code || name,
          weeklyMax: Number(tr.querySelector('.t-week')?.value) || 0,
          dailyMax: Number(tr.querySelector('.t-day')?.value) || 0,
          avoidFirst: tr.querySelector('.t-avoid-first')?.checked || false,
          avoidLast: tr.querySelector('.t-avoid-last')?.checked || false,
          availableDays
        });
      });

      const classes = [];
      classTbody.querySelectorAll('tr').forEach(tr => {
        const name = tr.querySelector('.c-name')?.value.trim();
        if (!name) return;
        const level = tr.querySelector('.c-level')?.value || 'esas';
        const shift = tr.querySelector('.c-shift')?.value || 'seher';
        const maxDay = Number(tr.querySelector('.c-maxday')?.value) || 0;
        classes.push({
          id: classes.length,
          name,
          level,
          shift,
          maxPerDay: maxDay
        });
      });

      const lessons = [];
      lessonTbody.querySelectorAll('tr').forEach(tr => {
        const className = tr.querySelector('.l-class')?.value.trim();
        const subject   = tr.querySelector('.l-subj')?.value.trim();
        const teacher   = tr.querySelector('.l-teacher')?.value.trim();
        const hours     = Number(tr.querySelector('.l-hours')?.value) || 0;
        if (!className || !subject || !teacher || hours <= 0) return;
        lessons.push({
          className,
          subject,
          teacherRef: teacher,
          hours,
          heavy: tr.querySelector('.l-heavy')?.checked || false,
          double: tr.querySelector('.l-double')?.checked || false
        });
      });

      if (!teachers.length || !classes.length || !lessons.length) {
        throw new Error('He√ß olmasa 1 m√º…ôllim, 1 sinif v…ô 1 d…ôrs …ôlav…ô etm…ôlis…ôn.');
      }
      if (lessonsPerDay > 8 || lessonsPerDay < 1) {
        throw new Error('G√ºnd…ô d…ôrs saatƒ± 1‚Äì8 aralƒ±ƒüƒ±nda olmalƒ±dƒ±r.');
      }

      return {
        daysCount,
        lessonsPerDay,
        optHeavyAvoidEdges,
        optLimitSameSubject,
        teachers,
        classes,
        lessons
      };
    }

    function shuffle(arr) {
      for (let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
    }

    function defaultMaxPerDayByLevel(level){
      if (level === 'ibtidai') return 6;
      if (level === 'esas') return 7;
      return 8;
    }

    function generateBlocks(config) {
      const {lessons, classes, teachers} = config;
      const classIndexByName = new Map();
      classes.forEach(c => classIndexByName.set(c.name.trim(), c.id));

      const teacherIndexByKey = new Map();
      teachers.forEach(t => {
        teacherIndexByKey.set((t.code||'').trim(), t.id);
        teacherIndexByKey.set((t.name||'').trim(), t.id);
      });

      const blocks = [];
      const unknown = [];

      lessons.forEach(l => {
        const cId = classIndexByName.get(l.className.trim());
        const tId = teacherIndexByKey.get(l.teacherRef.trim());
        if (cId == null || tId == null) { unknown.push(l); return; }

        let remaining = l.hours;
        const base = { classId: cId, teacherId: tId, subject: l.subject, heavy: !!l.heavy };

        if (l.double && remaining >= 2) {
          while (remaining >= 2) { blocks.push({...base, length:2}); remaining -= 2; }
        }
        while (remaining > 0) { blocks.push({...base, length:1}); remaining -= 1; }
      });

      blocks.sort((a,b)=>{
        if (b.length !== a.length) return b.length - a.length;
        if (b.heavy !== a.heavy) return (b.heavy?1:0) - (a.heavy?1:0);
        return 0;
      });

      return {blocks, unknownUnmapped: unknown};
    }

    function attemptBuild(config){
      const {daysCount, lessonsPerDay, teachers, classes, optHeavyAvoidEdges, optLimitSameSubject} = config;
      const {blocks} = generateBlocks(config);

      shuffle(blocks);

      const timetable = {};
      classes.forEach(c=>{
        const matrix = [];
        for(let d=0; d<daysCount; d++) matrix.push(new Array(lessonsPerDay).fill(null));
        timetable[c.id] = matrix;
      });

      const teacherWeekly = new Array(teachers.length).fill(0);
      const teacherDaily  = new Array(teachers.length).fill(null).map(()=>new Array(daysCount).fill(0));
      const classDaily    = new Array(classes.length).fill(null).map(()=>new Array(daysCount).fill(0));
      const classSubjPerDay = new Array(classes.length).fill(null).map(()=>Object.create(null));

      const unplaced = [];
      const lastSlotIndex = lessonsPerDay - 1;

      function canPlace(block, day, slot, strict){
        const {classId, teacherId, subject, length, heavy} = block;
        if (slot + length - 1 >= lessonsPerDay) return false;

        const matrix = timetable[classId];
        for(let i=0;i<length;i++) if (matrix[day][slot+i] != null) return false;

        const t = teachers[teacherId];
        if (!t) return false;

        if (Array.isArray(t.availableDays) && t.availableDays.length) {
          if (!t.availableDays.includes(day)) return false;
        }

        for(let i=0;i<length;i++){
          for(const c of classes){
            const m = timetable[c.id];
            if (m[day][slot+i] && m[day][slot+i].block.teacherId === teacherId) return false;
          }
        }

        const weeklyMax = t.weeklyMax>0 ? t.weeklyMax : Infinity;
        const dailyMax  = t.dailyMax>0  ? t.dailyMax  : Infinity;
        if (teacherWeekly[teacherId] + length > weeklyMax) return false;
        if (teacherDaily[teacherId][day] + length > dailyMax) return false;

        const cls = classes[classId];
        const maxDay = cls.maxPerDay>0 ? cls.maxPerDay : defaultMaxPerDayByLevel(cls.level);
        if (classDaily[classId][day] + length > maxDay) return false;

        if (strict){
          if (optHeavyAvoidEdges && heavy){
            if (slot === 0) return false;
            if (slot + length - 1 === lastSlotIndex) return false;
          }
          if (t.avoidFirst && slot === 0) return false;
          if (t.avoidLast && (slot + length - 1 === lastSlotIndex)) return false;

          if (optLimitSameSubject){
            const subjMap = classSubjPerDay[classId];
            subjMap[subject] = subjMap[subject] || new Array(daysCount).fill(0);
            if (subjMap[subject][day] + length > 2) return false;
          }
        }
        return true;
      }

      function place(block, day, slot){
        const {classId, teacherId, subject, length} = block;
        const matrix = timetable[classId];
        for(let i=0;i<length;i++) matrix[day][slot+i] = {block, part:i};

        teacherWeekly[teacherId] += length;
        teacherDaily[teacherId][day] += length;
        classDaily[classId][day] += length;

        const subjMap = classSubjPerDay[classId];
        subjMap[subject] = subjMap[subject] || new Array(daysCount).fill(0);
        subjMap[subject][day] += length;
      }

      function tryPlaceBlock(block){
        const candidates = [];
        for(let d=0; d<daysCount; d++) for(let s=0; s<lessonsPerDay; s++) candidates.push({d,s});
        shuffle(candidates);

        for(const {d,s} of candidates){
          if (canPlace(block,d,s,true)) { place(block,d,s); return true; }
        }
        for(const {d,s} of candidates){
          if (canPlace(block,d,s,false)) { place(block,d,s); return true; }
        }
        return false;
      }

      let placedCount = 0;
      blocks.forEach(b=>{
        const ok = tryPlaceBlock(b);
        if (!ok) unplaced.push(b);
        else placedCount += b.length;
      });

      return {timetable, unplaced, placedCount};
    }

    function buildBestTimetable(config){
      const ATTEMPTS = 25;
      let best = null;

      for(let i=0;i<ATTEMPTS;i++){
        const res = attemptBuild(config);
        if (!best || res.placedCount > best.placedCount ||
            (res.placedCount === best.placedCount && res.unplaced.length < best.unplaced.length)) {
          best = res;
        }
      }
      return best;
    }

    function renderTimetable(config, result){
      const {classes, teachers, daysCount, lessonsPerDay} = config;
      const {timetable, unplaced, placedCount} = result;

      const daysLabels = (daysCount===5 ? DAYS_LABELS_5 : DAYS_LABELS_6).slice(0,daysCount);

      classTabs.innerHTML = '';
      classes.forEach((c, idx)=>{
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'tab-btn' + (idx===0 ? ' active':'');

        btn.textContent = c.name;
        btn.dataset.classId = c.id;
        classTabs.appendChild(btn);
      });

      function teacherLabel(tId){
        const t = teachers[tId];
        if (!t) return '';
        if (t.code && t.name) return `${t.code}`;
        return t.code || t.name || '';
      }

      function renderForClass(classId){
        const matrix = timetable[classId];
        if (!matrix){
          timetableContainer.innerHTML = '<div class="text-sm text-slate-500 dark:text-slate-400">Bu sinif √º√ß√ºn c…ôdv…ôl tapƒ±lmadƒ±.</div>';
          return;
        }

        let html = '<table class="tt-table"><thead><tr><th>Saat</th>';
        daysLabels.forEach(d=>{ html += `<th>${d}</th>`; });
        html += '</tr></thead><tbody>';

        for(let s=0; s<lessonsPerDay; s++){
          html += `<tr><th>${s+1}</th>`;
          for(let d=0; d<daysCount; d++){
            const cell = matrix[d][s];
            if (!cell){
              html += `<td><span class="tt-slot-muted">‚Äî</span></td>`;
            } else if (cell.part === 0){
              const b = cell.block;
              const subj = b.subject;
              const tLab = teacherLabel(b.teacherId);
              const len = b.length;
              const rowspan = len>1 ? len : 1;
              html += `<td rowspan="${rowspan}">
                        <div class="font-semibold">${subj}</div>
                        <div class="text-[11px] mt-0.5 text-slate-600 dark:text-slate-300">${tLab}</div>
                      </td>`;
            } else {
              // qo≈üa d…ôrsin 2-ci hiss…ôsi rowspan-a g√∂r…ô bo≈ü qalƒ±r
            }
          }
          html += '</tr>';
        }
        html += '</tbody></table>';
        timetableContainer.innerHTML = html;
      }

      const totalRequiredHours = config.lessons.reduce((sum,l)=>sum+(Number(l.hours)||0),0);
      const placedPercent = totalRequiredHours>0 ? ((placedCount/totalRequiredHours)*100).toFixed(1) : '0.0';

      resultStats.textContent = `Yerl…ô≈üdiril…ôn saat: ${placedCount}/${totalRequiredHours} (${placedPercent}%) ¬∑ C…ôhd: 25`;

      if (unplaced.length){
        const lines = unplaced.map(b=>{
          const cls = classes[b.classId]?.name || '?';
          const t = teachers[b.teacherId];
          const tLabel = t ? (t.code || t.name) : '?';
          return `‚Ä¢ ${cls} ‚Äì ${b.subject} (${tLabel}), ${b.length} saat`;
        });
        unplacedContainer.classList.remove('hidden');
        unplacedContainer.textContent = 'Yerl…ô≈üdirilm…ôy…ônl…ôr:\n' + lines.join('\n');
      } else {
        unplacedContainer.classList.add('hidden');
        unplacedContainer.textContent = '';
      }

      softWarnings.textContent =
        'Qeyd: M√º…ôllim ist…ôkl…ôri (1-ci / sonuncu saatdan qa√ßmaq), aƒüƒ±r f…ônnin paylanmasƒ± v…ô m√º…ôllimin g…ôlm…ô g√ºnl…ôri …ôvv…ôlc…ô s…ôrt n…ôz…ôr…ô alƒ±nƒ±r; ' +
        'yer tapƒ±lmadƒ±qda b…ôzi ist…ôkl…ôr yum≈üaldƒ±lƒ±r (g…ôlm…ô g√ºnl…ôri saxlanƒ±lƒ±r).';

      const firstClassId = classes[0]?.id;
      if (firstClassId != null) renderForClass(firstClassId);

      classTabs.addEventListener('click', e=>{
        if (!e.target.classList.contains('tab-btn')) return;
        classTabs.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        e.target.classList.add('active');
        const cid = Number(e.target.dataset.classId);
        renderForClass(cid);
      }, {once:true});
    }

    btnGenerate.addEventListener('click', () => {
      try{
        const config = readConfig();

        globalError.classList.add('hidden');
        globalError.textContent = '';

        globalInfo.textContent = 'C…ôdv…ôl qurulur‚Ä¶ (bir ne√ß…ô f…ôrqli kombinasiyanƒ± sƒ±nayƒ±r)';
        setTimeout(()=>{
          const result = buildBestTimetable(config);
          renderTimetable(config, result);
          globalInfo.textContent = 'C…ôdv…ôl quruldu. ƒ∞st…ôs…ôn ‚Äú√áap / PDF‚Äù il…ô saxlayƒ±b printer √º√ß√ºn istifad…ô ed…ô bil…ôrs…ôn.';
        }, 10);
      }catch(err){
        globalError.textContent = err.message || String(err);
        globalError.classList.remove('hidden');
      }
    });

    // Ba≈ülanƒüƒ±c n√ºmun…ôl…ôri
    addTeacherRow({name:'Riyaziyyat m√º…ôllimi', code:'Rƒ∞Y', weeklyMax:24, dailyMax:6, avoidFirst:false, avoidLast:true, availableDays:[0,1,2,3,4]});
    addTeacherRow({name:'Az…ôrbaycan dili m√º…ôllimi', code:'AZD', weeklyMax:24, dailyMax:6, avoidFirst:false, avoidLast:false, availableDays:[0,1,2,3,4]});

    addClassRow({name:'5A', level:'esas', shift:'seher'});
    addClassRow({name:'6A', level:'esas', shift:'seher'});

    addLessonRow({className:'5A', subject:'Riyaziyyat', teacher:'Rƒ∞Y', hours:4, heavy:true, double:true});
    addLessonRow({className:'5A', subject:'Az…ôrbaycan dili', teacher:'AZD', hours:3, heavy:false, double:false});
  </script>
</body>
</html>
