<!doctype html>
<html lang="az" class="scroll-smooth">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-M3CQTM2P');</script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="canonical" href="https://www.eduplan.az/calculator.html" />
  <meta name="keywords" content="ksq bsq hesablama, YarÄ±millik vÉ™ Ä°llik hesablama, YarÄ±millik vÉ™ Ä°llik hesablama Online, Ksq bsq hesablama kalkulyatoru, ksq ve bsq ballarinin hesablanmasi" />
  <meta name="description" content="KSQ 40% / BSQ 60% Ã§É™kili bal kalkulyatoru â€” EduPlan.az" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="EduPlan.az" />
  <meta name="language" content="az" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="google-site-verification" content="arARShX5-FqxTThszjmchhNpO0WHdzJlhWi0E3-zuzQ" />

  <title>Bal kalkulyatoru â€” EduPlan</title>

  <meta name="theme-color" content="#f8fafc" id="theme-color" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Bal kalkulyatoru â€” EduPlan" />
  <meta property="og:description" content="I/II yarÄ±mil vÉ™ illik hesablamalar." />
  <meta property="og:image" content="https://www.eduplan.az/assets/og-image.jpg" />
  <meta property="og:url" content="https://www.eduplan.az/calculator.html" />

  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="logo.svg">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="favicon-48x48.png" sizes="48x48">
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="android-chrome-512x512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0ea5e9">
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Tema: FOUC olmamasÄ± Ã¼Ã§Ã¼n -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = (saved === 'dark' || saved === 'light') ? saved : (systemDark ? 'dark' : 'light');

        const root = document.documentElement;
        root.classList.toggle('dark', theme === 'dark');
        root.dataset.theme = theme;

        const meta = document.getElementById('theme-color');
        if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b1220' : '#f8fafc');
      } catch (e) {}
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <style>
    html, body { overflow-x: hidden; }
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }
    html { scroll-padding-top: 80px; }

    .card-surface { transition: box-shadow 200ms ease, transform 200ms ease; box-shadow: 0 1px 2px rgba(15, 23, 42, 0.06); }
    .card-surface:hover { box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12), 0 4px 12px rgba(15, 23, 42, 0.08); }
    html.dark .card-surface { box-shadow: 0 1px 2px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.03); }
    html.dark .card-surface:hover { box-shadow: 0 12px 30px rgba(0,0,0,.55), 0 4px 12px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.06); }

    input[type="number"]{
      width:100%;
      border-radius: 0.75rem;
      border: 1px solid rgba(226,232,240,.75);
      background: rgba(255,255,255,.82);
      padding: .65rem .9rem;
      font-size: 14px;
      outline: none;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
    }
    html.dark input[type="number"]{
      border-color: rgba(30,41,59,.7);
      background: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }
    input[type="number"]::placeholder{ color: rgb(148,163,184); }
    input[type="number"]:focus{
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.25);
    }

    .ep-btn-primary{ background: linear-gradient(90deg,#1e3a8a 0%,#4f46e5 50%,#9333ea 100%); }
    html.dark .ep-btn-primary{ background: linear-gradient(90deg,#312e81 0%,#4338ca 50%,#7e22ce 100%); }

    :root{
      --ep-frame-max: 80rem;
      --ep-shell-max: 1700px;
      --ep-rail-w: clamp(260px, 16vw, 300px);
      --ep-rail-min-h: 600px;
      --ep-rail-gap: 24px;
      --ep-center-max: 1220px;

      --ep-bg-from: #f8fafc;
      --ep-bg-mid:  #eef2ff;
      --ep-bg-to:   #ecfeff;

      --ep-surface: linear-gradient(180deg, rgba(255,255,255,.86), rgba(238,242,255,.60));
      --ep-surface-2: linear-gradient(180deg, rgba(255,255,255,.84), rgba(241,245,249,.64));

      --ep-border: rgba(79,70,229,.12);
      --ep-panel-border: rgba(79,70,229,.28);

      --ep-t1-bg: rgba(238,242,255,.78);
      --ep-t1-border: rgba(79,70,229,.30);

      --ep-year-bg: rgba(255,247,237,.80);
      --ep-year-border: rgba(245,158,11,.28);

      --ep-mode-idle-bg: linear-gradient(180deg, rgba(255,255,255,.88), rgba(238,242,255,.70));
      --ep-mode-idle-border: rgba(79,70,229,.16);
      --ep-mode-hover-bg: linear-gradient(180deg, rgba(255,255,255,.92), rgba(224,231,255,.78));

      --ep-mode-active-bg: linear-gradient(90deg, rgba(30,58,138,.10), rgba(79,70,229,.12), rgba(147,51,234,.10));
      --ep-mode-active-border: rgba(79,70,229,.55);
      --ep-mode-active-shadow: 0 10px 24px rgba(79,70,229,.16), 0 2px 8px rgba(15,23,42,.06);

      --ep-focus: rgba(79,70,229,.28);
    }

    html.dark{
      --ep-bg-from: #020617;
      --ep-bg-mid:  #0b1220;
      --ep-bg-to:   #0f172a;

      --ep-surface: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      --ep-surface-2: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));

      --ep-border: rgba(148,163,184,.18);
      --ep-panel-border: rgba(99,102,241,.18);

      --ep-t1-bg: rgba(49,46,129,.18);
      --ep-t1-border: rgba(99,102,241,.22);

      --ep-year-bg: rgba(120,53,15,.18);
      --ep-year-border: rgba(245,158,11,.20);

      --ep-mode-idle-bg: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      --ep-mode-idle-border: rgba(148,163,184,.16);
      --ep-mode-hover-bg: linear-gradient(180deg, rgba(15,23,42,.78), rgba(15,23,42,.62));

      --ep-mode-active-bg: linear-gradient(90deg, rgba(49,46,129,.45), rgba(67,56,202,.40), rgba(126,34,206,.35));
      --ep-mode-active-border: rgba(99,102,241,.55);
      --ep-mode-active-shadow: 0 12px 30px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06);

      --ep-focus: rgba(99,102,241,.34);
    }

    body{
      background-image: linear-gradient(to bottom, var(--ep-bg-from), var(--ep-bg-mid) 45%, var(--ep-bg-to)) !important;
    }

    #calc-panel{
      background: var(--ep-surface) !important;
      border-color: var(--ep-panel-border) !important;
      box-shadow: 0 18px 60px rgba(15,23,42,.08);
    }
    html.dark #calc-panel{ box-shadow: 0 18px 70px rgba(0,0,0,.55); }

    #calc-panel > div:first-child{
      background: linear-gradient(90deg, rgba(79,70,229,.10), rgba(16,185,129,.08), rgba(245,158,11,.08));
    }
    html.dark #calc-panel > div:first-child{
      background: linear-gradient(90deg, rgba(99,102,241,.12), rgba(16,185,129,.09), rgba(245,158,11,.09));
    }

    #empty-state .rounded-2xl{
      background: var(--ep-surface-2) !important;
      border-color: var(--ep-border) !important;
      box-shadow: 0 10px 28px rgba(15,23,42,.06);
    }
    html.dark #empty-state .rounded-2xl{ box-shadow: 0 12px 30px rgba(0,0,0,.45); }

    .mode-btn{
      background: var(--ep-mode-idle-bg) !important;
      border-color: var(--ep-mode-idle-border) !important;
      position: relative;
      overflow: hidden;
      transition: transform 160ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;
      box-shadow: 0 8px 20px rgba(15,23,42,.06);
    }
    html.dark .mode-btn{ box-shadow: 0 10px 26px rgba(0,0,0,.35); }

    .mode-btn:hover{
      background: var(--ep-mode-hover-bg) !important;
      transform: translateY(-1px);
    }
    .mode-btn:active{ transform: translateY(0px); }

    .mode-btn:focus-visible{
      outline: none;
      box-shadow: 0 0 0 4px var(--ep-focus), 0 12px 28px rgba(15,23,42,.06);
    }
    html.dark .mode-btn:focus-visible{
      box-shadow: 0 0 0 4px var(--ep-focus), 0 14px 34px rgba(0,0,0,.45);
    }

    .mode-btn[aria-pressed="true"]{
      background-image: var(--ep-mode-active-bg) !important;
      border-color: var(--ep-mode-active-border) !important;
      box-shadow: var(--ep-mode-active-shadow) !important;
    }
    .mode-btn[aria-pressed="true"]::after{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(79,70,229,.18), transparent 55%),
        radial-gradient(120% 120% at 80% 0%, rgba(147,51,234,.16), transparent 55%);
      pointer-events:none;
      opacity: .95;
    }
    html.dark .mode-btn[aria-pressed="true"]::after{ opacity: .30; }

    #btn-reset{
      background: var(--ep-mode-idle-bg) !important;
      border-color: var(--ep-mode-idle-border) !important;
      box-shadow: 0 8px 20px rgba(15,23,42,.06);
    }
    #btn-reset:hover{
      background: var(--ep-mode-hover-bg) !important;
    }
    #btn-reset:focus-visible{
      outline: none !important;
      box-shadow: 0 0 0 4px var(--ep-focus), 0 12px 28px rgba(15,23,42,.06) !important;
    }
    html.dark #btn-reset{ box-shadow: 0 10px 26px rgba(0,0,0,.35); }
    html.dark #btn-reset:focus-visible{
      box-shadow: 0 0 0 4px var(--ep-focus), 0 14px 34px rgba(0,0,0,.45) !important;
    }

    #calc-output{
      background: var(--ep-surface-2) !important;
      border-color: var(--ep-border) !important;
      box-shadow: 0 12px 34px rgba(15,23,42,.06);
    }
    html.dark #calc-output{ box-shadow: 0 14px 40px rgba(0,0,0,.40); }

    #fs-term{
      background: var(--ep-t1-bg) !important;
      border-color: var(--ep-t1-border) !important;
    }
    #fs-year{
      background: var(--ep-year-bg) !important;
      border-color: var(--ep-year-border) !important;
    }

    #fs-term .ep-term-dot,
    #fs-year .ep-term-dot{
      background: linear-gradient(90deg,#4f46e5,#9333ea);
      box-shadow: 0 0 0 4px rgba(99,102,241,.14);
    }
    html.dark #fs-term .ep-term-dot,
    html.dark #fs-year .ep-term-dot{
      box-shadow: 0 0 0 4px rgba(99,102,241,.18);
    }

    #fs-term .ep-term-pill::before,
    #fs-year .ep-term-pill::before{
      background: linear-gradient(90deg, rgba(79,70,229,.60), rgba(147,51,234,.55));
    }

    #fs-term .ep-term-head::after,
    #fs-year .ep-term-head::after{
      background: linear-gradient(90deg, rgba(79,70,229,.24), rgba(79,70,229,0));
    }
    html.dark #fs-term .ep-term-head::after,
    html.dark #fs-year .ep-term-head::after{
      background: linear-gradient(90deg, rgba(99,102,241,.34), rgba(99,102,241,0));
    }

    #out-term-card, #out-year-card{
      position: relative;
      overflow: hidden;
    }
    #out-term-card{
      background: var(--ep-t1-bg) !important;
      border-color: var(--ep-t1-border) !important;
    }
    #out-year-card{
      background: var(--ep-year-bg) !important;
      border-color: var(--ep-year-border) !important;
    }

    #out-term-card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(120% 120% at 0% 0%, rgba(79,70,229,.14), transparent 55%),
        radial-gradient(120% 120% at 100% 0%, rgba(147,51,234,.10), transparent 55%);
      pointer-events:none;
    }
    #out-year-card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(120% 120% at 0% 0%, rgba(245,158,11,.14), transparent 55%),
        radial-gradient(120% 120% at 100% 0%, rgba(244,63,94,.08), transparent 55%);
      pointer-events:none;
    }

    #out-term{ color: rgb(67,56,202); }
    #out-year{ color: rgb(217,119,6); }

    html.dark #out-term{ color: rgb(199,210,254); }
    html.dark #out-year{ color: rgb(253,230,138); }

    .ep-frame{
      width: 100%;
      max-width: var(--ep-frame-max);
      margin: 0 auto;
      padding-left: 16px;
      padding-right: 16px;
      transition: max-width .22s ease, padding .22s ease;
    }
    @media (min-width: 640px){
      .ep-frame{ padding-left: 24px; padding-right: 24px; }
    }
    @media (min-width: 1024px){
      .ep-frame{ padding-left: 32px; padding-right: 32px; }
    }

    .ep-frame.has-ads{ max-width: var(--ep-shell-max); }

    .ep-shell{
      display: grid;
      grid-template-columns: 1fr;
      gap: 0;
      align-items: start;
      width: 100%;
    }

    .ep-center{ min-width: 0; }

    .ep-ad-left{ grid-column: 1; }
    .ep-ad-right{ grid-column: 3; }

    .ep-ad-slot{
      display: none;
      width: 100%;
      min-height: var(--ep-rail-min-h);
      align-items: flex-start;
      justify-content: center;
      overflow: hidden;

      position: sticky;
      top: 88px;
      height: fit-content;
    }
    .ep-ad-slot > div{ width:100%; max-width:100%; }

    .ep-shell.has-left-ad,
    .ep-shell.has-right-ad{ gap: var(--ep-rail-gap); }

    .ep-shell.has-left-ad .ep-ad-left{ display:flex; }
    .ep-shell.has-right-ad .ep-ad-right{ display:flex; }

    .ep-shell.has-left-ad.has-right-ad{
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }
    .ep-shell.has-left-ad:not(.has-right-ad){
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) 1fr;
    }
    .ep-shell.has-right-ad:not(.has-left-ad){
      grid-template-columns: 1fr minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }

    @media (max-width: 1024px){
      .ep-frame.has-ads{ max-width: var(--ep-frame-max); }
      .ep-shell{
        grid-template-columns: 1fr !important;
        gap: 0 !important;
      }
      .ep-ad-slot{ display:none !important; }
    }

    @media print{
      .no-print{ display:none !important; }
    }

    .ep-term-head{
      display:flex;
      align-items:center;
      gap: 12px;
      margin-bottom: 12px;
    }
    .ep-term-head::after{
      content:"";
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, rgba(99,102,241,.22), rgba(99,102,241,0));
    }
    html.dark .ep-term-head::after{
      background: linear-gradient(90deg, rgba(99,102,241,.34), rgba(99,102,241,0));
    }

    .ep-term-pill{
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 9999px;
      border: 1px solid rgba(226,232,240,.85);
      background: rgba(255,255,255,.72);
      box-shadow: 0 1px 2px rgba(15,23,42,.06);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      line-height: 1;
    }
    html.dark .ep-term-pill{
      border-color: rgba(148,163,184,.18);
      background: rgba(2,6,23,.28);
      box-shadow: 0 1px 2px rgba(0,0,0,.35);
    }

    .ep-term-pill::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(90deg, rgba(79,70,229,.55), rgba(147,51,234,.55));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity: .28;
    }
    html.dark .ep-term-pill::before{ opacity: .42; }

    .ep-term-dot{
      width: 9px;
      height: 9px;
      border-radius: 9999px;
      background: linear-gradient(90deg,#4f46e5,#9333ea);
      box-shadow: 0 0 0 4px rgba(99,102,241,.12);
      flex: 0 0 auto;
    }
    html.dark .ep-term-dot{
      box-shadow: 0 0 0 4px rgba(99,102,241,.18);
    }

    .ep-term-title{
      font-size: 13px;
      font-weight: 700;
      letter-spacing: .01em;
      color: rgb(15, 23, 42);
      white-space: nowrap;
    }
    html.dark .ep-term-title{
      color: rgb(226,232,240);
    }
  </style>
</head>

<body class="min-h-screen pt-16 text-slate-900 dark:text-slate-100 bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M3CQTM2P"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <a href="#main"
     class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[100] focus:rounded-xl focus:bg-white focus:px-4 focus:py-2 focus:text-slate-900 focus:shadow">
    KontentÉ™ keÃ§
  </a>

  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/60 to-emerald-200/60 dark:from-indigo-500/15 dark:to-emerald-500/10"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/60 to-pink-200/60 dark:from-amber-500/10 dark:to-pink-500/10"></div>
  </div>

  <header class="fixed top-0 inset-x-0 z-50 border-b border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/60 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <img src="assets/ep-favicon-light.svg" alt="EduPlan" class="h-9 w-9 dark:hidden" width="36" height="36" />
          <img src="assets/ep-favicon-dark.svg" alt="" aria-hidden="true" class="h-9 w-9 hidden dark:block" width="36" height="36" />
          <span class="font-semibold tracking-tight">EduPlan AZ</span>
        </a>

        <button
          id="theme-toggle"
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-slate-900/40 p-2 hover:bg-slate-200 dark:hover:bg-slate-900/60 transition focus:outline-none focus:ring-2 focus:ring-indigo-400"
          aria-label="Tema dÉ™yiÅŸdir"
          aria-pressed="false"
        >
          <svg class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.5-1.5M20.5 20.5 19 19M19 5l1.5-1.5M3.5 20.5 5 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg class="h-5 w-5 hidden dark:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 13.2A7.5 7.5 0 0 1 10.8 3 6.9 6.9 0 1 0 21 13.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="main" class="pt-4 pb-0">
    <div class="ep-frame" id="ep-frame">
      <div class="ep-shell" id="ep-shell">

        <aside class="ep-ad-slot ep-ad-left no-print" data-ad-slot="left" aria-label="Reklam (sol)"></aside>

        <div class="ep-center">
          <div class="py-0">

            <section class="py-6 sm:py-8">
              <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight">Bal kalkulyatoru</h1>
              <p class="mt-2 text-slate-600 dark:text-slate-300">
                I/II yarÄ±mil vÉ™ illik nÉ™ticÉ™lÉ™ri sÃ¼rÉ™tli vÉ™ dÉ™qiq hesablamaq Ã¼Ã§Ã¼n sadÉ™ kalkulyator.
              </p>
            </section>

            <section id="calc-panel" class="rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur shadow-sm overflow-hidden relative">
              <div class="px-6 py-4 border-b border-slate-200/70 dark:border-slate-800/70 flex items-center justify-between gap-4">
                <div class="font-semibold">ğŸ§® Bal kalkulyatoru</div>
              </div>

              <div class="p-6">
                <div id="empty-state" class="relative mb-6">
                  <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-5 text-center">
                    <div class="text-lg font-semibold">Rejimi seÃ§in</div>
                    <div class="mt-1 text-sm text-slate-600 dark:text-slate-300">
                      â€œI/II yarÄ±milâ€ vÉ™ ya â€œÄ°llikâ€ seÃ§dikdÉ™n sonra xanalar aktiv olacaq.
                    </div>
                  </div>
                </div>

                <div class="grid gap-2" id="mode-area">
                  <div class="text-sm text-slate-600 dark:text-slate-300">Hesablama rejimi</div>
                  <div class="grid grid-cols-2 gap-2">
                    <button
                      type="button"
                      class="mode-btn w-full rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-sm font-medium hover:bg-slate-200 dark:hover:bg-slate-900/60 transition"
                      data-mode="term"
                      aria-pressed="false"
                    >
                      I/II yarÄ±mil
                    </button>
                    <button
                      type="button"
                      class="mode-btn w-full rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-sm font-medium hover:bg-slate-200 dark:hover:bg-slate-900/60 transition"
                      data-mode="year"
                      aria-pressed="false"
                    >
                      Ä°llik
                    </button>
                  </div>
                </div>

                <div class="mt-6 grid gap-6">
                  <fieldset id="fs-term" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                    <legend class="sr-only">YarÄ±mil</legend>

                    <div class="ep-term-head" aria-hidden="true">
                      <div class="ep-term-pill">
                        <span class="ep-term-dot"></span>
                        <span class="ep-term-title">YarÄ±mil</span>
                      </div>
                    </div>

                    <div class="mt-2 grid grid-cols-2 gap-2">
                      <input id="term-ksq1" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 1" />
                      <input id="term-ksq2" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 2" />
                      <input id="term-ksq3" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 3" />
                      <input id="term-ksq4" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 4" />
                      <input id="term-ksq5" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 5" />
                      <input id="term-ksq6" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 6" />
                      <input id="term-ksq7" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 7" />
                      <input id="term-ksq8" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="KSQ 8" />
                    </div>
                    <div class="mt-3">
                      <input id="term-bsq" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="BSQ" />
                    </div>
                  </fieldset>

                  <fieldset id="fs-year" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                    <legend class="sr-only">Ä°llik</legend>

                    <div class="ep-term-head" aria-hidden="true">
                      <div class="ep-term-pill">
                        <span class="ep-term-dot"></span>
                        <span class="ep-term-title">Ä°llik</span>
                      </div>
                    </div>

                    <div class="mt-2 grid grid-cols-2 gap-2">
                      <input id="year-t1" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="I yarÄ±mil balÄ±" />
                      <input id="year-t2" type="number" min="0" max="100" step="0.01" inputmode="decimal" placeholder="II yarÄ±mil balÄ±" />
                    </div>

                    <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">
                      Hesab: (I + II) / 2
                    </div>
                  </fieldset>

                  <div id="calc-actions" class="flex flex-col sm:flex-row gap-3">
                    <button id="btn-calc" class="ep-btn-primary w-full rounded-2xl px-4 py-3 font-semibold text-white shadow-sm hover:brightness-110 transition">
                      Hesabla
                    </button>

                    <button
                      id="btn-reset"
                      type="button"
                      class="w-full rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 font-semibold hover:bg-slate-200 dark:hover:bg-slate-900/60 transition"
                    >
                      SÄ±fÄ±rla
                    </button>
                  </div>

                  <div
                    id="calc-error"
                    class="hidden rounded-2xl border border-rose-200/70 dark:border-rose-900/40 bg-rose-50/70 dark:bg-rose-950/25 px-4 py-3 text-sm text-rose-700 dark:text-rose-300"
                    role="alert"
                    aria-live="polite"
                    tabindex="-1"
                  ></div>

                  <div id="calc-output" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-5">
                    <div class="text-sm text-slate-500 dark:text-slate-300">NÉ™ticÉ™</div>

                    <div class="mt-4 grid gap-3">
                      <div id="out-term-card" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                        <div class="text-slate-500 dark:text-slate-400 text-sm">YarÄ±mil</div>
                        <div class="mt-1 text-2xl font-bold" id="out-term">â€”</div>
                        <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">
                          KSQ ort.: <span id="out-term-ksq">â€”</span>, BSQ: <span id="out-term-bsq">â€”</span>
                        </div>
                        <div class="text-xs text-slate-600 dark:text-slate-300">
                          QiymÉ™t: <span class="font-semibold" id="out-term-grade">â€”</span>
                        </div>
                      </div>

                      <div id="out-year-card" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                        <div class="text-slate-500 dark:text-slate-400 text-sm">Ä°llik</div>
                        <div class="mt-1 text-2xl font-bold" id="out-year">â€”</div>
                        <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">Hesab: (I + II) / 2</div>
                        <div class="text-xs text-slate-600 dark:text-slate-300">
                          QiymÉ™t: <span class="font-semibold" id="out-year-grade">â€”</span>
                        </div>
                      </div>
                    </div>

                    <div id="calc-warn" class="hidden mt-3 text-xs text-amber-600 dark:text-amber-400">
                      * BoÅŸ buraxÄ±lan KSQ-lar hesablanmaya qatÄ±lmadÄ±.
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <section class="mt-10 rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur p-6 sm:p-10 shadow-sm">
              <h2 class="text-2xl sm:text-3xl font-semibold">MÉ™lumat</h2>
              <div class="mt-5 space-y-4 text-base leading-7 text-slate-700 dark:text-slate-200">
                <p>
                  Bal kalkulyatoru KSQ vÉ™ BSQ nÉ™ticÉ™lÉ™rinÉ™ É™saslanaraq yarÄ±mil qiymÉ™tini avtomatik hesablayÄ±r.
                  Alqoritm <strong>KSQ 40% + BSQ 60%</strong> Ã§É™kisinÉ™ É™saslanÄ±r vÉ™ bÃ¼tÃ¼n hesablamalar brauzerdÉ™ aparÄ±lÄ±r.
                </p>
                <p>
                  Ä°stifadÉ™Ã§i <em>I/II yarÄ±mil</em> vÉ™ ya <em>Ä°llik</em> rejimlÉ™rindÉ™n birini seÃ§ir.
                  <em>I/II yarÄ±mil</em> rejimindÉ™ bir yarÄ±milin (I vÉ™ ya II) KSQ/BSQ nÉ™ticÉ™lÉ™rini daxil edib yarÄ±mil balÄ±nÄ± hesablayÄ±r.
                  <em>Ä°llik</em> rejimindÉ™ isÉ™ iki yarÄ±milin balÄ± daxil edilir vÉ™ illik bal <strong>(I + II) / 2</strong> kimi hesablanÄ±r.
                </p>
                <p>
                  BoÅŸ buraxÄ±lan KSQ-lar ortalamaya daxil edilmir.
                  <strong>BSQ daxil edilmÉ™zsÉ™</strong>, nÉ™ticÉ™ <strong>KSQ-larÄ±n É™dÉ™di ortasÄ±</strong> kimi hesablanÄ±r.
                  <strong>BSQ daxil edilÉ™rsÉ™</strong>, <strong>É™n azÄ± 1 KSQ</strong> daxil edilmÉ™lidir vÉ™ BSQ <strong>0â€“100</strong> aralÄ±ÄŸÄ±nda olmalÄ±dÄ±r.
                  OndalÄ±q dÉ™yÉ™rlÉ™r (mÉ™s.: 87.5) dÉ™stÉ™klÉ™nir.
                </p>

                <div class="pt-1">
                  <p class="font-medium">NÉ™ticÉ™lÉ™r 2â€“5 qiymÉ™t ÅŸkalasÄ±nda tÉ™qdim olunur:</p>
                  <div class="mt-3 overflow-hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5">
                    <table class="w-full text-sm">
                      <thead class="bg-slate-50/80 dark:bg-slate-900/40 text-slate-600 dark:text-slate-300">
                        <tr>
                          <th scope="col" class="px-4 py-3 text-left font-semibold">Bal aralÄ±ÄŸÄ±</th>
                          <th scope="col" class="px-4 py-3 text-right font-semibold">QiymÉ™t</th>
                        </tr>
                      </thead>
                      <tbody class="divide-y divide-slate-200/70 dark:divide-slate-800/70">
                        <tr><td class="px-4 py-3">0 â‰¤ bal â‰¤ 30</td><td class="px-4 py-3 text-right font-semibold">2</td></tr>
                        <tr><td class="px-4 py-3">30 &lt; bal â‰¤ 60</td><td class="px-4 py-3 text-right font-semibold">3</td></tr>
                        <tr><td class="px-4 py-3">60 &lt; bal â‰¤ 80</td><td class="px-4 py-3 text-right font-semibold">4</td></tr>
                        <tr><td class="px-4 py-3">80 &lt; bal â‰¤ 100</td><td class="px-4 py-3 text-right font-semibold">5</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <p>
                  Daxil etdiyiniz mÉ™lumatlar serverÉ™ gÃ¶ndÉ™rilmir vÉ™ saxlanÄ±lmÄ±r; hÉ™r ÅŸey yalnÄ±z sizin brauzerdÉ™ emal olunur.
                  SÉ™hifÉ™ yenilÉ™nÉ™rsÉ™ dÉ™yÉ™rlÉ™r sÄ±fÄ±rlanÄ±r.
                </p>

                <p>
                  TÉ™klif vÉ™ rÉ™y Ã¼Ã§Ã¼n:
                  <a class="underline underline-offset-4 hover:opacity-80" href="mailto:eduplan.az@gmail.com">eduplan.az@gmail.com</a>
                </p>
              </div>
            </section>

          </div>
        </div>

        <aside class="ep-ad-slot ep-ad-right no-print" data-ad-slot="right" aria-label="Reklam (saÄŸ)"></aside>

      </div>
    </div>
  </main>

  <footer class="mt-10 border-t border-slate-200/70 dark:border-slate-800/70">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row gap-4 items-center justify-between text-sm text-slate-600 dark:text-slate-300">
      <div>
        Â© <span id="year"></span> <span class="font-semibold text-slate-900 dark:text-slate-100">EduPlan AZ</span> Â· BÃ¼tÃ¼n hÃ¼quqlar qorunur
      </div>

      <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
        <a class="hover:underline underline-offset-4" href="/about.html">HaqqÄ±mÄ±zda</a>
        <a class="hover:underline underline-offset-4" href="/contact.html">ÆlaqÉ™</a>
        <a class="hover:underline underline-offset-4" href="/terms.html">ÅÉ™rtlÉ™r</a>
        <a class="hover:underline underline-offset-4" href="/privacy.html">MÉ™xfilik</a>
      </nav>
    </div>
  </footer>

  <!-- JS: year + theme toggle -->
  <script>
    (function () {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const btn = document.getElementById('theme-toggle');
      const meta = document.getElementById('theme-color');
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      const hasUserPref = () => {
        try { return !!localStorage.getItem('theme'); } catch (e) { return false; }
      };

      const getTheme = () => (document.documentElement.classList.contains('dark') ? 'dark' : 'light');

      function applyTheme(theme, persist) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        document.documentElement.dataset.theme = theme;

        if (btn) btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (meta) meta.setAttribute('content', isDark ? '#0b1220' : '#f8fafc');

        if (persist) {
          try { localStorage.setItem('theme', theme); } catch (e) {}
        }
      }

      applyTheme(getTheme(), false);

      btn && btn.addEventListener('click', function () {
        const next = (getTheme() === 'dark') ? 'light' : 'dark';
        applyTheme(next, true);
      });

      const onSystemChange = function (e) {
        if (!hasUserPref()) applyTheme(e.matches ? 'dark' : 'light', false);
      };

      if (mq) {
        if (mq.addEventListener) mq.addEventListener('change', onSystemChange);
        else if (mq.addListener) mq.addListener(onSystemChange);
      }
    })();
  </script>

  <!-- Ads: auto layout -->
  <script>
    (function () {
      const frame = document.getElementById('ep-frame');
      const shell = document.getElementById('ep-shell');
      if (!frame || !shell) return;

      const left = shell.querySelector('[data-ad-slot="left"]');
      const right = shell.querySelector('[data-ad-slot="right"]');

      const hasContent = (el) => {
        if (!el) return false;
        return Array.from(el.childNodes).some(n => {
          if (n.nodeType === Node.ELEMENT_NODE) return true;
          if (n.nodeType === Node.TEXT_NODE) return n.textContent.trim().length > 0;
          return false;
        });
      };

      const update = () => {
        const hasLeft = hasContent(left);
        const hasRight = hasContent(right);
        shell.classList.toggle('has-left-ad', hasLeft);
        shell.classList.toggle('has-right-ad', hasRight);
        frame.classList.toggle('has-ads', hasLeft || hasRight);
      };

      update();

      const obs = new MutationObserver(update);
      if (left) obs.observe(left, { childList: true, subtree: true });
      if (right) obs.observe(right, { childList: true, subtree: true });
    })();
  </script>

  <!-- Calculator logic (FINAL: Reset scroll = directly like 2nd screenshot) -->
  <script>
    (function initCalculator() {
      const W_KSQ = 0.40, W_BSQ = 0.60;
      const KSQ_COUNT = 8;

      const $id = (x) => document.getElementById(x);
      const $qsa = (s) => Array.from(document.querySelectorAll(s));

      let mode = null; // 'term' | 'year'

      const panel = $id('calc-panel');
      const modeArea = $id('mode-area');
      const emptyState = $id('empty-state');

      const fsTerm = $id('fs-term');
      const fsYear = $id('fs-year');

      const btnCalc = $id('btn-calc');
      const out = $id('calc-output');
      const err = $id('calc-error');
      const warn = $id('calc-warn');
      const resetBtn = $id('btn-reset');

      const modeButtons = $qsa('[data-mode]');

      const outTermCard = $id('out-term-card');
      const outYearCard = $id('out-year-card');

      const idsFor = (prefix) => Array.from({ length: KSQ_COUNT }, (_, i) => `${prefix}-ksq${i + 1}`);
      const TERM_KSQ_IDS = idsFor('term');

      const normalizeNumberString = (s) => s.replace(/\s/g, '').replace(',', '.');

      const numOrNull = (v) => {
        if (v == null) return null;
        const s0 = String(v).trim();
        if (s0 === '') return null;
        const s = normalizeNumberString(s0);
        const n = Number(s);
        return Number.isFinite(n) ? n : null;
      };

      const avg = arr => arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0;

      const to5 = (x) => {
        if (x <= 30) return 2;
        if (x <= 60) return 3;
        if (x <= 80) return 4;
        return 5;
      };

      const prefersReduceMotion = () => {
        try { return window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches; }
        catch (e) { return false; }
      };

      function getViewportHeight() {
        return window.visualViewport ? window.visualViewport.height : window.innerHeight;
      }

      function getHeaderHeight() {
        return document.querySelector('header')?.offsetHeight || 0;
      }

      function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
      }

      function pageRect(el) {
        const r = el.getBoundingClientRect();
        const y = window.pageYOffset || document.documentElement.scrollTop || 0;
        return { top: r.top + y, bottom: r.bottom + y, height: r.height };
      }

      function getMaxScrollY() {
        const se = document.scrollingElement || document.documentElement;
        const vh = window.innerHeight || 0;
        return Math.max(0, se.scrollHeight - vh);
      }

      function scrollToY(targetY, behavior) {
        const y = clamp(targetY, 0, getMaxScrollY());
        window.scrollTo({ top: y, left: 0, behavior });
      }

      let _scrollJobId = 0;
      let _scrollTimers = new Set();
      let _scrollCleanups = new Set();

      function _stopScrollJobs() {
        _scrollTimers.forEach(t => clearTimeout(t));
        _scrollTimers.clear();

        _scrollCleanups.forEach(fn => { try { fn(); } catch (e) {} });
        _scrollCleanups.clear();
      }

      function _trackTimer(t) {
        _scrollTimers.add(t);
        return t;
      }

      function _newScrollJob() {
        _scrollJobId += 1;
        _stopScrollJobs();

        try {
          const y = window.pageYOffset || document.documentElement.scrollTop || 0;
          window.scrollTo({ top: y, left: 0, behavior: 'auto' });
        } catch (e) {}

        return _scrollJobId;
      }

      function safeBand(opts = {}) {
        const topGap = opts.topGap ?? 18;
        const bottomGap = opts.bottomGap ?? 16;

        const y = window.pageYOffset || document.documentElement.scrollTop || 0;
        const vh = getViewportHeight();

        const top = y + getHeaderHeight() + topGap;
        const bottom = y + vh - bottomGap;

        return { top, bottom, vh, y, topGap, bottomGap };
      }

      function isInSafeZone(el, opts = {}) {
        if (!el) return true;
        const band = safeBand(opts);
        const r = pageRect(el);

        if (r.height > (band.bottom - band.top)) {
          return r.top >= band.top && r.top <= band.bottom;
        }
        return r.top >= band.top && r.bottom <= band.bottom;
      }

      function ensureVisible(el, opts = {}) {
        if (!el) return;
        if (isInSafeZone(el, opts)) return;

        const behavior = prefersReduceMotion() ? 'auto' : (opts.behavior ?? 'smooth');
        const band = safeBand(opts);
        const r = pageRect(el);

        let targetY = band.y;

        if (r.top < band.top) {
          targetY = r.top - (getHeaderHeight() + (opts.topGap ?? 18));
        } else if (r.bottom > band.bottom) {
          targetY = r.bottom - band.vh + (opts.bottomGap ?? 16);
        }

        scrollToY(targetY, behavior);
      }

      function ensureVisibleStable(el, opts = {}) {
        if (!el) return;

        const job = _scrollJobId;
        const run = () => {
          if (job !== _scrollJobId) return;
          ensureVisible(el, opts);
        };

        requestAnimationFrame(() => requestAnimationFrame(run));
        _trackTimer(setTimeout(run, 120));
        _trackTimer(setTimeout(run, 260));

        const vv = window.visualViewport;
        if (vv) {
          let active = true;
          const onVV = () => { if (active && job === _scrollJobId) run(); };

          vv.addEventListener('resize', onVV);
          vv.addEventListener('scroll', onVV);

          const cleanup = () => {
            if (!active) return;
            active = false;
            vv.removeEventListener('resize', onVV);
            vv.removeEventListener('scroll', onVV);
          };

          _scrollCleanups.add(cleanup);
          _trackTimer(setTimeout(() => {
            _scrollCleanups.delete(cleanup);
            cleanup();
          }, 420));
        }
      }

      function isDesktop() {
        try { return window.matchMedia && window.matchMedia('(min-width: 1024px)').matches; }
        catch (e) { return false; }
      }

      function scrollToElementTop(el, opts = {}) {
        if (!el) return;
        const topGap = opts.topGap ?? 18;
        const behavior = prefersReduceMotion() ? 'auto' : (opts.behavior ?? 'smooth');
        const r = pageRect(el);
        const targetY = r.top - (getHeaderHeight() + topGap);
        scrollToY(targetY, behavior);
      }

      function scrollToElementTopStable(el, opts = {}) {
        if (!el) return;

        const job = _scrollJobId;
        const run = () => {
          if (job !== _scrollJobId) return;
          scrollToElementTop(el, opts);
        };

        requestAnimationFrame(() => requestAnimationFrame(run));
        _trackTimer(setTimeout(run, 120));
        _trackTimer(setTimeout(run, 260));
      }

      const INVALID_CLS = ['ring-2','ring-rose-400/50','border-rose-400/70'];
      function setInvalid(el, on) {
        if (!el) return;
        if (on) {
          el.setAttribute('aria-invalid', 'true');
          INVALID_CLS.forEach(c => el.classList.add(c));
        } else {
          el.removeAttribute('aria-invalid');
          INVALID_CLS.forEach(c => el.classList.remove(c));
        }
      }

      const ALL_INPUT_IDS = [
        ...TERM_KSQ_IDS, 'term-bsq',
        'year-t1', 'year-t2'
      ];

      function clearAllInvalid() {
        ALL_INPUT_IDS.map($id).filter(Boolean).forEach(el => setInvalid(el, false));
      }

      function attachInputHygiene(el) {
        if (!el) return;
        el.addEventListener('input', () => setInvalid(el, false));
        el.addEventListener('blur', () => {
          if (typeof el.value === 'string' && el.value.includes(',')) {
            el.value = el.value.replace(',', '.');
          }
        });
      }

      ALL_INPUT_IDS.forEach(id => attachInputHygiene($id(id)));

      function tryFocus(el) {
        if (!el) return;
        try { el.focus({ preventScroll: true }); }
        catch (e) { try { el.focus(); } catch (e2) {} }
      }

      function clearError() {
        err.classList.add('hidden');
        err.textContent = '';
      }

      function showError(message, focusEl = null) {
        _newScrollJob();

        warn.classList.add('hidden');
        out.classList.add('hidden');

        err.textContent = message;
        err.classList.remove('hidden');

        if (focusEl) {
          setInvalid(focusEl, true);

          ensureVisibleStable(err, { topGap: 18, bottomGap: 16 });
          ensureVisibleStable(focusEl, { topGap: 18, bottomGap: 16 });

          requestAnimationFrame(() => {
            tryFocus(focusEl);
            ensureVisibleStable(focusEl, { topGap: 18, bottomGap: 16 });
            ensureVisibleStable(err, { topGap: 18, bottomGap: 16 });
          });
        } else {
          tryFocus(err);
          ensureVisibleStable(err, { topGap: 18, bottomGap: 16 });
        }
      }

      function clearOutputs() {
        ['out-term','out-term-ksq','out-term-bsq','out-term-grade','out-year','out-year-grade'].forEach(id => {
          const el = $id(id);
          if (el) el.textContent = 'â€”';
        });

        outTermCard?.classList.add('hidden');
        outYearCard?.classList.add('hidden');
      }

      function setBtnActive(btn, act) {
        const addA = ['ring-2','ring-indigo-500/45','border-indigo-500','bg-white/80','dark:bg-slate-900/60'];
        const remA = ['border-slate-200/70','dark:border-slate-800/70','bg-white/60','dark:bg-white/5'];

        if (act) {
          remA.forEach(c => btn.classList.remove(c));
          addA.forEach(c => btn.classList.add(c));
        } else {
          addA.forEach(c => btn.classList.remove(c));
          remA.forEach(c => btn.classList.add(c));
        }
      }

      function updateModeUI() {
        modeButtons.forEach(b => {
          const act = (b.dataset.mode === mode);
          b.setAttribute('aria-pressed', act ? 'true' : 'false');
          setBtnActive(b, act);
        });

        if (!mode) {
          emptyState?.classList.remove('hidden');
          fsTerm?.classList.add('hidden');
          fsYear?.classList.add('hidden');
          out?.classList.add('hidden');
          warn?.classList.add('hidden');
          clearError();
          clearOutputs();
          return;
        }

        emptyState?.classList.add('hidden');
        fsTerm?.classList.toggle('hidden', mode !== 'term');
        fsYear?.classList.toggle('hidden', mode !== 'year');

        outTermCard?.classList.add('hidden');
        outYearCard?.classList.add('hidden');
      }

      function computeResetTargetY() {
        const headerH = getHeaderHeight();
        const vh = getViewportHeight();
        const topGap = 18;
        const bottomGap = 18;

        const actions = $id('calc-actions');

        const fs = (mode === 'term') ? fsTerm : (mode === 'year') ? fsYear : null;

        const anchor = fs || modeArea || panel;

        const modeH = (fs && modeArea) ? modeArea.getBoundingClientRect().height : 0;
        const extraAbove = fs ? (modeH + 12) : 0;

        const rA = pageRect(anchor);
        let y = rA.top - (headerH + topGap + extraAbove);

        if (actions) {
          const rB = pageRect(actions);
          const bottomLimit = y + vh - bottomGap;
          if (rB.bottom > bottomLimit) {
            y += (rB.bottom - bottomLimit);
          }
        }

        return clamp(y, 0, getMaxScrollY());
      }

      function scrollToResetSpot(behavior) {
        const b = prefersReduceMotion() ? 'auto' : (behavior || 'smooth');
        const y = computeResetTargetY();
        scrollToY(y, b);
      }

      function scrollToResetSpotStable() {
        scrollToResetSpot('smooth');

        _trackTimer(setTimeout(() => {
          scrollToResetSpot('auto');
        }, 260));

        _trackTimer(setTimeout(() => {
          scrollToResetSpot('auto');
        }, 520));
      }

      modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          _newScrollJob();

          mode = btn.dataset.mode;

          updateModeUI();
          clearAllInvalid();
          clearError();
          warn.classList.add('hidden');
          clearOutputs();
          out.classList.add('hidden');

          btn.blur();

          if (isDesktop()) {
            const target = (mode === 'term') ? fsTerm : fsYear;
            scrollToElementTopStable(target, { topGap: 18 });
          } else {
            ensureVisibleStable(panel || fsTerm || fsYear, { topGap: 18, bottomGap: 18 });
          }

          requestAnimationFrame(() => {
            if (mode === 'term') tryFocus($id('term-ksq1'));
            else if (mode === 'year') tryFocus($id('year-t1'));
          });
        });
      });

      updateModeUI();

      function readHalfYearFromForm() {
        const ksq = [];

        for (let i = 1; i <= KSQ_COUNT; i++) {
          const el = $id(`term-ksq${i}`);
          const n = numOrNull(el?.value);

          if (n !== null) {
            if (n < 0 || n > 100) {
              return {
                error: true,
                code: 'KSQ_RANGE',
                fieldId: `term-ksq${i}`,
                message: `YarÄ±mil Ã¼Ã§Ã¼n KSQ ${i} dÉ™yÉ™rini 0â€“100 arasÄ±nda daxil edin.`
              };
            }
            ksq.push(n);
          }
        }

        const bsq = numOrNull($id('term-bsq')?.value);
        if (bsq !== null && (bsq < 0 || bsq > 100)) {
          return {
            error: true,
            code: 'BSQ_RANGE',
            fieldId: 'term-bsq',
            message: `YarÄ±mil Ã¼Ã§Ã¼n BSQ dÉ™yÉ™rini 0â€“100 arasÄ±nda daxil edin.`
          };
        }

        return { ksq, bsq };
      }

      function computeHalfYearFromForm() {
        const data = readHalfYearFromForm();
        if (data && data.error) return data;

        const { ksq, bsq } = data;

        if (ksq.length === 0 && bsq === null) {
          return {
            error: true,
            code: 'EMPTY',
            fieldId: 'term-ksq1',
            message: `YarÄ±mil Ã¼Ã§Ã¼n É™n azÄ± 1 KSQ (vÉ™ ya KSQ + BSQ) daxil edin.`
          };
        }

        if (bsq !== null && ksq.length === 0) {
          return {
            error: true,
            code: 'KSQ_REQUIRED',
            fieldId: 'term-ksq1',
            message: `YarÄ±mil Ã¼Ã§Ã¼n É™n azÄ± 1 KSQ dÉ™yÉ™ri daxil edin.`
          };
        }

        const missingKsqs = (ksq.length > 0 && ksq.length < KSQ_COUNT);
        const kAvg = ksq.length ? avg(ksq) : 0;

        if (bsq === null) {
          const total = +kAvg.toFixed(2);
          return { total, kAvg, bsqOut: null, missingKsqs };
        }

        const total = +(kAvg * W_KSQ + bsq * W_BSQ).toFixed(2);
        return { total, kAvg, bsqOut: bsq, missingKsqs };
      }

      function computeAnnualFromInputs() {
        const t1 = numOrNull($id('year-t1')?.value);
        const t2 = numOrNull($id('year-t2')?.value);

        if (t1 === null) {
          return { error: true, code: 'T1_REQUIRED', fieldId: 'year-t1', message: 'Ä°llik hesablamasÄ± Ã¼Ã§Ã¼n I yarÄ±mil balÄ±nÄ± daxil edin.' };
        }
        if (t1 < 0 || t1 > 100) {
          return { error: true, code: 'T1_RANGE', fieldId: 'year-t1', message: 'I yarÄ±mil balÄ±nÄ± 0â€“100 arasÄ±nda daxil edin.' };
        }

        if (t2 === null) {
          return { error: true, code: 'T2_REQUIRED', fieldId: 'year-t2', message: 'Ä°llik hesablamasÄ± Ã¼Ã§Ã¼n II yarÄ±mil balÄ±nÄ± daxil edin.' };
        }
        if (t2 < 0 || t2 > 100) {
          return { error: true, code: 'T2_RANGE', fieldId: 'year-t2', message: 'II yarÄ±mil balÄ±nÄ± 0â€“100 arasÄ±nda daxil edin.' };
        }

        const yearVal = +(((t1 + t2) / 2).toFixed(2));
        return { year: yearVal };
      }

      function renderHalfYearOutput(res) {
        outTermCard?.classList.remove('hidden');
        outYearCard?.classList.add('hidden');

        $id('out-term').textContent = res.total.toFixed(2);
        $id('out-term-ksq').textContent = res.kAvg.toFixed(2);
        $id('out-term-bsq').textContent = (res.bsqOut === null) ? 'â€”' : res.bsqOut.toFixed(2);
        $id('out-term-grade').textContent = to5(res.total);

        warn.classList.toggle('hidden', !res.missingKsqs);
      }

      function renderAnnualOutput(res) {
        outTermCard?.classList.add('hidden');
        outYearCard?.classList.remove('hidden');

        $id('out-year').textContent = res.year.toFixed(2);
        $id('out-year-grade').textContent = to5(res.year);

        warn.classList.add('hidden');
      }

      function resetCalc() {
        _newScrollJob();

        try { document.activeElement && document.activeElement.blur && document.activeElement.blur(); } catch (e) {}
        try { resetBtn && resetBtn.blur && resetBtn.blur(); } catch (e) {}

        TERM_KSQ_IDS.forEach(id => {
          const el = $id(id);
          if (el) el.value = '';
        });
        const bsqEl = $id('term-bsq');
        if (bsqEl) bsqEl.value = '';

        const y1 = $id('year-t1'); if (y1) y1.value = '';
        const y2 = $id('year-t2'); if (y2) y2.value = '';

        clearAllInvalid();
        clearError();
        warn.classList.add('hidden');
        clearOutputs();
        out.classList.add('hidden');

        requestAnimationFrame(() => requestAnimationFrame(() => {
          scrollToResetSpotStable();

          // âœ… YeganÉ™ dÉ™yiÅŸiklik: fokus (kursor) daha tez vÉ™ stabil olsun deyÉ™ nÃ¶vbÉ™ti frame-dÉ™ verilir
          const targetId = (mode === 'year') ? 'year-t1' : 'term-ksq1';
          const targetEl = $id(targetId);
          requestAnimationFrame(() => {
            if (targetEl) tryFocus(targetEl);
          });
        }));
      }

      resetBtn?.addEventListener('click', resetCalc);

      ALL_INPUT_IDS.forEach(id => {
        const el = $id(id);
        el?.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            e.target.blur();
            btnCalc.click();
          }
        });
      });

      btnCalc?.addEventListener('click', () => {
        _newScrollJob();

        clearAllInvalid();
        clearError();
        warn.classList.add('hidden');

        if (!mode) {
          showError('ZÉ™hmÉ™t olmasa hesablamadan Ã¶ncÉ™ rejimi seÃ§in (â€œI/II yarÄ±milâ€ vÉ™ ya â€œÄ°llikâ€).');
          ensureVisibleStable(modeArea, { topGap: 18, bottomGap: 18 });
          const firstModeBtn = document.querySelector('[data-mode="term"]');
          tryFocus(firstModeBtn);
          return;
        }

        if (mode === 'term') {
          const res = computeHalfYearFromForm();
          if (res && res.error) {
            const focusEl = $id(res.fieldId) || $id('term-ksq1');
            showError(res.message, focusEl);
            return;
          }

          renderHalfYearOutput(res);
          out.classList.remove('hidden');
          ensureVisibleStable(out, { topGap: 22, bottomGap: 18 });
          return;
        }

        if (mode === 'year') {
          const res = computeAnnualFromInputs();
          if (res && res.error) {
            const focusEl = $id(res.fieldId) || $id('year-t1');
            showError(res.message, focusEl);
            return;
          }

          renderAnnualOutput(res);
          out.classList.remove('hidden');
          ensureVisibleStable(out, { topGap: 22, bottomGap: 18 });
          return;
        }
      });

      (function init() {
        try {
          if ('scrollRestoration' in history) history.scrollRestoration = 'auto';
        } catch (e) {}
      })();
    })();
  </script>
</body>
</html>
