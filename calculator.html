<!doctype html>
<html lang="az" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="canonical" href="https://www.eduplan.az/calculator.html" />
  <meta name="keywords" content="KSQ BSQ Hesabla, KSQ BSQ Hesablayƒ±cƒ±, Yarƒ±mil hesablama, illik hesablama, Bal kalkulyatoru, Onlayn bal hesablama, Onlayn ksq bsq hesablama, Ksq bal hesablama proqramƒ±, Ksq bsq hesablama, Yarƒ±millik v…ô ƒ∞llik hesablama, yarƒ±millik v…ô illik hesablama online" />
  <meta name="description" content="KSQ 40% / BSQ 60% √ß…ôkili bal kalkulyatoru ‚Äî EduPlan.az" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="EduPlan.az" />
  <meta name="language" content="az" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="google-site-verification" content="arARShX5-FqxTThszjmchhNpO0WHdzJlhWi0E3-zuzQ" />

  <title>Bal kalkulyatoru ‚Äî EduPlan</title>

  <meta name="theme-color" content="#ffffff" id="theme-color" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Bal kalkulyatoru ‚Äî EduPlan" />
  <meta property="og:description" content="I/II yarƒ±mil v…ô illik hesablamalar." />
  <meta property="og:image" content="https://www.eduplan.az/assets/og-image.jpg" />
  <meta property="og:url" content="https://www.eduplan.az/calculator.html" />

  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="logo.svg">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="favicon-48x48.png" sizes="48x48">
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="android-chrome-512x512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#0ea5e9">
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Tema: FOUC olmamasƒ± √º√ß√ºn (Tailwind y√ºkl…ônm…ômi≈üd…ôn …ôvv…ôl) -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = (saved === 'dark' || saved === 'light') ? saved : (systemDark ? 'dark' : 'light');

        const root = document.documentElement;
        root.classList.toggle('dark', theme === 'dark');
        root.dataset.theme = theme;

        const meta = document.getElementById('theme-color');
        if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b1220' : '#ffffff');
      } catch (e) {}
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <style>
    html, body { overflow-x: hidden; }
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }
    html { scroll-padding-top: 80px; }

    input[type="number"]{
      width:100%;
      border-radius: 0.75rem;
      border: 1px solid rgba(226,232,240,.7);
      background: rgba(255,255,255,.6);
      padding: .65rem .9rem;
      font-size: 14px;
      outline: none;
    }
    html.dark input[type="number"]{
      border-color: rgba(30,41,59,.7);
      background: rgba(255,255,255,.05);
      color: rgb(226,232,240);
    }
    input[type="number"]::placeholder{ color: rgb(148,163,184); }
    input[type="number"]:focus{
      border-color: rgb(99,102,241);
      box-shadow: 0 0 0 3px rgba(99,102,241,.25);
    }

    .ep-btn-primary{ background: linear-gradient(90deg,#1e3a8a 0%,#4f46e5 50%,#9333ea 100%); }
    html.dark .ep-btn-primary{ background: linear-gradient(90deg,#312e81 0%,#4338ca 50%,#7e22ce 100%); }

    :root{
      --ep-frame-max: 80rem;
      --ep-shell-max: 1700px;
      --ep-rail-w: clamp(260px, 16vw, 300px);
      --ep-rail-min-h: 600px;
      --ep-rail-gap: 24px;
      --ep-center-max: 1220px;
    }

    .ep-frame{
      width: 100%;
      max-width: var(--ep-frame-max);
      margin: 0 auto;
      padding-left: 16px;
      padding-right: 16px;
      transition: max-width .22s ease, padding .22s ease;
    }
    @media (min-width: 640px){
      .ep-frame{ padding-left: 24px; padding-right: 24px; }
    }
    @media (min-width: 1024px){
      .ep-frame{ padding-left: 32px; padding-right: 32px; }
    }

    .ep-frame.has-ads{ max-width: var(--ep-shell-max); }

    .ep-shell{
      display: grid;
      grid-template-columns: 1fr;
      gap: 0;
      align-items: start;
      width: 100%;
    }

    .ep-center{ min-width: 0; }

    .ep-ad-left{ grid-column: 1; }
    .ep-ad-right{ grid-column: 3; }

    .ep-ad-slot{
      display: none;
      width: 100%;
      min-height: var(--ep-rail-min-h);
      align-items: flex-start;
      justify-content: center;
      overflow: hidden;

      position: sticky;
      top: 88px;
      height: fit-content;
    }
    .ep-ad-slot > div{ width:100%; max-width:100%; }

    .ep-shell.has-left-ad,
    .ep-shell.has-right-ad{
      gap: var(--ep-rail-gap);
    }

    .ep-shell.has-left-ad .ep-ad-left{ display:flex; }
    .ep-shell.has-right-ad .ep-ad-right{ display:flex; }

    .ep-shell.has-left-ad.has-right-ad{
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }
    .ep-shell.has-left-ad:not(.has-right-ad){
      grid-template-columns: minmax(0, var(--ep-rail-w)) minmax(0, var(--ep-center-max)) 1fr;
    }
    .ep-shell.has-right-ad:not(.has-left-ad){
      grid-template-columns: 1fr minmax(0, var(--ep-center-max)) minmax(0, var(--ep-rail-w));
    }

    @media (max-width: 1024px){
      .ep-frame.has-ads{ max-width: var(--ep-frame-max); }
      .ep-shell{
        grid-template-columns: 1fr !important;
        gap: 0 !important;
      }
      .ep-ad-slot{ display:none !important; }
    }

    @media print{
      .no-print{ display:none !important; }
    }
  </style>
</head>

<body class="min-h-screen pt-16 text-slate-900 dark:text-slate-100 bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">

  <a href="#main"
     class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[100] focus:rounded-xl focus:bg-white focus:px-4 focus:py-2 focus:text-slate-900 focus:shadow">
    Kontent…ô ke√ß
  </a>

  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/60 to-emerald-200/60 dark:from-indigo-500/15 dark:to-emerald-500/10"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/60 to-pink-200/60 dark:from-amber-500/10 dark:to-pink-500/10"></div>
  </div>

  <header class="fixed top-0 inset-x-0 z-50 border-b border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/60 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <img src="assets/ep-favicon-light.svg" alt="EduPlan" class="h-9 w-9 dark:hidden" width="36" height="36" />
          <img src="assets/ep-favicon-dark.svg" alt="" aria-hidden="true" class="h-9 w-9 hidden dark:block" width="36" height="36" />
          <span class="font-semibold tracking-tight">EduPlan AZ</span>
        </a>

        <button
          id="theme-toggle"
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-slate-900/40 p-2
                 hover:bg-slate-100 hover:border-slate-300/80 hover:shadow-sm hover:ring-2 hover:ring-slate-200/70
                 dark:hover:bg-slate-900/60 dark:hover:border-slate-700/70 dark:hover:ring-white/10
                 transition focus:outline-none focus:ring-2 focus:ring-indigo-400"
          aria-label="Tema d…ôyi≈üdir"
          aria-pressed="false"
        >
          <svg class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.5-1.5M20.5 20.5 19 19M19 5l1.5-1.5M3.5 20.5 5 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg class="h-5 w-5 hidden dark:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 13.2A7.5 7.5 0 0 1 10.8 3 6.9 6.9 0 1 0 21 13.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main id="main" class="pt-4 pb-0">
    <div class="ep-frame" id="ep-frame">
      <div class="ep-shell" id="ep-shell">

        <aside class="ep-ad-slot ep-ad-left no-print" data-ad-slot="left" aria-label="Reklam (sol)">
          <!-- SOL reklam kodu bura -->
        </aside>

        <div class="ep-center">
          <div class="py-0">

            <section class="py-6 sm:py-8">
              <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight">Bal kalkulyatoru</h1>
              <p class="mt-2 text-slate-600 dark:text-slate-300 max-w-[70ch]">
                I/II yarƒ±mil v…ô illik n…ôtic…ôl…ôri s√ºr…ôtli v…ô d…ôqiq hesablamaq √º√ß√ºn sad…ô kalkulyator.
              </p>
            </section>

            <section class="rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur shadow-sm overflow-hidden relative">
              <div class="px-6 py-4 border-b border-slate-200/70 dark:border-slate-800/70 flex items-center justify-between gap-4">
                <div class="font-semibold">üßÆ Bal kalkulyatoru</div>
              </div>

              <div class="p-6">

                <div id="empty-state" class="relative mb-6">
                  <div class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-5 text-center">
                    <div class="text-lg font-semibold">Rejimi se√ßin</div>
                    <div class="mt-1 text-sm text-slate-600 dark:text-slate-300">
                      I yarƒ±mil, II yarƒ±mil v…ô ya ‚ÄúH…ôr ikisi‚Äù se√ßdikd…ôn sonra xanalar aktiv olacaq.
                    </div>
                  </div>
                </div>

                <div class="grid gap-2">
                  <div class="text-sm text-slate-600 dark:text-slate-300">Hesablama rejimi</div>
                  <div class="grid grid-cols-3 gap-2">
                    <button
                      type="button"
                      class="mode-btn w-full rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-sm font-medium
                             hover:bg-slate-100 hover:border-slate-300/80 hover:shadow-sm hover:ring-2 hover:ring-slate-200/70
                             dark:hover:bg-slate-900/60 dark:hover:border-slate-700/70 dark:hover:ring-white/10
                             transition"
                      data-mode="t1"
                      aria-pressed="false"
                    >
                      I yarƒ±mil
                    </button>

                    <button
                      type="button"
                      class="mode-btn w-full rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-sm font-medium
                             hover:bg-slate-100 hover:border-slate-300/80 hover:shadow-sm hover:ring-2 hover:ring-slate-200/70
                             dark:hover:bg-slate-900/60 dark:hover:border-slate-700/70 dark:hover:ring-white/10
                             transition"
                      data-mode="t2"
                      aria-pressed="false"
                    >
                      II yarƒ±mil
                    </button>

                    <button
                      type="button"
                      class="mode-btn w-full rounded-xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-3 py-2 text-sm font-medium
                             hover:bg-slate-100 hover:border-slate-300/80 hover:shadow-sm hover:ring-2 hover:ring-slate-200/70
                             dark:hover:bg-slate-900/60 dark:hover:border-slate-700/70 dark:hover:ring-white/10
                             transition"
                      data-mode="both"
                      aria-pressed="false"
                    >
                      H…ôr ikisi
                    </button>
                  </div>
                </div>

                <div class="mt-6 grid gap-6">

                  <fieldset id="fs-t1" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                    <legend class="px-2 text-sm font-semibold">I yarƒ±mil</legend>
                    <div class="mt-2 grid grid-cols-2 gap-2">
                      <input id="t1-ksq1" type="number" min="0" max="100" placeholder="KSQ1" />
                      <input id="t1-ksq2" type="number" min="0" max="100" placeholder="KSQ2" />
                      <input id="t1-ksq3" type="number" min="0" max="100" placeholder="KSQ3" />
                      <input id="t1-ksq4" type="number" min="0" max="100" placeholder="KSQ4" />
                      <input id="t1-ksq5" type="number" min="0" max="100" placeholder="KSQ5" />
                      <input id="t1-ksq6" type="number" min="0" max="100" placeholder="KSQ6" />
                      <input id="t1-ksq7" type="number" min="0" max="100" placeholder="KSQ7" />
                      <input id="t1-ksq8" type="number" min="0" max="100" placeholder="KSQ8" />
                    </div>
                    <div class="mt-3">
                      <input id="t1-bsq" type="number" min="0" max="100" placeholder="BSQ" />
                    </div>
                  </fieldset>

                  <fieldset id="fs-t2" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                    <legend class="px-2 text-sm font-semibold">II yarƒ±mil</legend>
                    <div class="mt-2 grid grid-cols-2 gap-2">
                      <input id="t2-ksq1" type="number" min="0" max="100" placeholder="KSQ1" />
                      <input id="t2-ksq2" type="number" min="0" max="100" placeholder="KSQ2" />
                      <input id="t2-ksq3" type="number" min="0" max="100" placeholder="KSQ3" />
                      <input id="t2-ksq4" type="number" min="0" max="100" placeholder="KSQ4" />
                      <input id="t2-ksq5" type="number" min="0" max="100" placeholder="KSQ5" />
                      <input id="t2-ksq6" type="number" min="0" max="100" placeholder="KSQ6" />
                      <input id="t2-ksq7" type="number" min="0" max="100" placeholder="KSQ7" />
                      <input id="t2-ksq8" type="number" min="0" max="100" placeholder="KSQ8" />
                    </div>
                    <div class="mt-3">
                      <input id="t2-bsq" type="number" min="0" max="100" placeholder="BSQ" />
                    </div>
                  </fieldset>

                  <div id="calc-actions" class="flex flex-col sm:flex-row gap-3">
                    <button id="btn-calc" class="ep-btn-primary w-full rounded-2xl px-4 py-3 font-semibold text-white shadow-sm hover:brightness-110 transition">
                      Hesabla
                    </button>

                    <button
                      id="btn-reset"
                      type="button"
                      class="w-full rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 px-4 py-3 font-semibold
                             hover:bg-slate-100 hover:border-slate-300/80 hover:shadow-sm hover:ring-2 hover:ring-slate-200/70
                             dark:hover:bg-slate-900/60 dark:hover:border-slate-700/70 dark:hover:ring-white/10
                             transition"
                    >
                      Sƒ±fƒ±rla
                    </button>
                  </div>

                  <div id="calc-error" class="hidden text-sm text-rose-500"></div>

                  <div id="calc-output" class="hidden rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-5">
                    <div class="text-sm text-slate-500 dark:text-slate-300">N…ôtic…ôl…ôr</div>

                    <div class="mt-4 grid sm:grid-cols-3 gap-3">
                      <div id="out-t1-card" class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                        <div class="text-slate-500 dark:text-slate-400 text-sm">I yarƒ±mil</div>
                        <div class="mt-1 text-2xl font-bold" id="out-t1">‚Äî</div>
                        <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">
                          KSQ ort.: <span id="out-t1-ksq">‚Äî</span>, BSQ: <span id="out-t1-bsq">‚Äî</span>
                        </div>
                        <div class="text-xs text-slate-600 dark:text-slate-300">
                          Qiym…ôt: <span class="font-semibold" id="out-t1-grade">‚Äî</span>
                        </div>
                      </div>

                      <div id="out-t2-card" class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                        <div class="text-slate-500 dark:text-slate-400 text-sm">II yarƒ±mil</div>
                        <div class="mt-1 text-2xl font-bold" id="out-t2">‚Äî</div>
                        <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">
                          KSQ ort.: <span id="out-t2-ksq">‚Äî</span>, BSQ: <span id="out-t2-bsq">‚Äî</span>
                        </div>
                        <div class="text-xs text-slate-600 dark:text-slate-300">
                          Qiym…ôt: <span class="font-semibold" id="out-t2-grade">‚Äî</span>
                        </div>
                      </div>

                      <div id="out-year-card" class="rounded-2xl border border-slate-200/70 dark:border-slate-800/70 bg-white/60 dark:bg-white/5 p-4">
                        <div class="text-slate-500 dark:text-slate-400 text-sm">ƒ∞llik</div>
                        <div class="mt-1 text-2xl font-bold" id="out-year">‚Äî</div>
                        <div class="mt-2 text-xs text-slate-600 dark:text-slate-300">Hesab: (I + II) / 2</div>
                        <div class="text-xs text-slate-600 dark:text-slate-300">
                          Qiym…ôt: <span class="font-semibold" id="out-year-grade">‚Äî</span>
                        </div>
                      </div>
                    </div>

                    <div id="calc-warn" class="hidden mt-3 text-xs text-amber-600 dark:text-amber-400">
                      * Bo≈ü buraxƒ±lan KSQ-lar hesablanmaya qatƒ±lmadƒ±.
                    </div>
                  </div>

                </div>
              </div>
            </section>

            <section class="mt-10 rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-white/5 backdrop-blur p-6 sm:p-10 shadow-sm">
              <h2 class="text-2xl sm:text-3xl font-semibold">M…ôlumat</h2>

              <div class="mt-5 space-y-4 text-base leading-7 text-slate-700 dark:text-slate-200">
                <p>
                  Bal kalkulyatoru KSQ v…ô BSQ n…ôtic…ôl…ôrin…ô …ôsaslanaraq yarƒ±mil v…ô illik qiym…ôtl…ôri avtomatik hesablayƒ±r.
                  Alqoritm <strong>KSQ 40% + BSQ 60%</strong> √ß…ôkisin…ô …ôsaslanƒ±r v…ô b√ºt√ºn hesablamalar brauzerd…ô aparƒ±lƒ±r.
                </p>

                <p>
                  KSQ sah…ôl…ôri ist…ôy…ô baƒülƒ±dƒ±r; bo≈ü buraxƒ±lan KSQ-lar ortalamaya daxil edilmir. BSQ sah…ôsi m√ºtl…ôqdir v…ô
                  0‚Äì100 aralƒ±ƒüƒ±nda olmalƒ±dƒ±r. Ondalƒ±q d…ôy…ôrl…ôr (m…ôs.: 87.5) d…ôst…ôkl…ônir.
                </p>

                <p>
                  N…ôtic…ôl…ôr 2‚Äì5 qiym…ôt ≈ükalasƒ±nda t…ôqdim olunur: 81‚Äì100 ‚Üí 5, 61‚Äì80 ‚Üí 4, 41‚Äì60 ‚Üí 3, 0‚Äì40 ‚Üí 2.
                </p>

                <p>
                  T…ôklif v…ô r…ôy √º√ß√ºn:
                  <a class="underline underline-offset-4 hover:opacity-80" href="mailto:eduplan.az@gmail.com">eduplan.az@gmail.com</a>
                </p>
              </div>
            </section>

          </div>
        </div>

        <aside class="ep-ad-slot ep-ad-right no-print" data-ad-slot="right" aria-label="Reklam (saƒü)">
          <!-- SAƒû reklam kodu bura -->
        </aside>

      </div>
    </div>
  </main>

  <footer class="mt-10 border-t border-slate-200/70 dark:border-slate-800/70">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row gap-4 items-center justify-between text-sm text-slate-600 dark:text-slate-300">
      <div>
        ¬© <span id="year"></span> <span class="font-semibold text-slate-900 dark:text-slate-100">EduPlan AZ</span> ¬∑ B√ºt√ºn h√ºquqlar qorunur
      </div>

      <nav class="flex flex-wrap items-center justify-center gap-x-5 gap-y-2">
        <a class="hover:underline underline-offset-4" href="/about.html">Haqqƒ±mƒ±zda</a>
        <a class="hover:underline underline-offset-4" href="/contact.html">∆èlaq…ô</a>
        <a class="hover:underline underline-offset-4" href="/terms.html">≈û…ôrtl…ôr</a>
        <a class="hover:underline underline-offset-4" href="/privacy.html">M…ôxfilik</a>
      </nav>
    </div>
  </footer>

  <script>
    (function () {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const btn = document.getElementById('theme-toggle');
      const meta = document.getElementById('theme-color');
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      const hasUserPref = () => {
        try { return !!localStorage.getItem('theme'); } catch (e) { return false; }
      };

      const getTheme = () => (document.documentElement.classList.contains('dark') ? 'dark' : 'light');

      function applyTheme(theme, persist) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        document.documentElement.dataset.theme = theme;

        if (btn) btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (meta) meta.setAttribute('content', isDark ? '#0b1220' : '#ffffff');

        if (persist) {
          try { localStorage.setItem('theme', theme); } catch (e) {}
        }
      }

      applyTheme(getTheme(), false);

      btn && btn.addEventListener('click', function () {
        const next = (getTheme() === 'dark') ? 'light' : 'dark';
        applyTheme(next, true);
      });

      const onSystemChange = function (e) {
        if (!hasUserPref()) applyTheme(e.matches ? 'dark' : 'light', false);
      };

      if (mq) {
        if (mq.addEventListener) mq.addEventListener('change', onSystemChange);
        else if (mq.addListener) mq.addListener(onSystemChange);
      }
    })();
  </script>

  <script>
    (function () {
      const frame = document.getElementById('ep-frame');
      const shell = document.getElementById('ep-shell');
      if (!frame || !shell) return;

      const left = shell.querySelector('[data-ad-slot="left"]');
      const right = shell.querySelector('[data-ad-slot="right"]');

      const hasContent = (el) => {
        if (!el) return false;
        return Array.from(el.childNodes).some(n => {
          if (n.nodeType === Node.ELEMENT_NODE) return true;
          if (n.nodeType === Node.TEXT_NODE) return n.textContent.trim().length > 0;
          return false;
        });
      };

      const update = () => {
        const hasLeft = hasContent(left);
        const hasRight = hasContent(right);
        shell.classList.toggle('has-left-ad', hasLeft);
        shell.classList.toggle('has-right-ad', hasRight);

        const hasAds = hasLeft || hasRight;
        frame.classList.toggle('has-ads', hasAds);
      };

      update();

      const obs = new MutationObserver(update);
      if (left) obs.observe(left, { childList: true, subtree: true });
      if (right) obs.observe(right, { childList: true, subtree: true });
    })();
  </script>

  <script>
    (function initCalculator() {
      const W_KSQ = 0.40, W_BSQ = 0.60;
      const KSQ_COUNT = 8;

      const $id = (x) => document.getElementById(x);
      const $qsa = (s) => Array.from(document.querySelectorAll(s));

      let mode = null;

      const emptyState = $id('empty-state');
      const fsT1 = $id('fs-t1');
      const fsT2 = $id('fs-t2');

      const actions = $id('calc-actions');

      function scrollToWithHeader(el, extraOffset = 0) {
        if (!el) return;
        const headerH = document.querySelector('header')?.offsetHeight || 0;
        const y = el.getBoundingClientRect().top + window.scrollY - headerH - 10 - extraOffset;
        window.scrollTo({ top: y, behavior: 'smooth' });
      }

      function scrollToStable(el, extraOffset = 0) {
        if (!el) return;
        try { document.activeElement?.blur?.(); } catch (e) {}
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            scrollToWithHeader(el, extraOffset);
          });
        });
      }

      function setBtnActive(btn, act) {
        const addA = ['ring-2','ring-indigo-500/45','border-indigo-500','bg-white/80','dark:bg-slate-900/60'];
        const remA = ['border-slate-200/70','dark:border-slate-800/70','bg-white/60','dark:bg-white/5'];

        if (act) {
          remA.forEach(c => btn.classList.remove(c));
          addA.forEach(c => btn.classList.add(c));
        } else {
          addA.forEach(c => btn.classList.remove(c));
          remA.forEach(c => btn.classList.add(c));
        }
      }

      function updateModeUI() {
        $qsa('[data-mode]').forEach(b => {
          const act = (b.dataset.mode === mode);
          b.setAttribute('aria-pressed', act ? 'true' : 'false');
          setBtnActive(b, act);
        });

        if (!mode) {
          emptyState?.classList.remove('hidden');
          fsT1.classList.add('hidden');
          fsT2.classList.add('hidden');
          $id('calc-output')?.classList.add('hidden');
          $id('calc-error')?.classList.add('hidden');
          return;
        }

        emptyState?.classList.add('hidden');

        fsT1.classList.toggle('hidden', mode === 't2');
        fsT2.classList.toggle('hidden', mode === 't1');

        $id('out-t1-card')?.classList.toggle('hidden', mode === 't2');
        $id('out-t2-card')?.classList.toggle('hidden', mode === 't1');
        $id('out-year-card')?.classList.toggle('hidden', mode !== 'both');
      }

      $qsa('[data-mode]').forEach(btn => {
        btn.addEventListener('click', () => {
          mode = btn.dataset.mode;
          updateModeUI();
          btn.blur();
          scrollToWithHeader(document.querySelector('section.rounded-3xl') || fsT1 || fsT2);
        });
      });

      updateModeUI();

      const btnCalc = $id('btn-calc');
      const out = $id('calc-output');
      const err = $id('calc-error');
      const warn = $id('calc-warn');
      const resetBtn = $id('btn-reset');

      const idsFor = (prefix) => Array.from({ length: KSQ_COUNT }, (_, i) => `${prefix}-ksq${i + 1}`);
      const numOrNull = v => (v === '' || v == null) ? null : (isFinite(+v) ? +v : null);
      const avg = arr => arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0;
      const to5 = x => (x >= 81) ? 5 : (x >= 61) ? 4 : (x >= 41) ? 3 : 2;

      function clearOutputs() {
        [
          'out-t1','out-t1-ksq','out-t1-bsq','out-t1-grade',
          'out-t2','out-t2-ksq','out-t2-bsq','out-t2-grade',
          'out-year','out-year-grade'
        ].forEach(id => { $id(id).textContent = '‚Äî'; });
      }

      function readTerm(prefix) {
        const ksq = idsFor(prefix).map(id => numOrNull($id(id).value)).filter(v => v !== null);
        const bsq = numOrNull($id(`${prefix}-bsq`).value);
        return { ksq, bsq };
      }

      function computeTerm(prefix, outIds) {
        const { ksq, bsq } = readTerm(prefix);
        if (ksq.length === 0 && bsq === null) return null;

        if (bsq === null || bsq < 0 || bsq > 100) {
          err.textContent = (prefix === 't1' ? 'I' : 'II') + ' yarƒ±mil √º√ß√ºn BSQ d…ôy…ôrini 0‚Äì100 arasƒ±nda daxil edin.';
          err.classList.remove('hidden');
          return { error:true };
        }

        const kAvg = ksq.length ? avg(ksq) : 0;
        warn.classList.toggle('hidden', ksq.length === KSQ_COUNT || ksq.length === 0);

        const total = +(kAvg * W_KSQ + bsq * W_BSQ).toFixed(2);
        $id(outIds.total).textContent = total.toFixed(2);
        $id(outIds.ksq).textContent   = kAvg.toFixed(2);
        $id(outIds.bsq).textContent   = bsq.toFixed(2);
        $id(outIds.grade).textContent = to5(total);
        return total;
      }

      function resetCalc() {
        ['t1', 't2'].forEach(p => {
          Array.from({ length: KSQ_COUNT }, (_, i) => i + 1).forEach(n => {
            const el = $id(`${p}-ksq${n}`);
            if (el) el.value = '';
          });
          const bsq = $id(`${p}-bsq`);
          if (bsq) bsq.value = '';
        });

        err.classList.add('hidden'); err.textContent = '';
        warn.classList.add('hidden'); clearOutputs();
        out.classList.add('hidden');

        const anchor = document.querySelector('section.rounded-3xl') || (mode === 't2' ? fsT2 : fsT1);
        scrollToWithHeader(anchor);
      }

      resetBtn?.addEventListener('click', resetCalc);

      [...idsFor('t1'),'t1-bsq',...idsFor('t2'),'t2-bsq'].forEach(id => {
        const el = $id(id);
        el?.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            e.target.blur();
            btnCalc.click();
          }
        });
      });

      btnCalc?.addEventListener('click', () => {
        err.classList.add('hidden'); err.textContent = '';

        if (!mode) {
          err.textContent = 'Z…ôhm…ôt olmasa hesablamadan √∂nc…ô rejimi se√ßin (I, II v…ô ya H…ôr ikisi).';
          err.classList.remove('hidden');
          scrollToWithHeader(document.querySelector('[data-mode="t1"]'));
          return;
        }

        let t1 = null, t2 = null;

        if (mode !== 't2') {
          const r1 = computeTerm('t1', { total:'out-t1', ksq:'out-t1-ksq', bsq:'out-t1-bsq', grade:'out-t1-grade' });
          if (typeof r1 === 'number') t1 = r1;
        } else {
          ['out-t1','out-t1-ksq','out-t1-bsq','out-t1-grade'].forEach(id => { $id(id).textContent='‚Äî'; });
        }

        if (mode !== 't1') {
          const r2 = computeTerm('t2', { total:'out-t2', ksq:'out-t2-ksq', bsq:'out-t2-bsq', grade:'out-t2-grade' });
          if (typeof r2 === 'number') t2 = r2;
        } else {
          ['out-t2','out-t2-ksq','out-t2-bsq','out-t2-grade'].forEach(id => { $id(id).textContent='‚Äî'; });
        }

        out.classList.remove('hidden');
        scrollToStable(actions || out, 8);

        if (mode === 'both' && typeof t1 === 'number' && typeof t2 === 'number') {
          const yearVal = +(((t1 + t2) / 2).toFixed(2));
          $id('out-year').textContent = yearVal.toFixed(2);
          $id('out-year-grade').textContent = to5(yearVal);
          $id('out-year-card').classList.remove('hidden');
        } else {
          $id('out-year').textContent = '‚Äî';
          $id('out-year-grade').textContent = '‚Äî';
          $id('out-year-card').classList.add('hidden');
        }
      });

      (function init() {
        if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
        window.scrollTo(0,0);
      })();
    })();
  </script>
</body>
</html>
