<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EduPlan</title>
  <!-- Favicon: light/dark -->
<link id="fav-light" rel="icon" type="image/svg+xml" media="(prefers-color-scheme: light)" href="assets/ep-favicon-light.svg">
<link id="fav-dark"  rel="icon" type="image/svg+xml" media="(prefers-color-scheme: dark)"  href="assets/ep-favicon-dark.svg">
<link id="apple-icon" rel="apple-touch-icon" href="assets/ep-favicon-light.svg">
  <!-- Tailwind (no install) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
    /* === DARK MODE === */
:root {
  --bg-from: #f8fafc;  
  --bg-to:   #ffffff;
  --text:    #0f172a;
  --card:    #ffffff;
  --muted:   #475569;
  --border:  #e2e8f0;
  --tab-track:#eef2f6;
  --pill:#e9edf3;
  --pill-text:#334155;
}
.dark {
  --bg-from: #0b1220;  
  --bg-to:   #0a0f1a;
  --text:    #e2e8f0;
  --card:    #0f172a;
  --muted:   #cbd5e1;
  --border:  #334155;
  --tab-track:#111827;
  --pill:#0f172a;
  --pill-text:#cbd5e1;
}
/* badge-lər, tab-lar, button-lar üçün düzəlişlər */
.bg-slate-100\/80{ background-color:var(--tab-track)!important; }
.bg-slate-100{ background-color:var(--pill)!important; }
.badge, .pill, .inline-badge{
  background-color:var(--pill)!important;
  color:var(--pill-text)!important;
}
/* əsas fond və mətn */
body { color: var(--text); }
body.bg-gradient-to-b { 
  background-image: linear-gradient(to bottom, var(--bg-from), var(--bg-to)) !important;
}
/* kartlar və panellər */
.bg-white { background-color: var(--card) !important; }
.text-slate-900, .text-slate-800, .text-slate-700 { color: var(--text) !important; }
.text-slate-600, .text-slate-500 { color: var(--muted) !important; }
/* sərhədlər */
.border-slate-200 { border-color: var(--border) !important; }
/* header blur fonu */
.backdrop-blur.bg-white\/70 { background-color: color-mix(in srgb, var(--card) 70%, transparent) !important; }
/* input/select fonu */
select, input { background-color: var(--card) !important; color: var(--text) !important; }
/* “Aç / Yüklə” düyməsi dark üçün kontrastlı qalsın */
.bg-slate-900 { background-color:#0b1220 !important; color:#fff !important; }
#dark-toggle:checked + span { background:#334155; }
#dark-toggle:checked + span .dot { transform: translateX(16px); }
/* --- Tab keçid animasiyası --- */
.tab-panel {
  display: none;           /* ilkin vəziyyət: gizli */
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 220ms ease, transform 220ms ease;
}

.tab-panel.is-active {
  display: block;          /* görünən panel */
  opacity: 1;
  transform: translateY(0);
}

/* grid panelləri üçün (səndə bəziləri grid-dir) */
.tab-panel.grid-on.is-active { display: grid; }

/* Tab düyməsi üçün vizual aktivlik */
.tab-btn {
  transition: background-color 180ms ease, color 180ms ease, box-shadow 180ms ease, transform 120ms ease;
}
.tab-btn[aria-selected="true"] {
  background-color: var(--card);
  color: var(--text);
  box-shadow: 0 1px 4px rgba(0,0,0,.06);
  transform: translateY(-1px);
}
/* DARK: tray və aktiv düymə üçün daha yüksək kontrast */
.dark #tabs{
  background:#0f172a;              /* tray fonu */
  border-color:#253046;
}
.dark .tab-btn[aria-selected="true"]{
  background:#1e293b;              /* aktiv tab fonu – traydan açıq */
  color:#e5e7eb;
  box-shadow:
    0 0 0 1px #304155,             /* nazik ring */
    0 8px 16px rgba(0,0,0,.35);
}
/* DARK: passiv tabı bir az solğun göstər */
.dark .tab-btn[aria-selected="false"]{
  color:#94a3b8;
  opacity:.9;
}
/* Hər iki rejimdə aktiv tab altında indikator xətti */
.tab-btn[aria-selected="true"]{ position:relative; }
.tab-btn[aria-selected="true"]::after{
  content:"";
  position:absolute; left:12px; right:12px; bottom:-7px;
  height:3px; border-radius:9999px;
  background:linear-gradient(90deg,#22d3ee,#a78bfa);
  opacity:.95;
}
/* Kartların hover kölgəsi */
.bg-white {
  transition: box-shadow 0.2s ease;
}

.bg-white:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.12); /* Light mode kölgə */
}

/* Dark mod üçün hover kölgəsi */
.dark .bg-white:hover {
  box-shadow: 0 6px 16px rgba(255,255,255,0.15); /* Açıq kölgə */
}

  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900 relative">
  <div class="pointer-events-none absolute inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-indigo-200/50 to-emerald-200/50"></div>
    <div class="absolute -bottom-24 -left-24 h-72 w-72 rounded-full blur-3xl bg-gradient-to-tr from-amber-200/40 to-pink-200/40"></div>
  </div>

  <header class="sticky top-0 z-50 backdrop-blur bg-white/70 border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
<!-- Header loqo -->
<img id="site-logo" src="assets/ep-logo.svg" alt="EduPlan loqo" class="h-9 w-9 rounded-2xl shadow-sm" loading="eager" decoding="async">
        <span class="font-semibold tracking-tight">EduPlan AZ</span>
      </div>
      <div class="relative flex items-center gap-3" id="header-controls">
        <button id="btn-settings" class="rounded-2xl border px-3 py-2 text-sm">⚙️ <span data-i18n="nav.settings">Tənzimləmələr</span></button>
        <!-- Settings popover -->
<div id="settings-panel"
       class="hidden absolute right-0 top-12 z-[60] w-64 rounded-2xl border border-slate-200 bg-white p-4 shadow-lg">
    <div class="flex items-center justify-between">
      <div class="text-sm">🌙 Qaranlıq rejim</div>
      <label class="inline-flex items-center cursor-pointer">
        <input id="dark-toggle" type="checkbox" class="sr-only">
        <span class="w-10 h-6 bg-slate-200 rounded-full relative transition">
          <span class="dot absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition"></span>
        </span>
      </label>
    </div>
  </div>
</div>

    </div>
  </header>

  <section class="relative">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12 lg:py-16 grid lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight leading-tight" id="hero-title">KSQ/BSQ və planlaşdırmanı 5 dəqiqəyə hazırla</h1>
        <p class="mt-4 text-slate-600 text-lg" id="hero-subtitle">Sadə interfeys, premium görünüş, Azərbaycan məktəbləri üçün uyğunlaşdırılıb.</p>
        <div class="mt-6 flex items-center gap-3 text-sm text-slate-600">
          <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-emerald-500 inline-block"></span><span id="hero-b1">KSQ & BSQ</span></span>
          <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-indigo-500 inline-block"></span><span id="hero-b2">Perspektiv & gündəlik plan</span></span>
          <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-amber-500 inline-block"></span><span id="hero-b3">PDF/DOCX</span></span>
        </div>
      </div>
      <div class="grid gap-4">
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
            <div class="p-4">
              <div class="text-base font-semibold">📄 <span id="feat-ksq-title">KSQ/BSQ</span></div>
              <div class="text-sm text-slate-600 mt-1" id="feat-ksq-desc">Sinif, fənn, növ və nömrəyə görə faylları tap.</div>
            </div>
          </div>
          <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
            <div class="p-4">
              <div class="text-base font-semibold">📅 <span id="feat-pp-title">Perspektiv plan (PP)</span></div>
              <div class="text-sm text-slate-600 mt-1" id="feat-pp-desc">Fənn üzrə illik plan faylları.</div>
            </div>
          </div>
        </div>
        <div class="grid sm:grid-cols-3 gap-4">
          <div class="rounded-2xl bg-white border p-4 shadow-sm hover:shadow-md transition flex items-center gap-2">🧮 <span id="mini-calc">Kalkulyator</span></div>
          <div class="rounded-2xl bg-white border p-4 shadow-sm hover:shadow-md transition flex items-center gap-2">📚 <span id="mini-templates">Sual bankı</span></div>
          <div class="rounded-2xl bg-white border p-4 shadow-sm hover:shadow-md transition flex items-center gap-2">⬇️ <span id="mini-export">İxrac</span></div>
        </div>
      </div>
    </div>
  </section>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-16">
    <div id="tabs" class="mt-2 grid grid-cols-3 rounded-2xl p-1 bg-slate-100/80 border border-slate-200 shadow-inner">
      <button data-tab="ksq" class="tab-btn rounded-xl px-4 py-2 text-sm text-slate-600" id="tab-ksq">KSQ / BSQ</button>
      <button data-tab="pp"  class="tab-btn rounded-xl px-4 py-2 text-sm text-slate-600" id="tab-pp">Perspektiv plan</button>
      <button data-tab="tools" class="tab-btn rounded-xl px-4 py-2 text-sm text-slate-600" id="tab-tools">Alətlər</button>
    </div>

    <section id="panel-ksq" class="tab-panel is-active mt-6">
      <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
        <div class="p-4 border-b"><h3 class="font-semibold" id="ksq-title">KSQ/BSQ</h3></div>
        <div class="p-4 grid lg:grid-cols-3 gap-6">
          <div class="space-y-4">
            <div><label class="text-sm text-slate-700 block" id="lbl-grade">Sinif</label>
              <select id="grade" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1"></select></div>
            <div><label class="text-sm text-slate-700 block" id="lbl-subject">Fənn</label>
              <select id="subject" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1"></select></div>
            <div><label class="text-sm text-slate-700 block" id="lbl-type">Növ</label>
              <select id="ksqType" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1">
                <option>KSQ</option><option>BSQ</option></select></div>
            <div id="wrap-ksqNo"><label class="text-sm text-slate-700 block" id="lbl-ksqNo">KSQ nömrəsi</label>
              <select id="ksqIndex" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1"></select></div>
            <div id="wrap-bsqNo" class="hidden"><label class="text-sm text-slate-700 block" id="lbl-bsqNo">BSQ nömrəsi</label>
              <select id="bsqIndex" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1"></select></div>
          </div>
          <div class="lg:col-span-2">
            <div class="rounded-xl border border-slate-200 bg-white p-4 text-sm">
              <div class="flex items-center justify-end mb-3">
                <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs text-slate-600 border" id="ksq-count">0</span>
              </div>
              <div id="ksq-results" class="grid sm:grid-cols-2 gap-3"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-pp"  class="tab-panel mt-6">
      <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
        <div class="p-4 border-b"><h3 class="font-semibold" id="pp-title">Perspektiv (illik) plan</h3></div>
        <div class="p-4 grid lg:grid-cols-3 gap-6">
          <div class="space-y-4">
            <div><label class="text-sm text-slate-700 block" id="lbl-pp-subject">Fənn</label>
              <select id="ppSubject" class="w-full rounded-xl border px-3 py-2 text-sm bg-white mt-1"></select></div>
          </div>
          <div class="lg:col-span-2">
            <div class="rounded-xl border border-slate-200 bg-white p-4 text-sm">
              <div class="flex items-center justify-end mb-3">
                <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs text-slate-600 border" id="pp-count">0</span>
              </div>
              <div id="pp-results" class="grid sm:grid-cols-2 gap-3"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-tools" class="tab-panel grid-on mt-6">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
          <div class="p-4 border-b"><div class="text-base font-semibold">🧮 <span id="tool-calc-title">Bal kalkulyatoru</span></div></div>
          <div class="p-4 space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <input type="number" placeholder="KSQ1" class="rounded-xl border px-3 py-2 text-sm" />
              <input type="number" placeholder="KSQ2" class="rounded-xl border px-3 py-2 text-sm" />
              <input type="number" placeholder="KSQ3" class="rounded-xl border px-3 py-2 text-sm" />
              <input type="number" placeholder="KSQ4" class="rounded-xl border px-3 py-2 text-sm" />
            </div>
            <input type="number" placeholder="BSQ" class="rounded-xl border px-3 py-2 text-sm" />
            <button class="rounded-2xl w-full mt-2 bg-slate-900 text-white px-4 py-2 text-sm" id="btn-calc">Hesabla</button>
          </div>
        </div>

        <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
          <div class="p-4 border-b"><div class="text-base font-semibold">📄 <span id="tool-templates-title">Şablon kitabxanası</span></div></div>
          <div class="p-4">
            <div class="flex flex-wrap gap-2 mb-3">
              <span class="rounded-full border px-2 py-1 text-xs">KSQ nümunələri</span>
              <span class="rounded-full border px-2 py-1 text-xs">BSQ nümunələri</span>
              <span class="rounded-full border px-2 py-1 text-xs">Qrublaşdırma</span>
              <span class="rounded-full border px-2 py-1 text-xs">Rubrikalar</span>
              <span class="rounded-full border px-2 py-1 text-xs">İllik plan</span>
              <span class="rounded-full border px-2 py-1 text-xs">Gündəlik plan</span>
            </div>
            <button class="rounded-2xl w-full border px-4 py-2 text-sm" id="btn-browse">Bax</button>
          </div>
        </div>

        <div class="rounded-2xl shadow-sm hover:shadow-md transition border bg-white">
          <div class="p-4 border-b"><div class="text-base font-semibold">📚 <span id="tool-bank-title">Sual bankı</span></div></div>
          <div class="p-4">
            <div class="grid grid-cols-2 gap-2 mb-3">
              <span class="rounded-full border px-2 py-1 text-xs text-center">Multiple choice</span>
              <span class="rounded-full border px-2 py-1 text-xs text-center">Qısa cavab</span>
              <span class="rounded-full border px-2 py-1 text-xs text-center">Açıq sual</span>
              <span class="rounded-full border px-2 py-1 text-xs text-center">Praktik tapşırıq</span>
            </div>
            <button class="rounded-2xl w-full bg-slate-900 text-white px-4 py-2 text-sm" id="btn-add">Əlavə et</button>
          </div>
        </div>

        
      </div>
    </section>
  </main>

  <footer class="border-t border-slate-200 py-10 text-sm">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row items-center justify-between gap-4">
      <p class="text-slate-600">© <span id="year"></span> EduPlan AZ · <span id="ft-rights">Bütün hüquqlar qorunur</span></p>
      <div class="flex items-center gap-4 text-slate-600">
        <a class="hover:underline" href="terms.html" id="ft-terms">Şərtlər</a>
        <a class="hover:underline" href="privacy.html" id="ft-privacy">Məxfilik</a>
      </div>
    </div>
  </footer>

  <script>
    
  const translations = {
    az: {
      nav: { settings: 'Tənzimləmələr', signIn: 'Daxil ol' },
      hero: {
        title: 'KSQ/BSQ və planlaşdırmanı 5 dəqiqəyə hazırla',
        subtitle: 'Sadə interfeys, premium görünüş, Azərbaycan məktəbləri üçün uyğunlaşdırılıb.',
        ctaPrimary: 'Yeni sənəd', ctaSecondary: 'Şablonlara bax',
        badges: { one: 'KSQ & BSQ', two: 'Perspektiv & gündəlik plan', three: 'PDF/DOCX' }
      },
      features: {
        ksqBsq: { title: 'KSQ/BSQ', desc: 'Sinif, fənn, növ və nömrəyə görə faylları tap.' },
        pp: { title: 'Perspektiv plan (PP)', desc: 'Fənn üzrə illik plan faylları.' },
        calc: 'Kalkulyator', templates: 'Sual bankı', export: 'İxrac'
      },
      tabs: { pp: 'Perspektiv plan', tools: 'Alətlər' },
      ksq: { title: 'KSQ/BSQ', type: 'Növ' },
      pp: { title: 'Perspektiv (illik) plan' },
      tools: { calcTitle: 'Bal kalkulyatoru', templatesTitle: 'Şablon kitabxanası', bankTitle: 'Sual bankı' },
      labels: { ksqNo: 'KSQ nömrəsi', bsqNo: 'BSQ nömrəsi' },
      common: { grade: 'Sinif', subject: 'Fənn', calculate: 'Hesabla', browse: 'Bax', add: 'Əlavə et' },
      subjects: {
        az: 'Azərbaycan dili', lit: 'Ədəbiyyat', science: 'Təbiət', eng: 'İngilis dili', rus: 'Rus dili', math: 'Riyaziyyat',
        physics: 'Fizika', chemistry: 'Kimya', biology: 'Biologiya',
        az_history: 'Azərbaycan tarixi', world_history: 'Ümumi tarix', geography: 'Coğrafiya',
        it: 'İnformatika', life: 'Həyat bilgisi', tech: 'Texnologiya', art: 'Təsviri incəsənət', music: 'Musiqi',
        pe: 'Fiziki tərbiyə', premilitary: 'Çağırışaqədərki hazırlıq',
      },
      footer: { rights: 'Bütün hüquqlar qorunur', terms: 'Şərtlər', privacy: 'Məxfilik' },
    },
  };

  const subjectKeysByGrade = {
      I:  ['az','life','math','eng','rus','art','music','pe','tech','it'],
      II: ['az','life','math','eng','rus','art','music','pe','tech','it'],
      III:['az','life','math','eng','rus','art','music','pe','tech','it'],
      IV: ['az','life','math','eng','rus','art','music','pe','tech','it'],
      V:  ['az','lit','eng','rus','math','science','it','az_history','geography','art','music','pe','tech'],
      VI: ['az','lit','eng','rus','math','physics','science','it','az_history','geography','art','music','pe','tech'],
      VII:['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      VIII:['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      IX: ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      X:  ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech','premilitary'],
      XI: ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech','premilitary'],
  };

  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  const state = {
    lang: 'az', grade: 'V',
    ksqType: 'KSQ', ksqIndex: '1', bsqIndex: '1',
    subject: null, ppSubject: null,
    catalog: [],
  };
  window.state = state;
    
function setActiveTab(name, opts = { scroll: false }) {
  // Tab düymələrinin aktivliyi
  $$('.tab-btn').forEach(btn => {
    const act = btn.dataset.tab === name;
    btn.classList.toggle('bg-white', act);
    btn.classList.toggle('shadow-sm', act);
    btn.classList.toggle('text-slate-900', act);
    btn.classList.toggle('text-slate-600', !act);
    btn.setAttribute('aria-selected', act ? 'true' : 'false');
  });

  // Panelləri göstər/gizlət + animasiya
  ['ksq','pp','tools'].forEach(n => {
    const panel = document.getElementById('panel-' + n);
    if (!panel) return;
    if (n === name) {
      panel.classList.add('is-active');
      // düzgün display üçün (grid olan panel üçün)
      if (panel.classList.contains('grid-on')) {
        panel.style.display = 'grid';
      } else {
        panel.style.display = 'block';
      }
      // panelin başına yumşaq scroll (istəyinə görə)
      if (opts.scroll) {
        const y = panel.getBoundingClientRect().top + window.scrollY - 90;
        window.scrollTo({ top: y, behavior: 'smooth' });
      }
    } else {
      panel.classList.remove('is-active');
      panel.style.display = 'none';
    }
  });

  // iç scroll-u sıfırla (vizuallıq üçün)
  document.getElementById('ksq-results')?.scrollTo?.(0,0);
  document.getElementById('pp-results')?.scrollTo?.(0,0);
}

  function option(el, val, text){ const o=document.createElement('option'); o.value=val; o.textContent=text; el.appendChild(o);}  

  function subjectsFor(grade){
    const keys = subjectKeysByGrade[grade] || Object.keys(translations[state.lang].subjects);
    return keys.map(k => translations[state.lang].subjects[k]).filter(Boolean);
  }
  function setText(sel, text){
  const el = document.querySelector(sel);
  if (el) el.textContent = text;
}
  function renderSelects(){
    const grades = ['I','II','III','IV','V','VI','VII','VIII','IX','X','XI'];
    const gradeEl = $('#grade'); gradeEl.innerHTML=''; grades.forEach(g=> option(gradeEl,g,g)); gradeEl.value=state.grade;

    const subjEl = $('#subject'); subjEl.innerHTML='';
    const S = subjectsFor(state.grade); S.forEach(s=> option(subjEl,s,s));
    if(!S.includes(state.subject)) state.subject = S[0]; subjEl.value = state.subject;

    $('#ksqType').value = state.ksqType;
    const kEl=$('#ksqIndex'), bEl=$('#bsqIndex'); kEl.innerHTML=''; bEl.innerHTML='';
    for(let i=1;i<=10;i++) option(kEl, String(i), String(i));
    ['1','2'].forEach(i=> option(bEl,i,i));
    kEl.value = state.ksqIndex; bEl.value = state.bsqIndex;

    const ppEl = $('#ppSubject'); ppEl.innerHTML=''; const all = Object.values(translations[state.lang].subjects);
    all.forEach(s=> option(ppEl,s,s)); if(!all.includes(state.ppSubject)) state.ppSubject=all[0]; ppEl.value=state.ppSubject;

setText('#lbl-grade',   translations[state.lang].common.grade);
setText('#lbl-subject', translations[state.lang].common.subject);
setText('#lbl-type',    translations[state.lang].ksq.type);
setText('#lbl-ksqNo',   translations[state.lang].labels.ksqNo);
setText('#lbl-bsqNo',   translations[state.lang].labels.bsqNo);
setText('#lbl-pp-subject', translations[state.lang].common.subject);

setText('#ksq-title', translations[state.lang].ksq.title);
setText('#pp-title',  translations[state.lang].pp.title);

setText('#hero-title',    translations[state.lang].hero.title);
setText('#hero-subtitle', translations[state.lang].hero.subtitle);
setText('#hero-cta1',     translations[state.lang].hero.ctaPrimary);
setText('#hero-cta2',     translations[state.lang].hero.ctaSecondary);
setText('#hero-b1',       translations[state.lang].hero.badges.one);
setText('#hero-b2',       translations[state.lang].hero.badges.two);
setText('#hero-b3',       translations[state.lang].hero.badges.three);

setText('#feat-ksq-title', translations[state.lang].features.ksqBsq.title);
setText('#feat-ksq-desc',  translations[state.lang].features.ksqBsq.desc);
setText('#feat-pp-title',  translations[state.lang].features.pp.title);
setText('#feat-pp-desc',   translations[state.lang].features.pp.desc);

setText('#tab-pp',    translations[state.lang].tabs.pp);
setText('#tab-tools', translations[state.lang].tabs.tools);

setText('#tool-calc-title',      translations[state.lang].tools.calcTitle);
setText('#tool-templates-title', translations[state.lang].tools.templatesTitle);
setText('#tool-bank-title',      translations[state.lang].tools.bankTitle);

setText('#ft-rights',  translations[state.lang].footer.rights);
setText('#ft-terms',   translations[state.lang].footer.terms);
setText('#ft-privacy', translations[state.lang].footer.privacy);

setText('[data-i18n="nav.settings"]', translations[state.lang].nav.settings);

  }

  function buildTitle(it){
  const format = (it.ext || 'FILE').toUpperCase();
  return it.type==='PP'
    ? `${it.subject} · PP · ${format}`
    : `${it.grade} · ${it.subject} · ${it.type}-${it.index} · ${format}`;
}


  function renderKSQ(){
    const wrap = $('#ksq-results'); wrap.innerHTML='';
    const list = state.catalog.filter(it=>{
      if(it.type!==state.ksqType) return false;
      if(it.type!=='PP' && it.grade!==state.grade) return false;
      if(it.type!=='PP' && it.subject!==state.subject) return false;
      if(state.ksqType==='KSQ' && it.index!==state.ksqIndex) return false;
      if(state.ksqType==='BSQ' && it.index!==state.bsqIndex) return false;
      return true;
    });
    $('#ksq-count').textContent = list.length;
    if(list.length===0){
      wrap.innerHTML = '<div class="rounded-lg border border-dashed border-slate-300 p-6 text-slate-500">Fayl yoxdur</div>';
      return;
    }
    list.forEach(it=>{
      const card = document.createElement('div');
      card.className = 'group rounded-xl p-[1px] bg-gradient-to-br from-slate-200 to-slate-100';
      card.innerHTML = `
        <div class="rounded-[11px] p-4 bg-white shadow-sm group-hover:shadow-md transition">
          <div class="flex items-start gap-3">
            <div class="h-8 w-8 rounded-lg bg-slate-100 grid place-items-center">📄</div>
            <div class="flex-1">
              <div class="text-sm font-medium">${buildTitle(it)}</div>
              <div class="mt-1"><span class="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] border">${(it.ext || 'FILE').toUpperCase()}</span></div>
              <div class="mt-3"><a href="${it.file}" target="_blank" class="rounded-2xl bg-slate-900 text-white px-3 py-1.5 text-sm inline-flex items-center gap-2">↗ Aç / Yüklə</a></div>
            </div>
          </div>
        </div>`;
      wrap.appendChild(card);
    });
  }

  function renderPP(){
    const wrap = $('#pp-results'); wrap.innerHTML='';
    const list = state.catalog.filter(it=> it.type==='PP' && it.subject===state.ppSubject);
    $('#pp-count').textContent = list.length;
    if(list.length===0){
      wrap.innerHTML = '<div class="rounded-lg border border-dashed border-slate-300 p-6 text-slate-500">Fayl yoxdur</div>';
      return;
    }
    list.forEach(it=>{
      const card = document.createElement('div');
      card.className = 'group rounded-xl p-[1px] bg-gradient-to-br from-slate-200 to-slate-100';
      card.innerHTML = `
        <div class="rounded-[11px] p-4 bg-white shadow-sm group-hover:shadow-md transition">
          <div class="flex items-start gap-3">
            <div class="h-8 w-8 rounded-lg bg-slate-100 grid place-items-center">📄</div>
            <div class="flex-1">
              <div class="text-sm font-medium">${buildTitle(it)}</div>
              <div class="mt-1"><span class="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] border">${(it.ext || 'FILE').toUpperCase()}</span></div>
              <div class="mt-3"><a href="${it.file}" target="_blank" class="rounded-2xl bg-slate-900 text-white px-3 py-1.5 text-sm inline-flex items-center gap-2">↗ Aç / Yüklə</a></div>
            </div>
          </div>
        </div>`;
      wrap.appendChild(card);
    });
  }


  document.getElementById('grade').addEventListener('change', e=>{ state.grade=e.target.value; renderSelects(); renderKSQ();});
  document.getElementById('subject').addEventListener('change', e=>{ state.subject=e.target.value; renderKSQ();});
  document.getElementById('ksqType').addEventListener('change', e=>{ state.ksqType=e.target.value; document.getElementById('wrap-ksqNo').classList.toggle('hidden', state.ksqType!=='KSQ'); document.getElementById('wrap-bsqNo').classList.toggle('hidden', state.ksqType!=='BSQ'); renderKSQ();});
  document.getElementById('ksqIndex').addEventListener('change', e=>{ state.ksqIndex=e.target.value; renderKSQ();});
  document.getElementById('bsqIndex').addEventListener('change', e=>{ state.bsqIndex=e.target.value; renderKSQ();});
  document.getElementById('ppSubject').addEventListener('change', e=>{ state.ppSubject=e.target.value; renderPP();});

  ['tab-ksq','tab-pp','tab-tools'].forEach(id => {
  const btn = document.getElementById(id);
  if (!btn) return;
btn.addEventListener('click', (e) => {
  const name = e.currentTarget.dataset.tab;
  setActiveTab(name, { scroll: true }); // klikdə scroll et
});

});
  (function init(){
    document.getElementById('year').textContent = new Date().getFullYear();
// brauzerin əvvəlki scroll-u bərpa etməməsi üçün (opsional, amma faydalıdır)
if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
window.scrollTo(0, 0);

// ilkin açılışda SCROLL ETMƏ
setActiveTab('ksq', { scroll: false });
    state.subject = (function(){ const S = (function(){ const k = {
      I:  ['az','life','math','eng','rus','art','music','pe','tech','it'],
      II: ['az','life','math','eng','rus','art','music','pe','tech','it'],
      III:['az','life','math','eng','rus','art','music','pe','tech','it'],
      IV: ['az','life','math','eng','rus','art','music','pe','tech','it'],
      V:  ['az','lit','eng','rus','math','science','it','az_history','geography','art','music','pe','tech'],
      VI: ['az','lit','eng','rus','math','physics','science','it','az_history','geography','art','music','pe','tech'],
      VII:['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      VIII:['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      IX: ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech'],
      X:  ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech','premilitary'],
      XI: ['az','lit','eng','rus','math','physics','chemistry','biology','az_history','world_history','geography','it','pe','art','music','tech','premilitary'],
    }[state.grade] || Object.keys(translations[state.lang].subjects); return k.map(x=> translations[state.lang].subjects[x]).filter(Boolean); })(); return S[0]; })();
    state.ppSubject = Object.values(translations[state.lang].subjects)[0];
    renderSelects(); renderKSQ(); renderPP(); 
  })();
    
  const settingsBtn = document.getElementById('btn-settings');
  const panel = document.getElementById('settings-panel');
  const darkToggle = document.getElementById('dark-toggle');
// Sistem ayarını da nəzərə al
const mq = window.matchMedia('(prefers-color-scheme: dark)');

// LocalStorage-da yoxdursa, sistemi götür
const saved = localStorage.getItem('theme');
const initialTheme = saved ? saved : (mq.matches ? 'dark' : 'light');

// Tətbiq et
document.documentElement.classList.toggle('dark', initialTheme === 'dark');
if (darkToggle) darkToggle.checked = (initialTheme === 'dark');
applyThemeAssets(initialTheme);

// Toggle dəyişəndə
darkToggle?.addEventListener('change', (e) => {
  const theme = e.target.checked ? 'dark' : 'light';
  document.documentElement.classList.toggle('dark', theme === 'dark');
  localStorage.setItem('theme', theme);
  applyThemeAssets(theme);
});

// İstifadəçi localStorage-da seçim etməyibsə, sistem teması dəyişəndə uyğunlaş
mq.addEventListener?.('change', (e) => {
  if (!localStorage.getItem('theme')) {
    const theme = e.matches ? 'dark' : 'light';
    document.documentElement.classList.toggle('dark', theme === 'dark');
    if (darkToggle) darkToggle.checked = (theme === 'dark');
    applyThemeAssets(theme);
  }
});

  // paneli aç/bağla
  settingsBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    panel.classList.toggle('hidden');
  });

  // kənara klik = bağla
  document.addEventListener('click', (e) => {
    if (!panel.contains(e.target) && !settingsBtn.contains(e.target)) {
      panel.classList.add('hidden');
    }
  });
function applyThemeAssets(theme) {
  const isDark = theme === 'dark';

  // Header loqo
  const logoEl = document.getElementById('site-logo');
  if (logoEl) {
    logoEl.src = isDark ? 'assets/ep-logo-dark.svg' : 'assets/ep-logo.svg';
  }

  // Apple Touch Icon (media dəstəkləmir, JS ilə dəyişək)
  const apple = document.getElementById('apple-icon');
  if (apple) {
    apple.href = isDark ? 'assets/ep-favicon-dark.svg' : 'assets/ep-favicon-light.svg';
  }
}

  </script>
<script>
/** ⚙️ Tənzimləmələr */
const API_KEY = "AIzaSyDWtsVPF0WJy-fHyiApeRL8HIZoOybtCHI";          // referrer-lə domeninə məhdudlaşdır!
const ROOT_ID = "1FJ91N56tPzQ0JpP6t3fioiQzV1NdNvT3";   // yalnız materials qovluğunun ID-si
const driveCache = new Map();

/** Drive-dan səhifələnmiş siyahını oxu */
async function listChildren(folderId) {
  let pageToken = "", out = [];
  do {
    const params = new URLSearchParams({
      q: `'${folderId}' in parents and trashed=false`,
      fields: 'nextPageToken,files(id,name,mimeType,webViewLink,fileExtension,parents)',
      pageSize: '1000',
      key: API_KEY,

      // 🔽 Shared Drive-lar üçün əlavə parametrlər
      includeItemsFromAllDrives: 'true',
      supportsAllDrives: 'true',
      corpora: 'allDrives',
    });
    if (pageToken) params.set('pageToken', pageToken);

    const url = `https://www.googleapis.com/drive/v3/files?${params}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Drive sorğusu uğursuz oldu');
    const data = await res.json();
    out.push(...(data.files || []));
    pageToken = data.nextPageToken || "";
  } while (pageToken);
  return out;
}


/** Bütün ağacı rekursiv gəz (ROOT_ID-dən başlayaraq) */
async function walkTree(folderId, path = []) {
  const key = `walk:${folderId}`;
  if (driveCache.has(key)) return driveCache.get(key);

  const children = await listChildren(folderId);
  const nodes = [];

  // əvvəlcə qovluqlar
  const folders = children.filter(c => c.mimeType === 'application/vnd.google-apps.folder');
  // sonra fayllar
  const files   = children.filter(c => c.mimeType !== 'application/vnd.google-apps.folder');

  // Faylları topla
  files.forEach(f => nodes.push({ type: 'file', file: f, path }));

  // Alt-qovluqları rekursiv gəz
  for (const fld of folders) {
    const subNodes = await walkTree(fld.id, [...path, fld.name]);
    nodes.push({ type: 'folder', folder: fld, path, children: subNodes });
  }

  driveCache.set(key, nodes);
  return nodes;
}

function mimeToExt(mime) {
  if (!mime) return 'FILE';
  // Google sənədləri üçün qısa etiketlər
  if (mime === 'application/vnd.google-apps.document') return 'DOCS';
  if (mime === 'application/vnd.google-apps.spreadsheet') return 'SHEETS';
  if (mime === 'application/vnd.google-apps.presentation') return 'SLIDES';
  if (mime === 'application/pdf') return 'PDF';
  const p = mime.split('/')[1];
  return (p || 'FILE').toUpperCase();
}

function treeToCatalog(nodes) {
  const out = [];
  const flat = [];
  const stack = [...nodes];
  while (stack.length) {
    const n = stack.pop();
    if (!n) continue;
    if (n.type === 'file') flat.push(n);
    if (n.type === 'folder' && Array.isArray(n.children)) stack.push(...n.children);
  }

  flat.forEach(n => {
    const path = n.path;
    const top = (path[0] || '').toUpperCase();
    const ext = (n.file.fileExtension || mimeToExt(n.file.mimeType)).toUpperCase();
    const link = n.file.webViewLink || `https://drive.google.com/file/d/${n.file.id}/view`;

    if (top === 'KSQ' || top === 'BSQ') {
      const subject = path[1] || '';
      const grade   = path[2] || '';
      const m = n.file.name.match(/(KSQ|BSQ)\s*[-_ ]?\s*(\d+)/i);
      const idx = m?.[2] || '1';
      out.push({
        type: top, subject, grade, index: String(idx),
        file: link, ext
      });
    } else if (top === 'PP') {
      const subject = path[1] || '';
      out.push({
        type: 'PP', subject,
        file: link, ext
      });
    }
  });

  return out;
}

/** UI-yə bağla */
async function loadAllFromMaterials() {
  const wrapKSQ = document.getElementById('ksq-results');
  const wrapPP  = document.getElementById('pp-results');
  if (wrapKSQ) wrapKSQ.innerHTML = '<div class="text-slate-500">Yüklənir…</div>';
  if (wrapPP)  wrapPP.innerHTML  = '<div class="text-slate-500">Yüklənir…</div>';

  try {
    const tree = await walkTree(ROOT_ID, []);     // bütün ağacı oxu
    const catalog = treeToCatalog(tree);          // kataloqa çevir
    window.state.catalog = catalog;               // sənin mövcud render funksiyaların üçün
    renderSelects();
    renderKSQ();
    renderPP();
  } catch (e) {
    const msg = `<div class="rounded-lg border border-dashed border-slate-300 p-6 text-slate-500">Xəta: ${e.message}</div>`;
    if (wrapKSQ) wrapKSQ.innerHTML = msg;
    if (wrapPP)  wrapPP.innerHTML  = msg;
  }
}

// Hadisələr eyni qalır; sadəcə ilk yükləmədə kataloqu Drive-dan doldur
document.addEventListener('DOMContentLoaded', () => {
  renderSelects();
  loadAllFromMaterials();
});
</script>

</body>
</html>
